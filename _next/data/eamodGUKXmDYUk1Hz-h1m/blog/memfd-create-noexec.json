{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of p(s))!h.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=d(s,e))||c.enumerable});return a},f=a=>k(t(l(a!=null?r(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((x,i)=>{i.exports=_jsx_runtime});var v={};N(v,{default:()=>b,frontmatter:()=>y});var n=f(o()),y={title:\"Bypassing noexec with memfd_create(2)\",date:\"2026-02-29\",tags:[\"linux\",\"c\",\"systems-programming\",\"java\"],draft:!1,summary:\"Using Linux's memfd_create(2) syscall to load shared libraries and execute binaries entirely from memory, bypassing noexec restrictions without ever touching disk.\",images:[\"/static/images/memfd-create-readonly-fs.svg\"]};function g(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",code:\"code\",strong:\"strong\",a:\"a\",pre:\"pre\",span:\"span\",ol:\"ol\",li:\"li\",ul:\"ul\",h1:\"h1\",hr:\"hr\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"Some time ago, I saw a post on the \",(0,n.jsx)(e.code,{children:\"/r/java\"}),\" subreddit, asking about \",(0,n.jsx)(e.strong,{children:'\"loading a shared lib from .jar directly into memory\"'}),\": \",(0,n.jsx)(e.a,{href:\"https://reddit.com/r/java/comments/15lcwil/load_shared_lib_from_jar_directly_into_memory/\",children:\"https://reddit.com/r/java/comments/15lcwil/load_shared_lib_from_jar_directly_into_memory/\"})]}),(0,n.jsx)(e.p,{children:\"Despite claims that the above is/should be impossible, it CAN be done.\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://man7.org/linux/man-pages/man2/memfd_create.2.html\",children:\"https://man7.org/linux/man-pages/man2/memfd_create.2.html\"})}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`NAME\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       memfd_create \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),` create an anonymous file\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`LIBRARY\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       Standard C \",(0,n.jsx)(e.span,{className:\"token function\",children:\"library\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"libc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"lc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`SYNOPSIS\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       \",(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"define\"}),\" \",(0,n.jsx)(e.span,{className:\"token macro-name\",children:\"_GNU_SOURCE\"}),\"         \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"/* See feature_test_macros(7) */\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       \",(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<sys/mman.h>\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"memfd_create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" flags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Linux has a syscall, \",(0,n.jsx)(e.code,{children:\"memfd_create(2)\"}),\", that allows creating something like a virtual file descriptor. You can use the FD it returns just like any other, but it doesn't interact with the filesystem underneath.\"]}),(0,n.jsxs)(e.p,{children:[\"The reason this works is that \",(0,n.jsx)(e.code,{children:\"memfd\"}),\" file descriptors are backed by anonymous pages in \",(0,n.jsx)(e.code,{children:\"tmpfs\"}),\". When you call \",(0,n.jsx)(e.code,{children:\"fexecve()\"}),\" or \",(0,n.jsx)(e.code,{children:\"dlopen()\"}),\" on one, the kernel maps those pages into the process's address space directly -- it never consults the \",(0,n.jsx)(e.code,{children:\"noexec\"}),\" flag of any mounted filesystem, because there IS no mounted filesystem involved. The execution permission is determined by the \",(0,n.jsx)(e.code,{children:\"memfd\"}),\"'s own file seals and the process's ability to map executable pages, rather than by mount options.\"]}),(0,n.jsx)(e.p,{children:\"The general idea is something like:\"}),(0,n.jsxs)(e.ol,{children:[(0,n.jsx)(e.li,{children:\"Create in-memory file descriptor\"}),(0,n.jsx)(e.li,{children:\"Write the bytes of an application or library into the file descriptor\"}),(0,n.jsx)(e.li,{children:\"Run the application or load the library\"})]}),(0,n.jsx)(e.p,{children:\"Here's a minimal proof of concept, for both an ELF binary and a shared library.\"}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u276F tree .\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 Makefile\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 example-library.c     # Shared lib exporting add() for testing\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 example-program.c     # Normal ELF binary that links against libexample-library.so\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 memfd-exec.c          # Loads an entire ELF binary into a memfd and executes it with fexecve()\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 memfd-loader.c        # Loads an .so into a memfd and calls its symbols via dlopen()/dlsym()\n`})]})}),(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-makefile\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CC      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` gcc\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CFLAGS  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` -Wall -Wextra -O2\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` example-library.so libexample-library.so example-program memfd-loader memfd-exec\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"example-library.so\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` example-library.c\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -shared -fPIC -o \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"libexample-library.so\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` example-library.so\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    ln -sf \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"example-program\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` example-program.c libexample-library.so\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -o \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),\" -L. -lexample-library -Wl,-rpath,\",(0,n.jsx)(e.span,{className:\"token string\",children:\"'$ORIGIN'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"memfd-loader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` memfd-loader.c example-library.so\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -o \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),` -ldl\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"memfd-exec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` memfd-exec.c example-program\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -o \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    rm -f example-library.so libexample-library.so example-program memfd-loader memfd-exec\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\".PHONY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` all clean\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// example-library.c\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// example-program.c\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<stdio.h>\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"%d\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// memfd-loader.c\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"define\"}),\" \",(0,n.jsx)(e.span,{className:\"token macro-name\",children:\"_GNU_SOURCE\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<dlfcn.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<stdio.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<string.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<sys/mman.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<unistd.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<fcntl.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<sys/stat.h>\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 1. Read the .so bytes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" lib \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-library.so\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" O_RDONLY\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"stat\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fstat\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lib\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"read\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lib\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lib\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 2. Create an anonymous in-memory file descriptor\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" memfd \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"memfd_create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-library.so\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" MFD_CLOEXEC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 3. Write the library bytes into it\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4. dlopen via /proc/self/fd/<N> - no filesystem path needed\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"snprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/proc/self/fd/%d\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"handle \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dlopen\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" RTLD_NOW\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"handle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dlopen: %s\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dlerror\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 5. Resolve + call the symbol\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dlsym\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"handle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"add\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"add(3, 4) = %d\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dlclose\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"handle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// memfd-exec.c\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"define\"}),\" \",(0,n.jsx)(e.span,{className:\"token macro-name\",children:\"_GNU_SOURCE\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<stdio.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<fcntl.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<sys/mman.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<sys/stat.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token macro property\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<unistd.h>\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 1. Read the binary bytes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" bin \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-program\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" O_RDONLY\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"stat\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fstat\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"read\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 2. Create anonymous in-memory fd\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" memfd \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"memfd_create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-program\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" MFD_CLOEXEC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 3. Write binary into it\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" st\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"st_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4. Execute directly from the fd\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//    Note: fexecve replaces the process image, so $ORIGIN in any rpath\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//    would resolve to /proc/self/fd/ which doesn't contain our .so.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//    We use LD_LIBRARY_PATH as a simple workaround.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"argv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-program\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"char\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"envp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"LD_LIBRARY_PATH=.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Executing example-program from memfd...\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fexecve\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" argv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" envp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"perror\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fexecve\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"You should be able to run the ELF binary or invoke the shared lib using the \",(0,n.jsx)(e.code,{children:\"memfd\"}),\" example apps:\"]}),(0,n.jsx)(e.p,{children:\"First, to prove I'm not pulling tricks here...\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`projects/memory-loader-example via C v13.3.0-gcc\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\\u276F \",(0,n.jsx)(e.span,{className:\"token function\",children:\"grep\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"' /proc '\"}),\" /proc/mounts \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"grep\"}),\" -q \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'noexec'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name builtin\",children:\"echo\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"noexec is enabled\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"||\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name builtin\",children:\"echo\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"noexec is not enabled\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`noexec is enabled\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`projects/memory-loader-example via C v13.3.0-gcc\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\\u276F \",(0,n.jsx)(e.span,{className:\"token function\",children:\"grep\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"' /proc '\"}),\" /proc/mounts \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"grep\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'noexec'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"proc /proc proc rw,nosuid,nodev,noexec,noatime \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"And with that, we confirm:\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`projects/memory-loader-example via C v13.3.0-gcc\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u276F ./example-program\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`projects/memory-loader-example via C v13.3.0-gcc\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u276F ./memfd-loader\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),\", \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`projects/memory-loader-example via C v13.3.0-gcc\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u276F ./memfd-exec\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Executing example-program from memfd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"As someone mentions in the Reddit thread, there are patches for both Chrome and the kernel to prevent this behavior:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://issuetracker.google.com/issues/40054993\",children:\"https://issuetracker.google.com/issues/40054993\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://lore.kernel.org/kernel-hardening/20201203173118.379271-1-mic@digikod.net/T/\",children:\"https://lore.kernel.org/kernel-hardening/20201203173118.379271-1-mic@digikod.net/T/\"})})]}),(0,n.jsxs)(e.p,{children:[\"It's worth noting that as of kernel 6.3, the \",(0,n.jsx)(e.code,{children:\"vm.memfd_noexec\"}),\" sysctl was introduced to restrict executable memfds. At level 1, \",(0,n.jsx)(e.code,{children:\"memfd_create()\"}),\" without \",(0,n.jsx)(e.code,{children:\"MFD_NOEXEC_SEAL\"}),\" emits a warning; at level 2, it's denied outright. Most distros still ship with this at 0 (unrestricted), but hardened configs and container runtimes are starting to lock it down.\"]}),(0,n.jsxs)(e.h1,{id:\"addendum-solving-the-original-problem\",children:[(0,n.jsx)(e.a,{href:\"#addendum-solving-the-original-problem\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Addendum: Solving the original problem\"]}),(0,n.jsxs)(e.p,{children:[\"In case you actually want to accomplish the same thing as the original /r/java user (loading a native library from memory without extracting it to disk) the following does so using JDK 23's Foreign Function & Memory (FFM) API to call \",(0,n.jsx)(e.code,{children:\"memfd_create\"}),\" and \",(0,n.jsx)(e.code,{children:\"dlopen\"}),\"/\",(0,n.jsx)(e.code,{children:\"dlsym\"}),\" directly, with no JNI involved:\"]}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// java --enable-preview --source 23 --enable-native-access=ALL-UNNAMED LoadFromMemory.java < example-library.so\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Throwable\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" sharedLibContents \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"in\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"readAllBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Arena\"}),\" arena \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Arena\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofAuto\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Linker\"}),\" linker \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Linker\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"nativeLinker\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SymbolLookup\"}),\" lookup \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" linker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"defaultLookup\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Get \"memfd_create\" handle from libc'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MethodHandle\"}),\" memfdCreate \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" linker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"downcallHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            lookup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"find\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"memfd_create\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"orElseThrow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FunctionDescriptor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Create memory file descriptor\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" fd \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" memfdCreate\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"invokeExact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arena\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocateFrom\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"example-library\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Write shared library to memory file descriptor\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" fdPath \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/proc/self/fd/\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" fd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" fos \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FileOutputStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fdPath\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        fos\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"sharedLibContents\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Get \"dlopen\" handle from libc'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MethodHandle\"}),\" dlopen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" linker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"downcallHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            lookup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"find\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"dlopen\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"orElseThrow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FunctionDescriptor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Load shared library from memfd\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" handle \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" dlopen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"invokeExact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arena\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocateFrom\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fdPath\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Get \"dlsym\" handle and resolve \"add\" function'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MethodHandle\"}),\" dlsym \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" linker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"downcallHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            lookup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"find\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"dlsym\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"orElseThrow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FunctionDescriptor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ADDRESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" addAddr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" dlsym\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"invokeExact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"handle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" arena\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocateFrom\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"add\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MethodHandle\"}),\" add \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" linker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"downcallHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"addAddr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FunctionDescriptor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Invoke \"add\" function'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"invokeExact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"1 + 2 = \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"AI Use Disclaimer:\"}),\" \",(0,n.jsx)(e.code,{children:\"claude code\"}),\" was used to generate the \",(0,n.jsx)(e.a,{href:\"/static/images/memfd-create-readonly-fs.svg\",children:\"OpenGraph SVG image\"})]}),(0,n.jsx)(e.p,{children:\"No part of the prose was machine-generated. You will not find machine-written prose on this blog. I consider it deeply disrespectful.\"})]})}}var b=g;return v;})();\n;return Component;","toc":[{"value":"Addendum: Solving the original problem","url":"#addendum-solving-the-original-problem","depth":1}],"frontMatter":{"readingTime":{"text":"10 min read","minutes":9.82,"time":589200,"words":1964},"slug":"memfd-create-noexec","fileName":"memfd-create-noexec.md","title":"Bypassing noexec with memfd_create(2)","date":"2026-03-01T00:00:00.000Z","tags":["linux","c","systems-programming","java"],"draft":false,"summary":"Using Linux's memfd_create(2) syscall to load shared libraries and execute binaries entirely from memory, bypassing noexec restrictions without ever touching disk.","images":["/static/images/memfd-create-readonly-fs.svg"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.9,"time":54000,"words":180},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"PromptQL (formerly known as Hasura)","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"Disposable Software: When generating code costs less than finding it","date":"2026-02-28T00:00:00.000Z","tags":["non-technical","ai","opinion","software-engineering"],"draft":false,"summary":"LLMs have made generating code nearly free, but maintaining it hasn't changed. On the growing plague of code that shouldn't exist and the discipline of searching before building.","images":["/static/images/llm-build-vs-search.svg"],"slug":"llm-build-cheaper-than-searching"},"next":null},"__N_SSG":true}