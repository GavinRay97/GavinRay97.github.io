{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},w=a=>g(i(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((A,o)=>{o.exports=_jsx_runtime});var f={};k(f,{default:()=>E,frontmatter:()=>b});var e=w(r()),b={title:\"Experimenting with SQL:2023 Property-Graph Queries in Postgres 18\",date:\"2025-07-19\",tags:[\"postgres\",\"sql\"],draft:!1,summary:\"Hands-on guide to the upcoming SQL/PGQ graph syntax using a patched Postgres 18 beta.\",images:[\"/static/images/postgres-sql-pgq-banner.png\"]};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({hr:\"hr\",p:\"p\",strong:\"strong\",br:\"br\",code:\"code\",h1:\"h1\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",img:\"img\"},a.components),{TOCInline:t}=n;return t||T(\"TOCInline\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t,{toc:a.toc,indentDepth:4,asDisclosure:!0}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"TL;DR\"}),(0,e.jsx)(n.br,{}),\"Grab the Docker image below, connect with \",(0,e.jsx)(n.code,{children:\"psql\"}),\", and try the recommendation-graph query. SQL/PGQ feels like Cypher without leaving home.\"]}),(0,e.jsxs)(n.h1,{id:\"intro\",children:[(0,e.jsx)(n.a,{href:\"#intro\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Intro\"]}),(0,e.jsx)(n.p,{children:\"SQL:2023 introduced a new syntax for graph querying.\"}),(0,e.jsx)(n.p,{children:'This graph query language is called \"SQL/PGQ\". You can read more about it below:'}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.iso.org/standard/79473.html\",children:\"https://www.iso.org/standard/79473.html\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.postgresql.org/message-id/a855795d-e697-4fa5-8698-d20122126567%40eisentraut.org\",children:\"https://www.postgresql.org/message-id/a855795d-e697-4fa5-8698-d20122126567%40eisentraut.org\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://blogs.oracle.com/database/post/property-graphs-in-oracle-database-23ai-the-sql-pgq-standard\",children:\"https://blogs.oracle.com/database/post/property-graphs-in-oracle-database-23ai-the-sql-pgq-standard\"})})]}),(0,e.jsx)(n.p,{children:\"To date, only Oracle 23 has released support for it, but I want to show you how you can experiment with SQL/PGQ today in Postgres.\"}),(0,e.jsxs)(n.h1,{id:\"docker-image-with-postgres-18beta2--sqlpgq-patches\",children:[(0,e.jsx)(n.a,{href:\"#docker-image-with-postgres-18beta2--sqlpgq-patches\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Docker Image with Postgres 18beta2 + SQL/PGQ Patches\"]}),(0,e.jsx)(n.p,{children:\"I've published a Docker image which contains the latest release of Postgres and applies the SQL/PGQ patches from the mailing list.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`docker run -d \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  --name postgres-pgq \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -p 5432:5432 \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -v postgres-data:/var/lib/postgresql/data \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -e PGDATA=/var/lib/postgresql/data \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -e POSTGRES_PASSWORD=postgres \\\\\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  gavinray/postgres-18beta2-pgql:latest\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`docker exec -it postgres-pgq psql -U postgres -d postgres\n`})]})}),(0,e.jsxs)(n.p,{children:[\"You can find the source below. Please excuse the Cthonian horror that is the \",(0,e.jsx)(n.code,{children:\"Dockerfile\"}),\". \",(0,e.jsx)(n.a,{href:\"https://github.com/GavinRay97/postgres-18beta2-sql-pgl\",children:\"https://github.com/GavinRay97/postgres-18beta2-sql-pgl\"})]}),(0,e.jsxs)(n.h1,{id:\"example-e-commerce-product-recommendations\",children:[(0,e.jsx)(n.a,{href:\"#example-e-commerce-product-recommendations\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Example: E-Commerce Product Recommendations\"]}),(0,e.jsx)(n.p,{children:\"This example has been done to death, but it's a good way to showcase PGQ.\"}),(0,e.jsxs)(n.p,{children:[\"Suppose we've got \",(0,e.jsx)(n.code,{children:\"users\"}),\", a list of \",(0,e.jsx)(n.code,{children:\"products\"}),\", and \",(0,e.jsx)(n.code,{children:\"purchases\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Node Table: Users\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TABLE\"}),\" users \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INT\"}),\" GENERATED ALWAYS \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"IDENTITY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    name \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TEXT\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"NULL\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Node Table: Products\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TABLE\"}),\" products \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INT\"}),\" GENERATED ALWAYS \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"IDENTITY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    name \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TEXT\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"NULL\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    price \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"NUMERIC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Edge Table: Purchases linking users and products\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TABLE\"}),\" purchases \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    user_id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REFERENCES\"}),\" users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    product_id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REFERENCES\"}),\" products\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    purchase_date \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DEFAULT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CURRENT_DATE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"PRIMARY\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"KEY\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"user_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" product_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"And suppose that we have \",(0,e.jsx)(n.code,{children:\"Alice\"}),\" and \",(0,e.jsx)(n.code,{children:\"Bob\"}),\". \",(0,e.jsx)(n.code,{children:\"Alice\"}),\" buys a laptop and a mouse, \",(0,e.jsx)(n.code,{children:\"Bob\"}),\" buys a laptop and a keyboard:\"]}),(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INSERT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INTO\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    users \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"VALUES\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Alice'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- id 1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Bob'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- id 2\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INSERT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INTO\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    products \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" price\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"VALUES\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Laptop'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1200.00\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- id 1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Mouse'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"25.00\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- id 2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Keyboard'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"75.00\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- id 3\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Insert purchases (edges)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INSERT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INTO\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    purchases \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"user_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" product_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"VALUES\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Alice bought a Laptop\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Alice bought a Mouse\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Bob bought a Laptop (the shared item)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Bob bought a Keyboard (the recommendation)\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Now we can get into the meat of things: the Property Graph definition and a query over it.\"}),(0,e.jsxs)(n.p,{children:[\"We start by defining a \",(0,e.jsx)(n.code,{children:\"PROPERTY GRAPH\"}),\", and declaring \",(0,e.jsx)(n.code,{children:\"VERTEX\"}),\" and \",(0,e.jsx)(n.code,{children:\"EDGE\"}),\" tables for it. The documentation for this DDL statement can be found at:\"]}),(0,e.jsx)(n.ul,{children:(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlrf/create-property-graph.html\",children:\"https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlrf/create-property-graph.html\"})})}),(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),` PROPERTY GRAPH recommender_graph\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"VERTEX \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TABLES\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    users LABEL users PROPERTIES \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    products LABEL product PROPERTIES \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" price\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"EDGE \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TABLES\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    purchases\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    SOURCE \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"KEY\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"user_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REFERENCES\"}),\" users \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    DESTINATION \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"KEY\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"product_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REFERENCES\"}),\" products \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    LABEL BOUGHT\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"graphviz image of user purchases\",src:\"/static/images/product-purchase-graph.svg\"})}),(0,e.jsx)(n.p,{children:`Now, we can ask a question like: \"What are similar products that Alice hasn't yet purchased?\"`}),(0,e.jsx)(n.p,{children:\"The syntax for that statement in PGQL (well, one representation of it), is:\"}),(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- (Alice) -> (Shared Product) <- (Similar User) -> (Recommended Product)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DISTINCT\"}),\" g\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"rec_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" g\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`rec_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" GRAPH_TABLE \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`       recommender_graph\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"MATCH\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"me  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" users    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" me\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Alice'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"               \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\":BOUGHT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"p   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" product\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\":BOUGHT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"sim \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"               \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\":BOUGHT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rec \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" product\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"COLUMNS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"me\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" uid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                rec\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" rec_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                rec\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"name \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" rec_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),` g\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"EXISTS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),`   purchases p\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\"  p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_id    \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" g\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`uid\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\"  p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"product_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" g\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`rec_id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"That should return:\"}),(0,e.jsx)(n.pre,{className:\"language-md\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-md\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token table\",children:(0,e.jsxs)(n.span,{className:\"token table-header-row\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token important table-header\",children:\" Rec id \"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token important table-header\",children:\" Rec name \"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),`\n`]})})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token table\",children:[(0,e.jsx)(n.span,{className:\"token table-header-row\"}),(0,e.jsxs)(n.span,{className:\"token table-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":-----\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":-------\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),`\n`]})]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token table\",children:[(0,e.jsx)(n.span,{className:\"token table-line\"}),(0,e.jsxs)(n.span,{className:\"token table-data-rows\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token table-data\",children:\" 3      \"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token table-data\",children:\" Keyboard \"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),`\n`]})]})})]})}),(0,e.jsxs)(n.p,{children:[\"It seems that \",(0,e.jsx)(n.code,{children:\"Alice\"}),\", having purchased a laptop and a mouse, might appreciate a keyboard! Neat.\"]}),(0,e.jsxs)(n.h1,{id:\"patch-and-build-details\",children:[(0,e.jsx)(n.a,{href:\"#patch-and-build-details\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Patch and Build Details\"]}),(0,e.jsxs)(n.p,{children:[\"This image was built by applying the most recent collection of patches supplied in the mailing list thread from Junwang Zhao on top of the \",(0,e.jsx)(n.code,{children:\"18beta2\"}),\" source tarzip.\"]}),(0,e.jsx)(n.ul,{children:(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.postgresql.org/message-id/CAEG8a3L3uZZRT5Ra5%3D9G-SOCEYULejw5eqQE99VL0YfTeX3-BA%40mail.gmail.com\",children:\"https://www.postgresql.org/message-id/CAEG8a3L3uZZRT5Ra5%3D9G-SOCEYULejw5eqQE99VL0YfTeX3-BA%40mail.gmail.com\"})})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Attachment\tContent-Type\tSize\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0011-do-not-use-default-COLLATE.patch\tapplication/octet-stream\t5.8 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0012-trivial-refactor-of-property-graph-object-addres.patch\tapplication/octet-stream\t17.1 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0010-adapt-property-graph-to-more-intuitive-titles.patch\tapplication/octet-stream\t2.6 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0008-Document-fixes.patch\tapplication/octet-stream\t5.1 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0009-WIP-Do-not-print-empty-columns-table-for-a-prope.patch\tapplication/octet-stream\t14.1 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0007-RLS-tests.patch\tapplication/octet-stream\t182.1 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0006-Property-collation-and-edge-vertex-link-support.patch\tapplication/octet-stream\t114.3 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0005-Access-permissions-on-property-graph.patch\tapplication/octet-stream\t11.9 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0004-Fixes-following-issues.patch\tapplication/octet-stream\t36.2 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0003-Support-cyclic-path-pattern.patch\tapplication/octet-stream\t37.4 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0002-support-WHERE-clause-in-graph-pattern.patch\tapplication/octet-stream\t7.2 KB\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`v10-0001-WIP-SQL-Property-Graph-Queries-SQL-PGQ.patch\tapplication/octet-stream\t504.4 KB\n`})]})}),(0,e.jsx)(n.p,{children:\"Additionally, there are some hacky patches in the Dockerfile that strip out a bunch of functionality related to Serbian locale and stemming, to fix compilation errors.\"}),(0,e.jsxs)(n.h1,{id:\"further-reading\",children:[(0,e.jsx)(n.a,{href:\"#further-reading\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Further Reading\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://pgconf.in/conferences/pgconfin2025/program/proposals/895\",children:\"https://pgconf.in/conferences/pgconfin2025/program/proposals/895\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.enterprisedb.com/blog/representing-graphs-postgresql-sqlpgq\",children:\"https://www.enterprisedb.com/blog/representing-graphs-postgresql-sqlpgq\"})})]}),(0,e.jsxs)(n.h1,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{href:\"#conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,e.jsx)(n.p,{children:\"I don't often work in domains that can benefit from the ergonomic enhancements that Property Graphs can provide, but I think it's an invaluable addition to the ISO SQL Standard.\"}),(0,e.jsx)(n.p,{children:\"Looking forward to the day this gets merged in Postgres =)\"})]})}}var E=y;function T(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f;})();\n;return Component;","toc":[{"value":"Intro","url":"#intro","depth":1},{"value":"Docker Image with Postgres 18beta2 + SQL/PGQ Patches","url":"#docker-image-with-postgres-18beta2--sqlpgq-patches","depth":1},{"value":"Example: E-Commerce Product Recommendations","url":"#example-e-commerce-product-recommendations","depth":1},{"value":"Patch and Build Details","url":"#patch-and-build-details","depth":1},{"value":"Further Reading","url":"#further-reading","depth":1},{"value":"Conclusion","url":"#conclusion","depth":1}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.365,"time":321900,"words":1073},"slug":"postgres-sql-property-graphs","fileName":"postgres-sql-property-graphs.md","title":"Experimenting with SQL:2023 Property-Graph Queries in Postgres 18","date":"2025-07-19T00:00:00.000Z","tags":["postgres","sql"],"draft":false,"summary":"Hands-on guide to the upcoming SQL/PGQ graph syntax using a patched Postgres 18 beta.","images":["/static/images/postgres-sql-pgq-banner.png"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.85,"time":51000,"words":170},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"Psychedelics as Tools: Reflections After 20+ Compounds and a Decade of Experiments","date":"2025-07-12T00:00:00.000Z","tags":["non-technical","psychedelics"],"draft":false,"summary":"Reflections and hard-won lessons from a decade exploring over 20 psychedelic compounds.","images":["/static/images/Ouroborous-benzene.svg"],"slug":"perspectives-on-psychedelic-use"},"next":null},"__N_SSG":true}