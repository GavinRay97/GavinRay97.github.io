{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},f=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=p(s,e))||c.enumerable});return a},g=a=>f(i(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((E,o)=>{o.exports=_jsx_runtime});var v={};k(v,{default:()=>w,frontmatter:()=>b});var n=g(r()),b={title:\"Adding Design-by-Contract [[invariant]] conditions to C++, via a GCC plugin\",date:\"2022-12-31\",tags:[\"cpp\",\"gcc\",\"design-by-contract\"],draft:!1,summary:`Design-by-Contract's invariant attribute allows you to enforce important properties of systems and data structures, making it an incredibly useful tool for developers. In this blog post, we'll be exploring the development of a GCC plugin that adds support for [[invariant]] conditions in C++ classes and structs. We'll also be looking at an example of how invariant can be used to improve the integrity of a Stack data structure. This is especially timely as GCC has recently added support for Contracts, allowing you to annotate functions with pre/post conditions. Don't miss out on learning how to use this powerful feature in your own projects!\n`,images:[\"/static/images/design-by-contract-logo.png\"]};function _(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",blockquote:\"blockquote\",p:\"p\",a:\"a\",h1:\"h1\",span:\"span\",strong:\"strong\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",em:\"em\",h2:\"h2\",ol:\"ol\",h3:\"h3\",img:\"img\"},a.components),{TOCInline:t}=e;return t||y(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{toc:a.toc,indentDepth:2,asDisclosure:!0}),(0,n.jsx)(e.hr,{}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"Note: You can find the source code for this project here: \",(0,n.jsx)(e.a,{href:\"https://github.com/GavinRay97/gcc-invariant-plugin\",children:\"https://github.com/GavinRay97/gcc-invariant-plugin\"})]})}),(0,n.jsxs)(e.h1,{id:\"preface\",children:[(0,n.jsx)(e.a,{href:\"#preface\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Preface\"]}),(0,n.jsxs)(e.p,{children:[\"Last month, GCC landed support for \",(0,n.jsx)(e.strong,{children:\"Contracts\"}),\" in trunk:\"]}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://gcc.gnu.org/git/?p=gcc.git;a=commit;h=ea63396f6b08f88f1cde827e6cab94cd488f7fa7\",children:\"https://gcc.gnu.org/git/?p=gcc.git;a=commit;h=ea63396f6b08f88f1cde827e6cab94cd488f7fa7\"})})}),(0,n.jsxs)(e.p,{children:[\"If you aren't a C++ developer, or you are a C++ developer but haven't followed the Contracts feature/don't have an interest in Design-by-Contract, what this proposal does is allow you to annotate your functions with \",(0,n.jsx)(e.strong,{children:\"pre/post conditions\"}),\" that are checked when the method is called.\"]}),(0,n.jsx)(e.p,{children:\"A trivial example might be something like:\"}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"divide_returns_gt_10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pre\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" b \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Avoid dividing by zero\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"post r\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Enforce that we return > 10\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"This functionality is fantastic because it allows you to encode your requirements and assertions declaratively into your methods.\"}),(0,n.jsxs)(e.p,{children:[\"But, the most powerful feature of Design-by-Contract is the \",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.code,{children:\"invariant\"})}),\". An \",(0,n.jsx)(e.code,{children:\"invariant\"}),\" condition allows you to write a set of assertions/assumptions about the state of an object/program that should always hold true.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Invariants\"}),\" are incredibly useful \",(0,n.jsx)(e.em,{children:(0,n.jsx)(e.strong,{children:\"for enforcing properties of systems\"})}),\", or data structures. Especially when the validity of a data structure requires conforming to a set of properties.\"]}),(0,n.jsxs)(e.h1,{id:\"a-compelling-usecase\",children:[(0,n.jsx)(e.a,{href:\"#a-compelling-usecase\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"A compelling usecase\"]}),(0,n.jsx)(e.p,{children:\"In my free time over the last 6-8 months, I've been writing a database from scratch.\"}),(0,n.jsx)(e.p,{children:\"As a highschool dropout, this experience has been... a lot different than what I thought it would be.\"}),(0,n.jsx)(e.p,{children:\"There are many things you pick up as part of a CS degree that (I now know) are assumed knowledge when working on databases. One of those things is the family of B-Trees.\"}),(0,n.jsx)(e.p,{children:\"Like many folks, I'm on holiday, and it's been a great time for study. Except I've grown exceedingly infuriated at my own seeming inability to do basic CS tasks. Like write a proper B+ Tree:\"}),(0,n.jsxs)(\"blockquote\",{class:\"twitter-tweet\",children:[(0,n.jsxs)(\"p\",{lang:\"en\",dir:\"ltr\",children:[(0,n.jsx)(e.p,{children:\"If anyone reads my feed and thinks:\"}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(e.p,{children:'\"Oh hey this person knows stuff\"'}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(e.p,{children:\"Here's what you don't see: I've spent the first +20 hours of my Xmas vacation trying to write a B+ Tree and ending up with... this\"}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(e.p,{children:[\"The Spaghetti Syndr... I mean, Impasta Syndrome is real \",(0,n.jsx)(\"a\",{href:\"https://t.co/qOfsy34YyS\",children:\"pic.twitter.com/qOfsy34YyS\"})]})]}),(0,n.jsx)(e.p,{children:\"\\u2014 Gavin Ray (@GavinRayDev)\"}),(0,n.jsx)(\"a\",{href:\"https://twitter.com/GavinRayDev/status/1608136367758016512?ref_src=twsrc%5Etfw\",children:(0,n.jsx)(e.p,{children:\"December 28, 2022\"})})]}),(0,n.jsx)(\"script\",{async:!0,src:\"https://platform.twitter.com/widgets.js\",charset:\"utf-8\"}),(0,n.jsx)(e.p,{children:\"My code had all the shape and feel of a tree-like structure, but it wasn't preserving the properties of a B+ Tree.\"}),(0,n.jsx)(e.p,{children:\"I was ending up with garbage, and not realizing it until I had visualized it with Graphviz! \\u{1F641}\"}),(0,n.jsx)(e.p,{children:\"Imagine if we had invariants that we could assert after every property change to the tree.\"}),(0,n.jsx)(e.p,{children:\"Below is an example of what an invariant implementation for a B-Tree data structure might look like:\"}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"BTree\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"invariant\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_node_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:`// According to Knuth's definition, a B-tree of order \"m\" is a tree which satisfies the following`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// properties:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// - Every node has at most \"m\" children.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - Every internal node has at least \\u2308m/2\\u2309 children.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - Every non-leaf node has at least two children.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - All leaves appear on the same level.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - A non-leaf node with k children contains k\\u22121 keys.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_node_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"nullptr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Every node has at most \"m\" children.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_children \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<=\"}),\" MAX_VALUES \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Every internal node has at least \\u2308m/2\\u2309 children.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is_internal\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_children \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">=\"}),\" MIN_VALUES\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Every non-leaf node has at least two children.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is_leaf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_children \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// A non-leaf node with k children contains k\\u22121 keys.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is_leaf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_children \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_values \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\" node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"num_children\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_node_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"children\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Now, assuming that this \",(0,n.jsx)(e.code,{children:\"check_invariants\"}),\" method is called any time that our B-Tree changes, we can be 100% sure that it's a proper B-Tree.\"]}),(0,n.jsx)(e.p,{children:\"Super powerful!\"}),(0,n.jsx)(e.p,{children:\"The rest of this article will walk through what it means to make this sentence come to life:\"}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:(0,n.jsxs)(e.em,{children:[\"Now, assuming that this \",(0,n.jsx)(e.code,{children:\"check_invariant\"}),\" method is called any time that our B-Tree changes...\"]})})}),(0,n.jsxs)(e.h1,{id:\"developing-the-gcc-plugin\",children:[(0,n.jsx)(e.a,{href:\"#developing-the-gcc-plugin\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Developing the GCC Plugin\"]}),(0,n.jsx)(e.p,{children:\"There are a few things to be said about developing GCC plugins:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Documentation is essentially non-existent\"}),(0,n.jsx)(e.li,{children:\"There are few people with experience working with the GCC IR API's (GIMPLE/RTL etc)\"}),(0,n.jsx)(e.li,{children:\"Most of existing plugins and examples you can find online have to do with analysis, and so show read-only usage of the API's.\"})]}),(0,n.jsx)(e.p,{children:\"The following code is cobbled together primarily from examples taken from these two blogposts:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://gabrieleserra.ml/blog/2020-08-27-an-introduction-to-gcc-and-gccs-plugins.html\",children:\"https://gabrieleserra.ml/blog/2020-08-27-an-introduction-to-gcc-and-gccs-plugins.html\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://stephanfr.blog/2013/05/19/building-gcc-plugins-part-1-c-11-generalized-attributes/\",children:\"https://stephanfr.blog/2013/05/19/building-gcc-plugins-part-1-c-11-generalized-attributes/\"})})]}),(0,n.jsxs)(e.p,{children:[\"The working code for insertion of the \",(0,n.jsx)(e.code,{children:\"check_invariants\"}),\" statements was a stroke of dumb luck after 15 hours, from one of the suggestions given by Github Copilot.\"]}),(0,n.jsxs)(e.p,{children:[\"(More on this later. I'm not fully happy with the insertion code, because it depends on implicit fallback to the \",(0,n.jsx)(e.code,{children:\"this->\"}),\" member namespace rather than an explicit call)\"]}),(0,n.jsx)(e.p,{children:\"With that said, let's begin!\"}),(0,n.jsxs)(e.h2,{id:\"setting-up\",children:[(0,n.jsx)(e.a,{href:\"#setting-up\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Setting Up\"]}),(0,n.jsxs)(e.p,{children:[\"If you're following along at home (this will be an easy one, it requires just a \",(0,n.jsx)(e.code,{children:\"CMakeLists.txt\"}),\" and a single \",(0,n.jsx)(e.code,{children:\".cpp\"}),\" file), this is the CMake definition we'll be using to build and test our plugin code:\"]}),(0,n.jsx)(e.pre,{className:\"language-cmake\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-cmake\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"project\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"gcc-invariant-plugin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_EXPORT_COMPILE_COMMANDS\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"ON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"G++_COMPILER /usr/local/gcc-dev/bin/g++\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"GCC_PLUGIN_DIR /usr/local/gcc-dev/lib/gcc/x86_64-linux-gnu/\",(0,n.jsx)(e.span,{className:\"token number\",children:\"13.0.0\"}),\"/plugin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"add_library\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"gcc-invariant-plugin \",(0,n.jsx)(e.span,{className:\"token namespace\",children:\"SHARED\"}),\" src/plugin.cpp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"target_compile_options\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"gcc-invariant-plugin \",(0,n.jsx)(e.span,{className:\"token namespace\",children:\"PRIVATE\"}),\" -fno-rtti\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"target_include_directories\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"gcc-invariant-plugin \",(0,n.jsx)(e.span,{className:\"token namespace\",children:\"PRIVATE\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),\"GCC_PLUGIN_DIR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\"/include\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy compile_commands.json to root directory if changed\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"add_custom_command\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`TARGET gcc-invariant-plugin POST_BUILD\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    COMMAND \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_COMMAND\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),` -E copy_if_different\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_CURRENT_BINARY_DIR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`/compile_commands.json\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_CURRENT_SOURCE_DIR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`/compile_commands.json\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# Command to run GCC with the build plugin using \"-fplugin=./libgcc-invariant-plugin.so\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"add_custom_target\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`run-gcc ALL\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    COMMAND \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),\"G++_COMPILER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" -fplugin=./libgcc-invariant-plugin.so -std=c++\",(0,n.jsx)(e.span,{className:\"token number\",children:\"20\"}),` -O0 -g -ggdb3 -fcontracts\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            -o \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_CURRENT_SOURCE_DIR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`/test-binary\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_CURRENT_SOURCE_DIR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`/test/test.cpp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"DEPENDS\"}),` gcc-invariant-plugin\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"WORKING_DIRECTORY\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"CMAKE_CURRENT_BINARY_DIR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"This assumes a directory layout like:\"}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 CMakeLists.txt\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 src\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 plugin.cpp\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 test\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u2514\\u2500\\u2500 test.cpp\n`})]})}),(0,n.jsxs)(e.h2,{id:\"initial-skeleton\",children:[(0,n.jsx)(e.a,{href:\"#initial-skeleton\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Initial Skeleton\"]}),(0,n.jsx)(e.p,{children:\"Now, we can mimic the structure of Gabriele's plugin, with some slight changes and using the scoped-plugin sample from Stephan's post. This is so that we can call our attribute [[demo::invariant]] to distinguish it from a language-level attribute.\"}),(0,n.jsx)(e.p,{children:\"What we want is to create a skeleton plugin that does two things:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Create a new custom attribute, \",(0,n.jsx)(e.code,{children:\"[[demo::invariant]]\"}),\" that we can use and check for the existence of\"]}),(0,n.jsx)(e.li,{children:`Hook into the parsing of struct/class member functions, and performs some \"Hello-world\" like behavior to check that it's working as intended`})]}),(0,n.jsxs)(e.p,{children:[\"With these two things, we would have much of the ingredients needed for adding \",(0,n.jsx)(e.code,{children:\"invariant\"}),\" support to C++!\"]}),(0,n.jsx)(e.p,{children:\"To do this, looks something like the below:\"}),(0,n.jsx)(e.ol,{children:(0,n.jsx)(e.li,{children:\"First, we include some order-sensitive (hooray!) headers:\"})}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// These includes are order-sensitive. GCC, am I right?...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// clang-format off\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<gcc-plugin.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<context.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<plugin-version.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<tree.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<gimple.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<tree-pass.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<attribs.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<tree-pretty-print.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<plugin.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<cp/cp-tree.h>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// clang-format on\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"2\",children:(0,n.jsx)(e.li,{children:\"Next, we define some general configuration settings for our plugin:\"})}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"namespace\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// GCC PLUGIN SETUP (BASIC INFO / LICENSE / REQUIRED VERSION)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" DEBUG \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" ATTRIBUTE_NAME   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"invariant\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" PLUGIN_VERSION   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"0.1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" PLUGIN_HELP      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"This plugin instruments functions with the invariant attribute\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" PLUGIN_NAME      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"invariant_plugin\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" PLUGIN_GCC_BASEV \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"13.0.0\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Additional information about the plugin. Used by --help and --version\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"plugin_info\"}),\" invariant_plugin_info \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"version \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PLUGIN_VERSION\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"help    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PLUGIN_HELP\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Represents the gcc version we need. Used to void using an incompatible plugin\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"plugin_gcc_version\"}),\" invariant_plugin_version \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"basever \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PLUGIN_GCC_BASEV\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// namespace\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"3\",children:(0,n.jsxs)(e.li,{children:[\"We define the configuration and callback handlers for a custom \",(0,n.jsx)(e.code,{children:\"[[demo::invariant]]\"}),\" attribute (this does not register the attribute yet)\"]})}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"namespace\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// <...>\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// GCC ATTRIBUTES MANAGEMENT (REGISTERING / CALLBACKS)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Attribute handler callback\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @see Declared in tree-core.h\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`tree\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"handle_invariant_attribute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tree\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tree name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tree args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" flags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"bool\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" no_add_attrs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"DEBUG \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"> Found attribute\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\tnode = \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"print_generic_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" TDF_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\tname = \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"print_generic_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" TDF_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" NULL_TREE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Structure describing an attribute and a function to handle it\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @see Declared in tree-core.h\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @note Refer to tree-core for docs about\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"/* Attribute definition */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"attribute_spec\"}),\" invariant_attribute \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// [[demo::invariant]]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"invariant\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"min_length             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"max_length             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decl_required          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"type_required          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"function_type_required \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"affects_type_identity  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"handler                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" handle_invariant_attribute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"exclude                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"nullptr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// The array of attribute specs passed to register_scoped_attributes must be NULL terminated\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" attribute_spec scoped_attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  invariant_attribute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Plugin callback called during attribute registration\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"register_attributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" event_data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"warning\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Callback to register attributes\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"register_scoped_attributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"scoped_attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"demo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// namespace\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"4\",children:(0,n.jsxs)(e.li,{children:[\"We define the configuration and handler for a GIMPLE pass, which we will eventually use to insert calls to the \",(0,n.jsx)(e.code,{children:\"[[demo::invariant]]\"}),\"-marked function. For now, it only prints out the name of member functions which should be processed.\"]})}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"namespace\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// <...>\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// PLUGIN INSTRUMENTATION LOGIC\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * For each function lookup attributes and insert invariant function calls\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"instrument_invariants_plugin_exec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// get the FUNCTION_DECL of the function whose body we are reading\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  tree fndecl \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" current_function_decl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// print the function name\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"> Inspecting function '%s'\\\\n\"`}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"IDENTIFIER_POINTER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// If the method is not a member of a struct/class, then skip it.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TREE_CODE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_CONTEXT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" RECORD_TYPE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t - Found a member function of a struct/class\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Metadata for a pass, non-varying across all instances of a pass\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @see Declared in tree-pass.h\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @note Refer to tree-pass for docs about\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"pass_data\"}),\" invariant_pass_data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"type                 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" GIMPLE_PASS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"     \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// type of pass\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name                 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PLUGIN_NAME\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"     \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// name of plugin\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"optinfo_flags        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" OPTGROUP_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"   \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no opt dump\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tv_id                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" TV_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"         \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no timevar (see timevar.h)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"properties_required  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PROP_gimple_any\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// entire gimple grammar as input\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"properties_provided  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"               \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no prop in output\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"properties_destroyed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"               \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no prop removed\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo_flags_start     \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"               \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// need nothing before\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo_flags_finish \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    TODO_update_ssa \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" TODO_cleanup_cfg     \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// need to update SSA repr after and repair cfg\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Definition of our invariant GIMPLE pass\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @note Extends gimple_opt_pass class\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * @see Declared in tree-pass.h\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"invariant_gimple_pass\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token base-clause\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"gimple_opt_pass\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`   * Constructor\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"   */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"invariant_gimple_pass\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" pass_data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\" data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gcc\",(0,n.jsx)(e.span,{className:\"token punctuation double-colon\",children:\"::\"}),\"context\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" ctxt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gimple_opt_pass\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ctxt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`   * This is the code to run when pass is executed\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`   * @note Defined in opt_pass father class\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`   * @see Defined in tree-pass.h\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"   */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"execute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"function\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" exec_fun\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"instrument_invariants_plugin_exec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// namespace\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"5\",children:(0,n.jsxs)(e.li,{children:[\"Finally, we define the entry point for the plugin, \",(0,n.jsx)(e.code,{children:\"plugin_init\"}),\", which is called by GCC when the plugin is loaded. We register the attribute and the GIMPLE pass.\"]})}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// PLUGIN INITIALIZATION\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// -----------------------------------------------------------------------------\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" plugin_is_GPL_compatible\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Initializes the plugin. Returns 0 if initialization finishes successfully.\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"plugin_init\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"plugin_name_args\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" plugin_info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" plugin_gcc_version\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"plugin_default_version_check\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"gcc_version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"register_callback\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"plugin_info\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"base_name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PLUGIN_INFO\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"invariant_plugin_info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:`\"> plugin '%s @ %s' was loaded onto GCC\\\\n\"`}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PLUGIN_NAME\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PLUGIN_VERSION\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  register_pass_info invariant_pass \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pass                     \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"invariant_gimple_pass\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_pass_data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" g\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"reference_pass_name      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"ssa\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// get called after GCC has produced SSA representation\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ref_pass_instance_number \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"     \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// after first opt pass to be sure opt will not throw away\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pos_op                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PASS_POS_INSERT_AFTER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"register_callback\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"plugin_info\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"base_name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PLUGIN_PASS_MANAGER_SETUP\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"invariant_pass\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"register_callback\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"plugin_info\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"base_name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PLUGIN_ATTRIBUTES\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" register_attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"testing-the-skeleton\",children:[(0,n.jsx)(e.a,{href:\"#testing-the-skeleton\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing the Skeleton\"]}),(0,n.jsx)(e.p,{children:\"Now that we have the bare-bones outline of the plugin, lets create a test-case file that we'll use throughout the rest of this post, and run the plugin against it.\"}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// test/test.cpp\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<cassert>\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token property macro\",children:[(0,n.jsx)(e.span,{className:\"token directive-hash\",children:\"#\"}),(0,n.jsx)(e.span,{className:\"token keyword directive\",children:\"include\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"<iostream>\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Stack\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"constexpr\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" MAX_SIZE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" old_top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"MAX_SIZE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"demo\",(0,n.jsx)(e.span,{className:\"token punctuation double-colon\",children:\"::\"}),\"invariant\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// I know this invariant/assertion is useless in combination with the [[pre]]/[[post]] conditions\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// I just wanted to show a combination use of [[invariant]] and [[pre]]/[[post]] con\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<=\"}),\" MAX_SIZE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"bool\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"empty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"bool\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"full\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" MAX_SIZE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pre\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"full\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"post\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" old_top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"top\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    old_top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" top\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"pop\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pre\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"empty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"post\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" old_top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    old_top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" top\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"--\"}),\"top\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Stack stack\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    stack\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    std\",(0,n.jsx)(e.span,{className:\"token punctuation double-colon\",children:\"::\"}),\"cout \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<<\"}),\" stack\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"pop\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<<\"}),\" std\",(0,n.jsx)(e.span,{className:\"token punctuation double-colon\",children:\"::\"}),\"endl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"If we run \",(0,n.jsx)(e.code,{children:\"cmake --build ./build --target run-test\"}),\" we should see:\"]}),(0,n.jsx)(e.pre,{className:\"language-cmake\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-cmake\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] <built-in\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),`: warning: Callback to register attributes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Found attribute\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \tnode = check_invariants\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \tname = invariant\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'push'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'empty'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'full'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'push'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function '__ct_base '\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t - Found a member function of a struct/class\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'main'\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),\" plugin 'invariant_plugin @ \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.1\"}),`' was loaded onto GCC\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] [\",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\"/\",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`] cd /home/user/projects/gcc-invariant-plugin/build/default && /home/user/projects/gcc-invariant-plugin/test-binary\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token number\",children:\"99\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token number\",children:\"98\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] Build finished with exit code \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Hooray!\"}),(0,n.jsxs)(e.h3,{id:\"implementing-the-invariant-call-code-generation\",children:[(0,n.jsx)(e.a,{href:\"#implementing-the-invariant-call-code-generation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Implementing the [[invariant]] call code-generation\"]}),(0,n.jsxs)(e.p,{children:[\"Now, we need to implement the logic to to insert calls to the member function marked \",(0,n.jsx)(e.code,{children:\"[[demo::invariant]]\"}),\" (if any exists) in all other member functions of any class/struct which contains an invariant function.\"]}),(0,n.jsx)(e.p,{children:\"There are a few nuances to this:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"We don't want to insert at the \",(0,n.jsx)(e.em,{children:\"beginning\"}),\" of constructors, because fields won't have been initialized yet.\"]}),(0,n.jsxs)(e.li,{children:[\"We don't want to insert calls at the \",(0,n.jsx)(e.em,{children:\"end\"}),\" of destructors, because fields will have been destroyed\"]}),(0,n.jsx)(e.li,{children:\"There are probably others I haven't thought about\"})]}),(0,n.jsxs)(e.p,{children:[\"But other than that, I've implemented it as inserting at both the beginning and end of the function (before the \",(0,n.jsx)(e.code,{children:\"return\"}),\", if it exists)\"]}),(0,n.jsx)(e.p,{children:\"Below is the code to do this:\"}),(0,n.jsxs)(\"details\",{children:[(0,n.jsx)(\"summary\",{children:\"\\u{1F447} CLICK TO EXPAND CODE \\u{1F447}\"}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsxs)(e.code,{className:\"language-cpp code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"instrument_invariants_plugin_exec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// get the FUNCTION_DECL of the function whose body we are reading\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  tree fndecl \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" current_function_decl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// print the function name\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"> Inspecting function '%s'\\\\n\"`}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"FN_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// If the method is not a member of a struct/class, then skip it.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TREE_CODE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_CONTEXT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" RECORD_TYPE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Try to locate the [[invariant]] function\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  tree invariant_fn \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" NULL_TREE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Iterate over every member function of the class\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tree f \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"TYPE_FIELDS\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_FIELD_CONTEXT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" f \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" NULL_TREE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" f \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_CHAIN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TREE_CODE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" FUNCTION_DECL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Check if the function has an [[invariant]] attribute\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      tree attrs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_ATTRIBUTES\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tree attr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" attrs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" attr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"nullptr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" attr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"TREE_CHAIN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"attr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Check if attribute name is \"invariant\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get_attribute_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"attr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get_identifier\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"invariant\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          invariant_fn \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_fn \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" NULL_TREE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// If the method name is the same as the [[invariant]] attribute function, then skip it.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_fn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// attribute was in the list\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t attribute %s found! \\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ATTRIBUTE_NAME\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// get function entry block\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  basic_block entry \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"ENTRY_BLOCK_PTR_FOR_FN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cfun\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"next_bb\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"auto\"}),\" insert_invariant_calls_intelligently \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// get the first statement\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    gimple\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" first_stmt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_start_bb\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"entry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Skip if this is a constructor, because fields will not be initialized yet\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_CONSTRUCTOR_P\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t skipping constructor start invariant call\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// warn the user we are adding an invariant function\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t adding function call before \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"print_gimple_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" first_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" TDF_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Insert the invariant call before the current statement\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    gimple_stmt_iterator gsi \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_for_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"first_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_insert_before\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"gsi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gimple_build_call\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_fn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" GSI_SAME_STMT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Skip if destructor, because fields will have been destroyed already\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DECL_DESTRUCTOR_P\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fndecl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t skipping destructor end invariant call\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Insert the invariant call at the end of the function, or before the return statement (if\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// any)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    gimple_stmt_iterator gsi2      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_last_bb\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ENTRY_BLOCK_PTR_FOR_FN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cfun\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"next_bb\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    gimple\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"              last_stmt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"gsi2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Double check to ensure that the last_stmt != first_stmt\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"first_stmt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" last_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t first and last statement are the same, skipping last statement\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// If the last statement is a return statement, then insert before it\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"gimple_code\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"last_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" GIMPLE_RETURN\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t adding function call before \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"print_gimple_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" last_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" TDF_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_insert_before\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"gsi2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gimple_build_call\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_fn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" GSI_SAME_STMT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fprintf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\t adding function call after \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"print_gimple_stmt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"stderr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" last_stmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" TDF_NONE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gsi_insert_after\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"gsi2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"gimple_build_call\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"invariant_fn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" GSI_SAME_STMT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Insert the invariant function calls at the beginning/end of fn bodies based on\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// certain conditions (whether it's a ctor/dtor, etc.)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"insert_invariant_calls_intelligently\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// done!\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})})]}),(0,n.jsxs)(e.h3,{id:\"testing-again-violating-invariants\",children:[(0,n.jsx)(e.a,{href:\"#testing-again-violating-invariants\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing again, violating invariants\"]}),(0,n.jsx)(e.p,{children:\"If we modify our test code so that the invariant is violated:\"}),(0,n.jsx)(e.pre,{className:\"language-cpp\",children:(0,n.jsx)(e.code,{className:\"language-cpp code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"check_invariants\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" top \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"And then re-compile with our plugin:\"}),(0,n.jsx)(e.pre,{className:\"language-cmake\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-cmake\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] <built-in\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),`: warning: Callback to register attributes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Found attribute\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \tnode = check_invariants\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \tname = invariant\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'push'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before retval.1_4 = \",(0,n.jsx)(e.span,{className:\"token class-name inserted\",children:\"Stack::full\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"this_2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call after \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"retval.1_4 != \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before retval.2_4 = \",(0,n.jsx)(e.span,{className:\"token class-name inserted\",children:\"Stack::empty\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"this_2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call after \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"retval.2_4 != \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before _1 = \",(0,n.jsx)(e.span,{className:\"token function\",children:\"this_5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\"-\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),`top;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call after \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"_1 != _3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'check_invariants'\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'empty'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before _1 = \",(0,n.jsx)(e.span,{className:\"token function\",children:\"this_3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\"-\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),`top;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call after _4 = _1 == \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'full'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before _1 = \",(0,n.jsx)(e.span,{className:\"token function\",children:\"this_3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\"-\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),`top;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call after _4 = _1 == \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),`;\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'push'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before \",(0,n.jsx)(e.span,{className:\"token class-name inserted\",children:\"Stack::push\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"this_7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\", \",(0,n.jsx)(e.span,{className:\"token function\",children:\"value_8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`;\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t adding function call before return;\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'pop'\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \t adding function call before \",(0,n.jsx)(e.span,{className:\"token class-name inserted\",children:\"Stack::pop\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"this_7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"D\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`;\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t adding function call after _13 = _12;\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function '__ct_base '\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t attribute invariant found!\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[build] \t skipping constructor start invariant call\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),` Inspecting function 'main'\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"[build] \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),\" plugin 'invariant_plugin @ \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.1\"}),`' was loaded onto GCC\n`]})]})}),(0,n.jsx)(e.p,{children:\"And run the test program, we should see:\"}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight language-sh\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`[user@MSI gcc-invariant-plugin]$ ./test-binary\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"test-binary: /home/user/projects/gcc-invariant-plugin/test/test.cpp:13: void Stack::check_invariants(): Assertion `top >= 0 && top <= 50' failed.\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Aborted\n`})]})}),(0,n.jsx)(e.p,{children:\"Et-voila! We've done it!\"}),(0,n.jsxs)(e.h3,{id:\"checking-the-codegen-in-ghidra\",children:[(0,n.jsx)(e.a,{href:\"#checking-the-codegen-in-ghidra\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Checking the codegen in Ghidra\"]}),(0,n.jsx)(e.p,{children:\"To be sure things have come out right, we can take a look at the compiled code in something like Ghidra.\"}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"Note: this is stepping outside of my forte, so there might be easier ways of doing this.\"})}),(0,n.jsxs)(e.p,{children:[\"Opening \",(0,n.jsx)(e.code,{children:\"test-binary\"}),\" in Ghidra, and checking the primary definition of \",(0,n.jsx)(e.code,{children:\"Stack.push()\"}),\" (note that the pre/post contracts will also generate function entries) we should see the below:\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"ghidra-stack-push-code\",src:\"/static/images/ghidra-check-invariants.png\"})}),(0,n.jsxs)(e.h1,{id:\"conclusions\",children:[(0,n.jsx)(e.a,{href:\"#conclusions\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusions\"]}),(0,n.jsx)(e.p,{children:\"So we have a plugin, and it technically works, and that's cool. Sweet!\"}),(0,n.jsx)(e.p,{children:\"But remember when I said above:\"}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"... I'm not fully happy with the insertion code, because it depends on implicit fallback to the \",(0,n.jsx)(e.code,{children:\"this->\"}),\" member namespace rather than an explicit call\"]})}),(0,n.jsx)(e.p,{children:\"With the current state of the plugin code, I'm still not fully satisfied with the GIMPLE calls used to invoke the invariant method.\"}),(0,n.jsxs)(e.p,{children:[\"I don't pretend to be an expert on C++. I \",(0,n.jsx)(e.em,{children:\"think\"}),\" letting it look up the invariant function in the current scope/context is fine.\"]}),(0,n.jsxs)(e.p,{children:[\"But what it \",(0,n.jsx)(e.em,{children:\"should\"}),\" do is form an explicit member-function call to \",(0,n.jsx)(e.code,{children:\"this->check_invariant();\"}),\", which I burned some ~8 hours on trying to figure out.\"]}),(0,n.jsxs)(e.h2,{id:\"a-request-for-help\",children:[(0,n.jsx)(e.a,{href:\"#a-request-for-help\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"A Request for Help\"]}),(0,n.jsx)(e.p,{children:\"If anyone knows how to do this, please let me know. Submit an issue/PR, or reach out via email/Twitter.\"}),(0,n.jsx)(e.p,{children:\"I submitted questions to StackOverflow, reached out on the GCC mailing list, and even had a chat with Iain Buclaw, the maintainer of GDC (the D-language frontend for GCC).\"}),(0,n.jsxs)(e.p,{children:[\"Iain got me going down the right path I think, which I am pretty sure involves a combination of \",(0,n.jsx)(e.code,{children:\"lookup_member()\"}),\" and \",(0,n.jsx)(e.code,{children:\"build_new_method_call()\"}),\", but I've not gotten it to work.\"]}),(0,n.jsx)(e.p,{children:\"All the details are here in case anyone's interested in pursuing it further:\"}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://stackoverflow.com/questions/74964153/gcc-gimple-c-api-how-to-insert-a-call-to-a-member-function-from-another-membe\",children:\"https://stackoverflow.com/questions/74964153/gcc-gimple-c-api-how-to-insert-a-call-to-a-member-function-from-another-membe\"})})}),(0,n.jsxs)(e.h1,{id:\"thanks--acknowledgement\",children:[(0,n.jsx)(e.a,{href:\"#thanks--acknowledgement\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Thanks & Acknowledgement\"]}),(0,n.jsx)(e.p,{children:\"I'd like to thank the following people:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Iain Buclaw, for letting me bug him, and just generally maintaining the GDC compiler and helping with release management + infrastructure.\"}),(0,n.jsxs)(e.li,{children:[\"The authors of these two blogposts:\",(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://gabrieleserra.ml/blog/2020-08-27-an-introduction-to-gcc-and-gccs-plugins.html\",children:\"https://gabrieleserra.ml/blog/2020-08-27-an-introduction-to-gcc-and-gccs-plugins.html\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://stephanfr.blog/2013/05/19/building-gcc-plugins-part-1-c-11-generalized-attributes/\",children:\"https://stephanfr.blog/2013/05/19/building-gcc-plugins-part-1-c-11-generalized-attributes/\"})})]})]})]}),(0,n.jsxs)(e.h1,{id:\"attribution\",children:[(0,n.jsx)(e.a,{href:\"#attribution\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Attribution\"]}),(0,n.jsx)(e.p,{children:`I \"borrowed\" the image in the OpenGraph metadata tag from the below blogpost, which is well-written and worth the read. I couldn't find any information on the page on whether it was copyright protected.`}),(0,n.jsx)(e.p,{children:\"Hopefully the author doesn't mind, if they do I'll remove it!\"}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://dominikberner.ch/design-by-contract-en/\",children:\"https://dominikberner.ch/design-by-contract-en/\"})})})]})}}var w=_;function y(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"Preface","url":"#preface","depth":1},{"value":"A compelling usecase","url":"#a-compelling-usecase","depth":1},{"value":"Developing the GCC Plugin","url":"#developing-the-gcc-plugin","depth":1},{"value":"Setting Up","url":"#setting-up","depth":2},{"value":"Initial Skeleton","url":"#initial-skeleton","depth":2},{"value":"Testing the Skeleton","url":"#testing-the-skeleton","depth":3},{"value":"Implementing the [[invariant]] call code-generation","url":"#implementing-the-invariant-call-code-generation","depth":3},{"value":"Testing again, violating invariants","url":"#testing-again-violating-invariants","depth":3},{"value":"Checking the codegen in Ghidra","url":"#checking-the-codegen-in-ghidra","depth":3},{"value":"Conclusions","url":"#conclusions","depth":1},{"value":"A Request for Help","url":"#a-request-for-help","depth":2},{"value":"Thanks & Acknowledgement","url":"#thanks--acknowledgement","depth":1},{"value":"Attribution","url":"#attribution","depth":1}],"frontMatter":{"readingTime":{"text":"27 min read","minutes":26.065,"time":1563900,"words":5213},"slug":"adding-invariant-to-cpp-design-by-contract","fileName":"adding-invariant-to-cpp-design-by-contract.mdx","title":"Adding Design-by-Contract [[invariant]] conditions to C++, via a GCC plugin","date":"2022-12-31T00:00:00.000Z","tags":["cpp","gcc","design-by-contract"],"draft":false,"summary":"Design-by-Contract's invariant attribute allows you to enforce important properties of systems and data structures, making it an incredibly useful tool for developers. In this blog post, we'll be exploring the development of a GCC plugin that adds support for [[invariant]] conditions in C++ classes and structs. We'll also be looking at an example of how invariant can be used to improve the integrity of a Stack data structure. This is especially timely as GCC has recently added support for Contracts, allowing you to annotate functions with pre/post conditions. Don't miss out on learning how to use this powerful feature in your own projects!\n","images":["/static/images/design-by-contract-logo.png"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.23,"time":13800,"words":46},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"A Day Without a Copilot: Reflections on Copilot-Driven Development","date":"2022-12-05T00:00:00.000Z","tags":["github-copilot","machine-learning","non-technical"],"draft":false,"summary":"A reflection on the impact of language models like Github Copilot on the experience on authoring software and the role of the developer","images":["https://camo.githubusercontent.com/b22c603c99f2733ff060b01d4b184a2504e3f4b089cd8a8b113884f7b85a4782/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f70726163746963616c6465762f696d6167652f66657463682f732d2d70454d3650587a582d2d2f635f696d616767615f7363616c652c665f6175746f2c666c5f70726f67726573736976652c685f3432302c715f6175746f2c775f313030302f68747470733a2f2f6465762d746f2d75706c6f6164732e73332e616d617a6f6e6177732e636f6d2f75706c6f6164732f61727469636c65732f36336d347072357a6e7a667172716c776e33396b2e706e67"],"slug":"a-day-without-a-copilot"},"next":null},"__N_SSG":true}