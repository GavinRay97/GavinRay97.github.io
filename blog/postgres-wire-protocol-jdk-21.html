<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21</title><meta name="robots" content="follow, index"/><meta name="description" content="A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function &amp; Memory API.
"/><meta property="og:url" content="https://gavinray97.github.io/blog/postgres-wire-protocol-jdk-21"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Gavin Ray Blog"/><meta property="og:description" content="A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function &amp; Memory API.
"/><meta property="og:title" content="Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21"/><meta property="og:image" content="https://gavinray97.github.io/static/images/postgres-wire-protocol-display-image.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/GavinRayDev"/><meta name="twitter:title" content="Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21"/><meta name="twitter:description" content="A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function &amp; Memory API.
"/><meta name="twitter:image" content="https://gavinray97.github.io/static/images/postgres-wire-protocol-display-image.png"/><link rel="canonical" href="https://gavinray97.github.io/blog/postgres-wire-protocol-jdk-21"/><meta property="article:published_time" content="2023-01-16T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gavinray97.github.io/blog/postgres-wire-protocol-jdk-21"
  },
  "headline": "Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/postgres-wire-protocol-display-image.png"
    }
  ],
  "datePublished": "2023-01-16T00:00:00.000Z",
  "dateModified": "2023-01-16T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Gavin Ray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Gavin Ray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/logo.png"
    }
  },
  "description": "A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function & Memory API.\n"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/11bf37f52e8561b6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11bf37f52e8561b6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bdcdf64985b3467.js" defer=""></script><script src="/_next/static/chunks/main-bb8a1082161dc7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-da15d2a3f366f449.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-dd685ae53e609b20.js" defer=""></script><script src="/_next/static/chunks/620-407ce78f2f46843c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-52c7b4963ecd0646.js" defer=""></script><script src="/_next/static/DWSLCyuJr0RZE9vUMLx8-/_buildManifest.js" defer=""></script><script src="/_next/static/DWSLCyuJr0RZE9vUMLx8-/_ssgManifest.js" defer=""></script><script src="/_next/static/DWSLCyuJr0RZE9vUMLx8-/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="" href="/"><div class="flex items-center justify-between"><div class="mr-3"></div><div class="hidden h-6 text-2xl font-semibold sm:block"></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-01-16T00:00:00.000Z">Monday, January 16, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/me.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Gavin Ray</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@GavinRayDev</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li><a href="#outline">Outline</a></li><li><a href="#introduction-to-the-postgresql-wire-protocol">Introduction to the PostgreSQL Wire Protocol</a></li><li><a href="#step-1-doing-the-simplest-thing-that-could-possibly-work-tm">Step 1: Doing The Simplest Thing That Could Possibly Work (TM)</a><ul><li style="margin-left:24px"><a href="#step-11---initial-server-skeleton">Step 1.1 - Initial Server Skeleton</a><ul><li style="margin-left:48px"><a href="#connecting-to-the-server-with-psql">Connecting to the Server with psql</a></li></ul></li><li style="margin-left:24px"><a href="#step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message">Step 1.2 - Responding to the SSL Negotiation message and the Startup Message</a></li><li style="margin-left:24px"><a href="#step-13---differentiating-between-the-sslauthentication-request-and-command-messages">Step 1.3 - Differentiating between the SSL/Authentication request, and Command messages</a></li><li style="margin-left:24px"><a href="#step-14---handle-a-query-and-return-data-rows">Step 1.4 - Handle a query and return data rows</a></li></ul></li><li><a href="#step-2-refactoring">Step 2: Refactoring</a><ul><li style="margin-left:24px"><a href="#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side">Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 1. Client Side)</a></li><li style="margin-left:24px"><a href="#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side">Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 2. Server Side)</a></li></ul></li></ul></div></details><hr/><p>This tutorial is meant to serve as a dual purpose guide:</p><ul><li>Demonstrate how to implement the <a target="_blank" rel="noopener noreferrer" href="https://www.postgresql.org/docs/current/protocol-flow.html#id-1.10.6.7.4">Simple Query Protocol</a>, where Java is an implementation detail</li><li>Show practical examples of most of the new features since JDK 17, including:<ul><li>Records (JEP 395)</li><li>Sealed Types (JEP 360/JEP 409)</li><li>Pattern Matching for Switch (JEP 406)</li><li>Virtual Threads aka Project Loom (JEP 425)</li><li>Foreign-Function &amp; Memory API (FMM) aka Project Panama (JEP 424)</li><li>(Also give a practical example of <code>java.nio</code>&#x27;s <code>AsynchronousChannelGroup</code> and <code>AsynchronousServerSocketChannel</code>, for which there are few examples online)</li></ul></li></ul><h1 id="outline"><a href="#outline" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Outline</h1><p>This tutorial will be broken up into a series of 2 parts:</p><ol><li><p>Because we are diligent coders who know to Do The Simplest Thing That Could Possibly Workâ„¢, our first step will be an horrifically ugly, but functional, implementation of the PostgreSQL wire protocol server.</p></li><li><p>Then, we will refactor our code to be more readable and maintainable.</p></li></ol><h1 id="introduction-to-the-postgresql-wire-protocol"><a href="#introduction-to-the-postgresql-wire-protocol" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Introduction to the PostgreSQL Wire Protocol</h1><p>The PostgreSQL wire protocol is a binary protocol that is used to communicate between a PostgreSQL client and server.</p><p>The protocol is documented in the <a target="_blank" rel="noopener noreferrer" href="https://www.postgresql.org/docs/current/protocol.html">PostgreSQL Protocol Documentation</a>.</p><p>In my opinion, this documentation is not the most understandable. If you want to learn more about the protocol, I recommend the following presentation:</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://beta.pgcon.org/2014/schedule/attachments/330_postgres-for-the-wire.pdf">https://beta.pgcon.org/2014/schedule/attachments/330_postgres-for-the-wire.pdf</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=qa22SouCr5E">https://www.youtube.com/watch?v=qa22SouCr5E</a></li></ul><p>What we&#x27;re concerned with today, is primarily the following pieces of information:</p><ul><li>Postgres clients send two types of message to the server: <strong>Startup Messages</strong> and <strong>Commands</strong></li><li>Optionally, the Startup message can be preceded by an <strong>SSL Negotiation</strong> message, where the client asks the server if it supports SSL</li></ul><p>Visualized as a Mermaid diagram:</p><p><a target="_blank" rel="noopener noreferrer" href="https://mermaid.live/edit#pako:eNp9kT9vAjEMxb9K5BnEnoGqBXVpoaI3IWWxEvca3eUPOafSCfHdCYROVZol1svP71nOGXQwBBImOmXymrYW-4ROeVFOxMRW24iexWa05Pmv3lH6oVT1yojlev2Qpei6d7GnPrBFtsE_VbC-iuWNrE1SHFf7tguXxBzFjqYJe2qbPGf-LoXV97SPoU2-oB7Imzeat8jYTN4E59Cbts8DKFccif8Z7ZPQzK8hHTKlGRbgKDm0puz-fGtSUCZ3pECW0mAaFCh_KRxmDt3sNUhOmRaQo0H-_SeQXzhOdLkCWvyWwA"><img alt="" src="https://mermaid.ink/img/pako:eNp9kT9vAjEMxb9K5BnEnoGqBXVpoaI3IWWxEvca3eUPOafSCfHdCYROVZol1svP71nOGXQwBBImOmXymrYW-4ROeVFOxMRW24iexWa05Pmv3lH6oVT1yojlev2Qpei6d7GnPrBFtsE_VbC-iuWNrE1SHFf7tguXxBzFjqYJe2qbPGf-LoXV97SPoU2-oB7Imzeat8jYTN4E59Cbts8DKFccif8Z7ZPQzK8hHTKlGRbgKDm0puz-fGtSUCZ3pECW0mAaFCh_KRxmDt3sNUhOmRaQo0H-_SeQXzhOdLkCWvyWwA?type=png"/></a></p><p>There are many types of commands, but today we&#x27;ll only be concerned with the <strong>Query</strong> command, which is used to execute a SQL query.</p><p>Knowing this, we can now start implementing our server.</p><h1 id="step-1-doing-the-simplest-thing-that-could-possibly-work-tm"><a href="#step-1-doing-the-simplest-thing-that-could-possibly-work-tm" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1: Doing The Simplest Thing That Could Possibly Work (TM)</h1><p>We&#x27;ll begin by implementing a basic <code>java.nio.channels.AsynchronousServerSocketChannel</code> server, which will accept connections and print out the messages it receives:</p><h2 id="step-11---initial-server-skeleton"><a href="#step-11---initial-server-skeleton" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1.1 - Initial Server Skeleton</h2><p>Below is the initial skeleton of our server.</p><ul><li>We create a <code>java.nio.channels.AsynchronousServerSocketChannel</code> and bind it to <code>localhost</code> and the default Postgres port (<code>5432</code>).</li><li>An <code>ExecutorService</code> is created, which will be used to create a <code>java.nio.channels.AsynchronousChannelGroup</code> for our server.</li><li>We use the <code>newVirtualThreadPerTaskExecutor</code> method, which will create a new Loom <code>Virtual Thread</code> for the server thread pool.</li><li>Then, we accept connections and print out the messages we receive.</li></ul><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token keyword">package</span> <span class="token namespace">postgres<span class="token punctuation">.</span>wire<span class="token punctuation">.</span>protocol</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">AsynchronousChannelGroup</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">AsynchronousServerSocketChannel</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">AsynchronousSocketChannel</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">CompletionHandler</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">AsynchronousSocketServer</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> HOST <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PORT <span class="token operator">=</span> <span class="token number">5432</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newVirtualThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">AsynchronousChannelGroup</span> group <span class="token operator">=</span> <span class="token class-name">AsynchronousChannelGroup</span><span class="token punctuation">.</span><span class="token function">withThreadPool</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">AsynchronousServerSocketChannel</span> server <span class="token operator">=</span> <span class="token class-name">AsynchronousServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            server<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Listening on &quot;</span> <span class="token operator">+</span> HOST <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AsynchronousSocketChannel</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token class-name">AsynchronousSocketChannel</span> client <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Accepted connection from &quot;</span> <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token punctuation annotation">@Override</span>
</span><span class="code-line">                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                        attachment<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                            <span class="token function">onMessageReceived</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                        <span class="token punctuation">}</span>
</span><span class="code-line">                        attachment<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                        client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>attachment<span class="token punctuation">,</span> attachment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">                    <span class="token punctuation annotation">@Override</span>
</span><span class="code-line">                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Failed to read from client: &quot;</span> <span class="token operator">+</span> exc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                        exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    <span class="token punctuation">}</span>
</span><span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Received message from client: &quot;</span> <span class="token operator">+</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Buffer: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">MainSimplest</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">AsynchronousSocketServer</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>If we start this up, we should see:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">Running Gradle on WSL<span class="token punctuation">..</span>.
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">&gt;</span> Task :app:compileJava
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">&gt;</span> Task :app:processResources NO-SOURCE
</span><span class="code-line">Note: Some input files use preview features of Java SE <span class="token number">21</span>.
</span><span class="code-line">Note: Recompile with -Xlint:preview <span class="token keyword">for</span> details.
</span><span class="code-line"><span class="token operator">&gt;</span> Task :app:classes
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">&gt;</span> Task :app:MainSimplestWalkThrough.main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Listening on localhost:5432
</span></code></pre></div><h3 id="connecting-to-the-server-with-psql"><a href="#connecting-to-the-server-with-psql" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Connecting to the Server with <code>psql</code></h3><p>Now, we can connect to our server using <code>psql</code>:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ psql -h localhost -p <span class="token number">5432</span> -U postgres
</span></code></pre></div><p>We should see <code>psql</code> hang at the prompt, and the server should print out the following:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Accepted connection from /127.0.0.1:41826
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:41826<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span></code></pre></div><p>Great! We&#x27;re now able to receive messages from the client.</p><h2 id="step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message"><a href="#step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1.2 - Responding to the SSL Negotiation message and the Startup Message</h2><p>What we want to do is just make sure that we&#x27;re able to receive messages from the client, and respond to the:</p><ul><li>Initial SSL Negotiation message with a <code>&#x27;N&#x27;</code> byte (for No)</li><li>Startup Message with an <code>AuthenticationOk</code> message</li></ul><p>Finally, we&#x27;ll write a:</p><ul><li><code>BackendKeyData</code> message, which is used to identify the connection to the client</li><li><code>ReadyForQuery</code> message, which indicates that the server is ready to accept commands.</li></ul><p>Below is the updated code:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Received message from client: &quot;</span> <span class="token operator">+</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Buffer: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// First, write &#x27;N&#x27; for SSL negotiation</span>
</span><span class="code-line">        <span class="token class-name">ByteBuffer</span> response <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        response<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;N&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        response<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Then, write AuthenticationOk</span>
</span><span class="code-line">        <span class="token class-name">ByteBuffer</span> authOk <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        authOk<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;R&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;R&#x27; for AuthenticationOk</span>
</span><span class="code-line">        authOk<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">        authOk<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AuthenticationOk</span>
</span><span class="code-line">        authOk<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>authOk<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Then, write BackendKeyData</span>
</span><span class="code-line">        <span class="token class-name">ByteBuffer</span> backendKeyData <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        backendKeyData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;K&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Message type</span>
</span><span class="code-line">        backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Message length</span>
</span><span class="code-line">        backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Process ID</span>
</span><span class="code-line">        backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5678</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Secret key</span>
</span><span class="code-line">        backendKeyData<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>backendKeyData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Then, write ReadyForQuery</span>
</span><span class="code-line">        <span class="token class-name">ByteBuffer</span> readyForQuery <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;Z&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;Z&#x27; for ReadyForQuery</span>
</span><span class="code-line">        readyForQuery<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">        readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;I&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Transaction status indicator, &#x27;I&#x27; for idle</span>
</span><span class="code-line">        readyForQuery<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>readyForQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">            writeResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Failed to write to client: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>From this point on, it&#x27;ll be useful to be able to visualize the messages that we&#x27;re sending and receiving.</p><p>There are a few tools that you can use to do this:</p><ul><li>Wireshark/tshark<ul><li><a target="_blank" rel="noopener noreferrer" href="https://zignar.net/2022/09/24/using-tshark-to-monitor-pg-traffic/">https://zignar.net/2022/09/24/using-tshark-to-monitor-pg-traffic/</a></li></ul></li><li>pgs-debug (part of <code>pgshark</code>)<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/dalibo/pgshark">https://github.com/dalibo/pgshark</a></li></ul></li><li>pgmockproxy<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/jackc/pgmock#pgmockproxy">https://github.com/jackc/pgmock#pgmockproxy</a></li></ul></li></ul><p>I recommend using Wireshark&#x27;s GUI, it&#x27;s the easiest to use. For this tutorial I&#x27;ll be using <code>pgs-debug</code>, for two reasons:</p><ul><li>Wireshark doesn&#x27;t work on WSL</li><li>I want to be able to paste the ASCII output into the tutorial</li></ul><blockquote><p>NOTE: If you want a video tutorial on how to capture Postgres traffic with Wireshark, I have a short demo on my <code>pgprotokt</code> repo here:</p></blockquote><ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/PgProtoKt#demo-video-with-psql">https://github.com/GavinRay97/PgProtoKt#demo-video-with-psql</a></li></ul><p>To capture the output with <code>pgs-debug</code>, I&#x27;ll be using the command:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Capture on loopback interface</span>
</span><span class="code-line">$ <span class="token function">sudo</span> pgs-debug --interface lo
</span></code></pre></div><p>If we start up the server and connect with <code>psql</code>, we should see the following:</p><ul><li><code>psql</code> client:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>user@MSI ~<span class="token punctuation">]</span>$ psql -h localhost -p <span class="token number">5432</span> -U postgres
</span><span class="code-line">psql <span class="token punctuation">(</span><span class="token number">15.0</span>, server <span class="token number">0.0</span>.0<span class="token punctuation">)</span>
</span><span class="code-line">WARNING: psql major version <span class="token number">15</span>, server major version <span class="token number">0.0</span>.
</span><span class="code-line">         Some psql features might not work.
</span><span class="code-line">Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span>
</span></code></pre></div><ul><li><code>pgs-debug</code> output:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>user@MSI ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> pgs-debug --interface lo
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.924458</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>SSLRequest, F -<span class="token operator">&gt;</span> B
</span><span class="code-line">SSL REQUEST
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.928187</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>SSLAnswer, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">SSL BACKEND ANSWER: N
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.928222</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>StartupMessage, F -<span class="token operator">&gt;</span> B
</span><span class="code-line">STARTUP MESSAGE version: <span class="token number">3</span>
</span><span class="code-line">  <span class="token assign-left variable">application_name</span><span class="token operator">=</span>psql
</span><span class="code-line">  <span class="token assign-left variable">database</span><span class="token operator">=</span>postgres
</span><span class="code-line">  <span class="token assign-left variable">client_encoding</span><span class="token operator">=</span>UTF8
</span><span class="code-line">  <span class="token assign-left variable">user</span><span class="token operator">=</span>postgres
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.928318</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>AuthenticationOk, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">AUTHENTIFICATION REQUEST <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">(</span>SUCCESS<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.970239</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>BackendKeyData, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">BACKEND KEY DATA <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">1234</span>, <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token number">5678</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673886702.970239</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643347544</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>ReadyForQuery, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">READY FOR QUERY <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token operator">&lt;</span>IDLE<span class="token operator">&gt;</span>
</span></code></pre></div><ul><li>Server output:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Listening on localhost:5432
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Accepted connection from /127.0.0.1:47544
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:47544<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:47544<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">84</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span></code></pre></div><h2 id="step-13---differentiating-between-the-sslauthentication-request-and-command-messages"><a href="#step-13---differentiating-between-the-sslauthentication-request-and-command-messages" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1.3 - Differentiating between the SSL/Authentication request, and Command messages</h2><p>We need to be able to differentiate between the SSL Negotiation message, the Authentication request, and the standard command messages.</p><p>This is so that we can properly route the messages to the appropriate handlers. Otherwise we wouldn&#x27;t be able to serve more than one client at a time.</p><p>To do this, we can create some predicate helpers for testing the message type to determine whether it&#x27;s the SSL Request or Startup Message.</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line">    <span class="token keyword">static</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span> isSSLRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x04</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0xd2</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x16</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x2f</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span> isStartupMessage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">8</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x03</span> <span class="token comment">// Protocol version 3</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Received message from client: &quot;</span> <span class="token operator">+</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Buffer: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> writeResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>isSSLRequest<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] SSL Request&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span> sslResponse <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            sslResponse<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;N&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            sslResponse<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>sslResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartupMessage<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Startup Message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment">// Then, write AuthenticationOk</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span> authOk <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            authOk<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;R&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;R&#x27; for AuthenticationOk</span>
</span><span class="code-line">            authOk<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">            authOk<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AuthenticationOk</span>
</span><span class="code-line">            authOk<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>authOk<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment">// Then, write BackendKeyData</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span> backendKeyData <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            backendKeyData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;K&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Message type</span>
</span><span class="code-line">            backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Message length</span>
</span><span class="code-line">            backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Process ID</span>
</span><span class="code-line">            backendKeyData<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5678</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Secret key</span>
</span><span class="code-line">            backendKeyData<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>backendKeyData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment">// Then, write ReadyForQuery</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span> readyForQuery <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;Z&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;Z&#x27; for ReadyForQuery</span>
</span><span class="code-line">            readyForQuery<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">            readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;I&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Transaction status indicator, &#x27;I&#x27; for idle</span>
</span><span class="code-line">            readyForQuery<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>readyForQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Unknown message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Write result: &quot;</span> <span class="token operator">+</span> writeResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Failed to write to client: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>If we re-start and reconnect with <code>psql</code>, we should now see:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Listening on localhost:5432
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Accepted connection from /127.0.0.1:35090
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:35090<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> SSL Request
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Write result: <span class="token number">1</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:35090<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">84</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Startup Message
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Write result: <span class="token number">6</span>
</span></code></pre></div><h2 id="step-14---handle-a-query-and-return-data-rows"><a href="#step-14---handle-a-query-and-return-data-rows" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1.4 - Handle a query and return data rows</h2><p>Now, the moment you&#x27;ve likely all been waiting for. Let&#x27;s handle a query and return some data rows.</p><p>&quot;Handle&quot; in this case means that we&#x27;ll just return a hard-coded set of rows, and not actually query a database (sorry to disappoint!). I did say &quot;no libraries&quot; =(</p><p>To do this, we&#x27;ll need to handle the <code>Query</code> message, and then send a <code>RowDescription</code> message, followed by a <code>DataRow</code> message for each row, and finally a <code>CommandComplete</code> message.</p><ul><li>For our <code>RowDescription</code> message, we&#x27;ll send two columns, with names &quot;id&quot; and &quot;name&quot;</li><li>For our <code>DataRow</code> message, we&#x27;ll send two rows, with values (1, &quot;one&quot;) and (2, &quot;two&quot;)</li></ul><p>To complete the cycle, we lastly need to follow up with a <code>ReadyForQuery</code> message.</p><p>This is the hairiest part of the protocol, so the annotated code below should hopefully help you understand what&#x27;s going on:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Unknown message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// Let&#x27;s assume it&#x27;s a query message, and just send a simple response</span>
</span><span class="code-line">    <span class="token comment">// First we send a RowDescription. We&#x27;ll send two columns, with names &quot;id&quot; and &quot;name&quot;</span>
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> rowDescription <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;T&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;T&#x27; for RowDescription</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Number of fields/columns</span>
</span><span class="code-line">    <span class="token comment">// For each field/column:</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Column name of column 1 (null-terminated)</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object ID of column 1</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Attribute number of column 1</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Data type OID of column 1</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Data type size of column 1</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Type modifier of column 1</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Format code of column 1</span>
</span><span class="code-line">
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Column name of column 2 (null-terminated)</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object ID of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Attribute number of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Data type OID of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Data type size of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Type modifier of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Format code of column 2</span>
</span><span class="code-line">    rowDescription<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>rowDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Then we send a DataRow for each row. We&#x27;ll send two rows, with values (1, &quot;one&quot;) and (2, &quot;two&quot;)</span>
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> dataRow1 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;D&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;D&#x27; for DataRow</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length (4)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Number of columns (5-6)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length of column 1 (7-10)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;1&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Value of column 1 (11-11)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length of column 2 (12-15)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Value of column 2 (16-18)</span>
</span><span class="code-line">    dataRow1<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dataRow1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> dataRow2 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;D&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;D&#x27; for DataRow</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Number of columns</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length of column 2</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;2&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Value of column 2</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length of column 2</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Value of column 2</span>
</span><span class="code-line">    dataRow2<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dataRow2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// We send a CommandComplete</span>
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> commandComplete <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    commandComplete<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;C&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;C&#x27; for CommandComplete</span>
</span><span class="code-line">    commandComplete<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">    commandComplete<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT 2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Command tag</span>
</span><span class="code-line">    commandComplete<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Null terminator</span>
</span><span class="code-line">    commandComplete<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>commandComplete<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Finally, write ReadyForQuery</span>
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> readyForQuery <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;Z&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;Z&#x27; for ReadyForQuery</span>
</span><span class="code-line">    readyForQuery<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">    readyForQuery<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;I&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Transaction status indicator, &#x27;I&#x27; for idle</span>
</span><span class="code-line">    readyForQuery<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>readyForQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>If we run this, we should see the following output:</p><ul><li><code>psql</code> Client:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ psql -h localhost -p <span class="token number">5432</span> -U postgres
</span><span class="code-line">psql <span class="token punctuation">(</span><span class="token number">15.0</span>, server <span class="token number">0.0</span>.0<span class="token punctuation">)</span>
</span><span class="code-line">WARNING: psql major version <span class="token number">15</span>, server major version <span class="token number">0.0</span>.
</span><span class="code-line">         Some psql features might not work.
</span><span class="code-line">Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line"> <span class="token function">id</span> <span class="token operator">|</span> name
</span><span class="code-line">----+------
</span><span class="code-line">  <span class="token number">1</span> <span class="token operator">|</span> one
</span><span class="code-line">  <span class="token number">2</span> <span class="token operator">|</span> two
</span><span class="code-line"><span class="token punctuation">(</span><span class="token number">2</span> rows<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span>
</span></code></pre></div><ul><li><code>pgs-debug</code> output:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.207655</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>SSLRequest, F -<span class="token operator">&gt;</span> B
</span><span class="code-line">SSL REQUEST
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.210943</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>SSLAnswer, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">SSL BACKEND ANSWER: N
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.210986</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>StartupMessage, F -<span class="token operator">&gt;</span> B
</span><span class="code-line">STARTUP MESSAGE version: <span class="token number">3</span>
</span><span class="code-line">  <span class="token assign-left variable">client_encoding</span><span class="token operator">=</span>UTF8
</span><span class="code-line">  <span class="token assign-left variable">user</span><span class="token operator">=</span>postgres
</span><span class="code-line">  <span class="token assign-left variable">database</span><span class="token operator">=</span>postgres
</span><span class="code-line">  <span class="token assign-left variable">application_name</span><span class="token operator">=</span>psql
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.211448</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>AuthenticationOk, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">AUTHENTIFICATION REQUEST <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">(</span>SUCCESS<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.260990</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>BackendKeyData, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">BACKEND KEY DATA <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">1234</span>, <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token number">5678</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887134.260990</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>ReadyForQuery, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">READY FOR QUERY <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token operator">&lt;</span>IDLE<span class="token operator">&gt;</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.771401</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>Query, F -<span class="token operator">&gt;</span> B
</span><span class="code-line">QUERY <span class="token assign-left variable">query</span><span class="token operator">=</span>select <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.772593</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>RowDescription, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">ROW DESCRIPTION: <span class="token assign-left variable">num_fields</span><span class="token operator">=</span><span class="token number">2</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Field 01<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&#x27;id&#x27;</span>
</span><span class="code-line">  <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token number">23</span>
</span><span class="code-line">  <span class="token assign-left variable">type_len</span><span class="token operator">=</span><span class="token number">4</span>
</span><span class="code-line">  <span class="token assign-left variable">type_mod</span><span class="token operator">=</span><span class="token number">4294967295</span>
</span><span class="code-line">  <span class="token assign-left variable">relid</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">  <span class="token assign-left variable">attnum</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">  <span class="token assign-left variable">format</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Field 02<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&#x27;name&#x27;</span>
</span><span class="code-line">  <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token number">25</span>
</span><span class="code-line">  <span class="token assign-left variable">type_len</span><span class="token operator">=</span><span class="token number">65535</span>
</span><span class="code-line">  <span class="token assign-left variable">type_mod</span><span class="token operator">=</span><span class="token number">4294967295</span>
</span><span class="code-line">  <span class="token assign-left variable">relid</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">  <span class="token assign-left variable">attnum</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">  <span class="token assign-left variable">format</span><span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.772650</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>DataRow, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">DATA ROW <span class="token assign-left variable">num_values</span><span class="token operator">=</span><span class="token number">2</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Value 0001<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">1</span>
</span><span class="code-line">  <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&#x27;1&#x27;</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Value 0002<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">3</span>
</span><span class="code-line">  <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&#x27;one&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.772717</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>DataRow, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">DATA ROW <span class="token assign-left variable">num_values</span><span class="token operator">=</span><span class="token number">2</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Value 0001<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">1</span>
</span><span class="code-line">  <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&#x27;2&#x27;</span>
</span><span class="code-line">  ---<span class="token punctuation">[</span>Value 0002<span class="token punctuation">]</span>---
</span><span class="code-line">  <span class="token assign-left variable">length</span><span class="token operator">=</span><span class="token number">3</span>
</span><span class="code-line">  <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&#x27;two&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.772759</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>CommandComplete, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">COMMAND COMPLETE <span class="token assign-left variable">command</span><span class="token operator">=</span><span class="token string">&#x27;SELECT 2&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">Packet: <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">1673887136.772792</span>, <span class="token assign-left variable">session</span><span class="token operator">=</span><span class="token number">213070643346422</span>
</span><span class="code-line">PGSQL: <span class="token assign-left variable">type</span><span class="token operator">=</span>ReadyForQuery, B -<span class="token operator">&gt;</span> F
</span><span class="code-line">READY FOR QUERY <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token operator">&lt;</span>IDLE<span class="token operator">&gt;</span>
</span></code></pre></div><ul><li>Server output:</li></ul><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Listening on localhost:5432
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Accepted connection from /127.0.0.1:46422
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:46422<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> SSL Request
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Write result: <span class="token number">1</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:46422<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">84</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Startup Message
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Write result: <span class="token number">6</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl<span class="token punctuation">[</span>connected <span class="token assign-left variable">local</span><span class="token operator">=</span>/127.0.0.1:5432 <span class="token assign-left variable">remote</span><span class="token operator">=</span>/127.0.0.1:46422<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Buffer: java.nio.HeapByteBuffer<span class="token punctuation">[</span>pos<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">lim</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">cap</span><span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Unknown message
</span><span class="code-line"><span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span> Write result: <span class="token number">6</span>
</span></code></pre></div><h1 id="step-2-refactoring"><a href="#step-2-refactoring" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 2: Refactoring</h1><p>Now that we have a working server, we can start refactoring the code to make it more readable and maintainable.</p><p>This is where we&#x27;ll pull in some of the more advanced features of recent Java versions, like Sealed Interfaces, Records, and Pattern Matching.</p><p>Our plan for refactoring is going to be to:</p><ul><li>Pull both the Client -&gt; Server, and Server -&gt; Client messages into their own sealed interfaces, where each message type is represented by a record.</li><li>We&#x27;ll then use encoders/decoders to convert between the raw bytes and the message types<ul><li>And do this in a succinct way using pattern matching in a <code>return switch + yield</code> statement.</li></ul></li><li>Along the way, we&#x27;ll see how we can use some of the API methods from the <code>Foreign Function and Memory</code> JEP to help us work with <code>C-Strings</code> from raw bytes.</li></ul><p>In a Mermaid diagram, the hierarchy of sealed interface types for client and server messages looks like this:</p><p><a target="_blank" rel="noopener noreferrer" href="https://mermaid.live/edit#pako:eNp90c1OwzAMB_BXqXzeXqDiAqvgAIyPXnuxkj8lapNUjgOqxt6dbNoBEEoujqyfZVs-kIkW1JKZOaXO8Sjsh9CU93y3mx2CPiIlHtFcfW23Td8_7DFGZXUx1JyyaF4uuQp8yZD1D-shH5Bf7Drreyl15tz4aarQGzYTgr3H2rFyBb6C7Xob5TxCzcXPDsmIW34u_Q889Su4InbRew62hGWGgjbkIZ6dLRc4nOoGKnt6DNSWr2WZBhrCsTjOGvs1GGpVMjaUF8uKy8GofeM54fgNtMqdBw"><img alt="" src="https://mermaid.ink/img/pako:eNp90c1OwzAMB_BXqXzeXqDiAqvgAIyPXnuxkj8lapNUjgOqxt6dbNoBEEoujqyfZVs-kIkW1JKZOaXO8Sjsh9CU93y3mx2CPiIlHtFcfW23Td8_7DFGZXUx1JyyaF4uuQp8yZD1D-shH5Bf7Drreyl15tz4aarQGzYTgr3H2rFyBb6C7Xob5TxCzcXPDsmIW34u_Q889Su4InbRew62hGWGgjbkIZ6dLRc4nOoGKnt6DNSWr2WZBhrCsTjOGvs1GGpVMjaUF8uKy8GofeM54fgNtMqdBw?type=png"/></a></p><h2 id="refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side"><a href="#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 1. Client Side)</h2><p>We&#x27;ll start with the client side, since it&#x27;s a bit simpler.</p><p>Most of this code is pretty straightforward, though there&#x27;s one interesting bit that I&#x27;ll point out.</p><p>When we decode the <code>StartupMessage</code>, what we have are a series of null-terminated key/value string pairs.</p><p>The <code>Foreign Function and Memory</code> JEP provides a <code>MemorySegment</code> class that we can use to work with raw bytes. One of the convenience methods on <code>MemorySegment</code> is <code>getUtf8String(long offset)</code>, which will read a null-terminated string from the given offset.</p><p>This method is incredibly useful, previously it required a lot of boilerplate when working with <code>ByteBuffer</code> to read a null-terminated C-String. Unfortunately this method does not directly return a Java string, so we need to do some extra conversion to convert the <code>MemorySegment</code> bytes further to a <code>String</code>.</p><p>With these records and encoders in place, it allows our dispatch logic to become a succinct pattern match statement:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">PGClientMessage</span> message <span class="token operator">=</span> <span class="token class-name">PGClientMessage</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>SSLNegotation</span> ssl <span class="token operator">-&gt;</span> <span class="token function">handleSSLRequest</span><span class="token punctuation">(</span>ssl<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>StartupMessage</span> startup <span class="token operator">-&gt;</span> <span class="token function">handleStartupMessage</span><span class="token punctuation">(</span>startup<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>QueryMessage</span> query <span class="token operator">-&gt;</span> <span class="token function">handleQueryMessage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The full code for the client message types and decoders is below:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">PGClientMessage</span> <span class="token keyword">permits</span>
</span><span class="code-line">    <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>SSLNegotation</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>StartupMessage</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>QueryMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">SSLNegotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGClientMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">StartupMessage</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGClientMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">QueryMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> query<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGClientMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span> isSSLRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x04</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0xd2</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x16</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x2f</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span> isStartupMessage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">8</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x03</span> <span class="token comment">// Protocol version 3</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span>
</span><span class="code-line">                <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token class-name">PGClientMessage</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>isSSLRequest<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SSLNegotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartupMessage<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">var</span> segment <span class="token operator">=</span> <span class="token class-name">MemorySegment</span><span class="token punctuation">.</span><span class="token function">ofBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">var</span> length <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">var</span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">while</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> name <span class="token operator">=</span> segment<span class="token punctuation">.</span><span class="token function">getUtf8String</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                offset <span class="token operator">+=</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">var</span> value <span class="token operator">=</span> segment<span class="token punctuation">.</span><span class="token function">getUtf8String</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                offset <span class="token operator">+=</span> value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">                parameters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StartupMessage</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token comment">// Assume it&#x27;s a query message</span>
</span><span class="code-line">            <span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token class-name">MemorySegment</span><span class="token punctuation">.</span><span class="token function">ofBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUtf8String</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryMessage</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// In &quot;AsynchronousSocketServer&quot;</span>
</span><span class="code-line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Received message from client: &quot;</span> <span class="token operator">+</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Buffer: &quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">PGClientMessage</span> message <span class="token operator">=</span> <span class="token class-name">PGClientMessage</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>SSLNegotation</span> ssl <span class="token operator">-&gt;</span> <span class="token function">handleSSLRequest</span><span class="token punctuation">(</span>ssl<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>StartupMessage</span> startup <span class="token operator">-&gt;</span> <span class="token function">handleStartupMessage</span><span class="token punctuation">(</span>startup<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">PGClientMessage<span class="token punctuation">.</span>QueryMessage</span> query <span class="token operator">-&gt;</span> <span class="token function">handleQueryMessage</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Where each of those methods contains the previous logic it held in the &quot;if/else&quot; statement, for example:</span>
</span><span class="code-line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleSSLRequest</span><span class="token punctuation">(</span><span class="token class-name">PGClientMessage<span class="token punctuation">.</span>SSLNegotation</span> sslRequest<span class="token punctuation">,</span> <span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] SSL Request: &quot;</span> <span class="token operator">+</span> sslRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">ByteBuffer</span> sslResponse <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    sslResponse<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;N&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    sslResponse<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">        client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>sslResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side"><a href="#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 2. Server Side)</h2><p>The final section of our journey, is just more of the same, so I will leave this section a bit more brief.</p><p>It does what it says on the tin, we refactor the server side to use sealed interfaces with records and message decoders.</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">PGServerMessage</span> <span class="token keyword">permits</span>
</span><span class="code-line">        <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>AuthenticationRequest</span><span class="token punctuation">,</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>BackendKeyData</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>ReadyForQuery</span><span class="token punctuation">,</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>RowDescription</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>DataRow</span><span class="token punctuation">,</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>CommandComplete</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">AuthenticationRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">BackendKeyData</span><span class="token punctuation">(</span><span class="token keyword">int</span> processId<span class="token punctuation">,</span> <span class="token keyword">int</span> secretKey<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">ReadyForQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">RowDescription</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RowDescription<span class="token punctuation">.</span>Field</span><span class="token punctuation">&gt;</span></span> fields<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">record</span> <span class="token class-name">Field</span><span class="token punctuation">(</span>
</span><span class="code-line">                <span class="token class-name">String</span> name<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> tableObjectId<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> columnAttributeNumber<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> dataTypeObjectId<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> dataTypeSize<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> typeModifier<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">int</span> formatCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token comment">// 4 (int tableObjectId) + 2 (short columnAttributeNumber) + 4 (int dataTypeObjectId) + 2 (short dataTypeSize) + 4 (int typeModifier) + 2 (short formatCode)</span>
</span><span class="code-line">                <span class="token comment">// 4 + 2 + 4 + 2 + 4 + 2 = 18</span>
</span><span class="code-line">                <span class="token comment">// Add name length, plus 1 for null terminator &#x27;\0&#x27;</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token number">18</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">DataRow</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">record</span> <span class="token class-name">CommandComplete</span><span class="token punctuation">(</span><span class="token class-name">String</span> commandTag<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">PGServerMessage</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">AuthenticationRequest</span> auth <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;R&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;R&#x27; for AuthenticationRequest</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Authentication type, 0 for OK</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> buffer<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">BackendKeyData</span> keyData <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;K&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;K&#x27; for BackendKeyData</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>keyData<span class="token punctuation">.</span><span class="token function">processId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Process ID</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>keyData<span class="token punctuation">.</span><span class="token function">secretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Secret key</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> buffer<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">ReadyForQuery</span> ready <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;Z&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x27;Z&#x27; for ReadyForQuery</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Length</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;I&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Transaction status indicator, &#x27;I&#x27; for idle</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> buffer<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">RowDescription</span> rowDesc <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> fields <span class="token operator">=</span> rowDesc<span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> fields<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">RowDescription<span class="token punctuation">.</span>Field</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;T&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> fields<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                fields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>field <span class="token operator">-&gt;</span> buffer
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// null-terminated</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">tableObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> field<span class="token punctuation">.</span><span class="token function">columnAttributeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">dataTypeObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> field<span class="token punctuation">.</span><span class="token function">dataTypeSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">typeModifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> field<span class="token punctuation">.</span><span class="token function">formatCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> buffer<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">DataRow</span> dataRow <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> values <span class="token operator">=</span> dataRow<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token comment">// For each value, we need to add 4 bytes for the length, plus the length of the value</span>
</span><span class="code-line">                <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> values<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>it <span class="token operator">-&gt;</span> it<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// +1 for msg type</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;D&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token comment">// +4 for length</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> values<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// +2 for number of columns</span>
</span><span class="code-line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> buffer<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">CommandComplete</span> cmdComplete <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">var</span> commandTag <span class="token operator">=</span> cmdComplete<span class="token punctuation">.</span><span class="token function">commandTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">+</span> commandTag<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token keyword">yield</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// +1 for msg type</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token string">&#x27;C&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token comment">// +4 for length</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>commandTag<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// null terminator</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// In &quot;AsynchronousSocketServer&quot;</span>
</span><span class="code-line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleStartupMessage</span><span class="token punctuation">(</span><span class="token class-name">PGClientMessage<span class="token punctuation">.</span>StartupMessage</span> startup<span class="token punctuation">,</span> <span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Startup Message: &quot;</span> <span class="token operator">+</span> startup<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> writeResult<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Then, write AuthenticationOk</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>AuthenticationRequest</span> authRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>AuthenticationRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Then, write BackendKeyData</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>BackendKeyData</span> backendKeyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>BackendKeyData</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">5678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>backendKeyData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Then, write ReadyForQuery</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>ReadyForQuery</span> readyForQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>ReadyForQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>readyForQuery<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">        writeResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleQueryMessage</span><span class="token punctuation">(</span><span class="token class-name">PGClientMessage<span class="token punctuation">.</span>QueryMessage</span> query<span class="token punctuation">,</span> <span class="token class-name">AsynchronousSocketChannel</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[SERVER] Query Message: &quot;</span> <span class="token operator">+</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> writeResult<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Let&#x27;s assume it&#x27;s a query message, and just send a simple response</span>
</span><span class="code-line">    <span class="token comment">// First we send a RowDescription. We&#x27;ll send two columns, with names &quot;id&quot; and &quot;name&quot;</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>RowDescription</span> rowDescription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>RowDescription</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>RowDescription<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>RowDescription<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>rowDescription<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Then we send a DataRow for each row. We&#x27;ll send two rows, with values (1, &quot;one&quot;) and (2, &quot;two&quot;)</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>DataRow</span> dataRow1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>DataRow</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dataRow1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>DataRow</span> dataRow2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>DataRow</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dataRow2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// We send a CommandComplete</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>CommandComplete</span> commandComplete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>CommandComplete</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>commandComplete<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Finally, write ReadyForQuery</span>
</span><span class="code-line">    <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>ReadyForQuery</span> readyForQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGServerMessage<span class="token punctuation">.</span>ReadyForQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    writeResult <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">PGServerMessage</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>readyForQuery<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">        writeResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fgavinray97.github.io%2Fblog%2Fpostgres-wire-protocol-jdk-21">Discuss on Twitter</a> â€¢ <a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/GavinRay97.github.io/blob/master/data/blog/postgres-wire-protocol-jdk-21.mdx">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/java">java</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jdk">jdk</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jvm">jvm</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/postgres">postgres</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/wire-protocol">wire-protocol</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/databases">databases</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/server">server</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/adding-invariant-to-cpp-design-by-contract">Adding Design-by-Contract [[invariant]] conditions to C++, via a GCC plugin</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/what-good-are-record-patterns">What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">â† Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:ray.gavin97@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Gavin Ray</div><div> â€¢ </div><div>Â© 2025</div><div> â€¢ </div><a href="/">Gavin Ray Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{o(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},f=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of m(s))!u.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ef(o(l(a!=null?p(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((B,i)=\u003e{i.exports=_jsx_runtime});var v={};k(v,{default:()=\u003ew,frontmatter:()=\u003ey});var n=g(r()),y={title:\"Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21\",date:\"2023-01-16\",tags:[\"java\",\"jdk\",\"jvm\",\"postgres\",\"wire-protocol\",\"databases\",\"server\"],draft:!1,summary:`A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function \u0026 Memory API.\n`,images:[\"/static/images/postgres-wire-protocol-display-image.png\"]};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",p:\"p\",ul:\"ul\",li:\"li\",a:\"a\",code:\"code\",h1:\"h1\",span:\"span\",ol:\"ol\",strong:\"strong\",img:\"img\",h2:\"h2\",pre:\"pre\",h3:\"h3\",blockquote:\"blockquote\"},a.components),{TOCInline:t}=e;return t||S(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{toc:a.toc,indentDepth:2,asDisclosure:!0}),(0,n.jsx)(e.hr,{}),(0,n.jsx)(e.p,{children:\"This tutorial is meant to serve as a dual purpose guide:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Demonstrate how to implement the \",(0,n.jsx)(e.a,{href:\"https://www.postgresql.org/docs/current/protocol-flow.html#id-1.10.6.7.4\",children:\"Simple Query Protocol\"}),\", where Java is an implementation detail\"]}),(0,n.jsxs)(e.li,{children:[\"Show practical examples of most of the new features since JDK 17, including:\",(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Records (JEP 395)\"}),(0,n.jsx)(e.li,{children:\"Sealed Types (JEP 360/JEP 409)\"}),(0,n.jsx)(e.li,{children:\"Pattern Matching for Switch (JEP 406)\"}),(0,n.jsx)(e.li,{children:\"Virtual Threads aka Project Loom (JEP 425)\"}),(0,n.jsx)(e.li,{children:\"Foreign-Function \u0026 Memory API (FMM) aka Project Panama (JEP 424)\"}),(0,n.jsxs)(e.li,{children:[\"(Also give a practical example of \",(0,n.jsx)(e.code,{children:\"java.nio\"}),\"'s \",(0,n.jsx)(e.code,{children:\"AsynchronousChannelGroup\"}),\" and \",(0,n.jsx)(e.code,{children:\"AsynchronousServerSocketChannel\"}),\", for which there are few examples online)\"]})]})]})]}),(0,n.jsxs)(e.h1,{id:\"outline\",children:[(0,n.jsx)(e.a,{href:\"#outline\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Outline\"]}),(0,n.jsx)(e.p,{children:\"This tutorial will be broken up into a series of 2 parts:\"}),(0,n.jsxs)(e.ol,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.p,{children:\"Because we are diligent coders who know to Do The Simplest Thing That Could Possibly Work\\u2122, our first step will be an horrifically ugly, but functional, implementation of the PostgreSQL wire protocol server.\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.p,{children:\"Then, we will refactor our code to be more readable and maintainable.\"})})]}),(0,n.jsxs)(e.h1,{id:\"introduction-to-the-postgresql-wire-protocol\",children:[(0,n.jsx)(e.a,{href:\"#introduction-to-the-postgresql-wire-protocol\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introduction to the PostgreSQL Wire Protocol\"]}),(0,n.jsx)(e.p,{children:\"The PostgreSQL wire protocol is a binary protocol that is used to communicate between a PostgreSQL client and server.\"}),(0,n.jsxs)(e.p,{children:[\"The protocol is documented in the \",(0,n.jsx)(e.a,{href:\"https://www.postgresql.org/docs/current/protocol.html\",children:\"PostgreSQL Protocol Documentation\"}),\".\"]}),(0,n.jsx)(e.p,{children:\"In my opinion, this documentation is not the most understandable. If you want to learn more about the protocol, I recommend the following presentation:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://beta.pgcon.org/2014/schedule/attachments/330_postgres-for-the-wire.pdf\",children:\"https://beta.pgcon.org/2014/schedule/attachments/330_postgres-for-the-wire.pdf\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=qa22SouCr5E\",children:\"https://www.youtube.com/watch?v=qa22SouCr5E\"})})]}),(0,n.jsx)(e.p,{children:\"What we're concerned with today, is primarily the following pieces of information:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Postgres clients send two types of message to the server: \",(0,n.jsx)(e.strong,{children:\"Startup Messages\"}),\" and \",(0,n.jsx)(e.strong,{children:\"Commands\"})]}),(0,n.jsxs)(e.li,{children:[\"Optionally, the Startup message can be preceded by an \",(0,n.jsx)(e.strong,{children:\"SSL Negotiation\"}),\" message, where the client asks the server if it supports SSL\"]})]}),(0,n.jsx)(e.p,{children:\"Visualized as a Mermaid diagram:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://mermaid.live/edit#pako:eNp9kT9vAjEMxb9K5BnEnoGqBXVpoaI3IWWxEvca3eUPOafSCfHdCYROVZol1svP71nOGXQwBBImOmXymrYW-4ROeVFOxMRW24iexWa05Pmv3lH6oVT1yojlev2Qpei6d7GnPrBFtsE_VbC-iuWNrE1SHFf7tguXxBzFjqYJe2qbPGf-LoXV97SPoU2-oB7Imzeat8jYTN4E59Cbts8DKFccif8Z7ZPQzK8hHTKlGRbgKDm0puz-fGtSUCZ3pECW0mAaFCh_KRxmDt3sNUhOmRaQo0H-_SeQXzhOdLkCWvyWwA\",children:(0,n.jsx)(e.img,{alt:\"\",src:\"https://mermaid.ink/img/pako:eNp9kT9vAjEMxb9K5BnEnoGqBXVpoaI3IWWxEvca3eUPOafSCfHdCYROVZol1svP71nOGXQwBBImOmXymrYW-4ROeVFOxMRW24iexWa05Pmv3lH6oVT1yojlev2Qpei6d7GnPrBFtsE_VbC-iuWNrE1SHFf7tguXxBzFjqYJe2qbPGf-LoXV97SPoU2-oB7Imzeat8jYTN4E59Cbts8DKFccif8Z7ZPQzK8hHTKlGRbgKDm0puz-fGtSUCZ3pECW0mAaFCh_KRxmDt3sNUhOmRaQo0H-_SeQXzhOdLkCWvyWwA?type=png\"})})}),(0,n.jsxs)(e.p,{children:[\"There are many types of commands, but today we'll only be concerned with the \",(0,n.jsx)(e.strong,{children:\"Query\"}),\" command, which is used to execute a SQL query.\"]}),(0,n.jsx)(e.p,{children:\"Knowing this, we can now start implementing our server.\"}),(0,n.jsxs)(e.h1,{id:\"step-1-doing-the-simplest-thing-that-could-possibly-work-tm\",children:[(0,n.jsx)(e.a,{href:\"#step-1-doing-the-simplest-thing-that-could-possibly-work-tm\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1: Doing The Simplest Thing That Could Possibly Work (TM)\"]}),(0,n.jsxs)(e.p,{children:[\"We'll begin by implementing a basic \",(0,n.jsx)(e.code,{children:\"java.nio.channels.AsynchronousServerSocketChannel\"}),\" server, which will accept connections and print out the messages it receives:\"]}),(0,n.jsxs)(e.h2,{id:\"step-11---initial-server-skeleton\",children:[(0,n.jsx)(e.a,{href:\"#step-11---initial-server-skeleton\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1.1 - Initial Server Skeleton\"]}),(0,n.jsx)(e.p,{children:\"Below is the initial skeleton of our server.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"We create a \",(0,n.jsx)(e.code,{children:\"java.nio.channels.AsynchronousServerSocketChannel\"}),\" and bind it to \",(0,n.jsx)(e.code,{children:\"localhost\"}),\" and the default Postgres port (\",(0,n.jsx)(e.code,{children:\"5432\"}),\").\"]}),(0,n.jsxs)(e.li,{children:[\"An \",(0,n.jsx)(e.code,{children:\"ExecutorService\"}),\" is created, which will be used to create a \",(0,n.jsx)(e.code,{children:\"java.nio.channels.AsynchronousChannelGroup\"}),\" for our server.\"]}),(0,n.jsxs)(e.li,{children:[\"We use the \",(0,n.jsx)(e.code,{children:\"newVirtualThreadPerTaskExecutor\"}),\" method, which will create a new Loom \",(0,n.jsx)(e.code,{children:\"Virtual Thread\"}),\" for the server thread pool.\"]}),(0,n.jsx)(e.li,{children:\"Then, we accept connections and print out the messages we receive.\"})]}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"postgres\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"wire\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"protocol\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"net\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"InetSocketAddress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousChannelGroup\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousServerSocketChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"CompletionHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"util\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"concurrent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ExecutorService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"util\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"concurrent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Executors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"util\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"concurrent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketServer\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" HOST \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"localhost\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" PORT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5432\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ExecutorService\"}),\" executor \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Executors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"newVirtualThreadPerTaskExecutor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousChannelGroup\"}),\" group \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousChannelGroup\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withThreadPool\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"executor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousServerSocketChannel\"}),\" server \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousServerSocketChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"group\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"bind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"InetSocketAddress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"HOST\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" PORT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Listening on \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" HOST \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" PORT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" future \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"accept\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" future\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Accepted connection from \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getRemoteAddress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"read\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"CompletionHandler\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation annotation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"completed\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),\" result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"clear\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"read\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation annotation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"failed\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Throwable\"}),\" exc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" attachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Failed to read from client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" exc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        exc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Received message from client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Buffer: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MainSimplest\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketServer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"If we start this up, we should see:\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Running Gradle on WSL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` Task :app:compileJava\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` Task :app:processResources NO-SOURCE\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Note: Some input files use preview features of Java SE \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Note: Recompile with -Xlint:preview \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),` details.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` Task :app:classes\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" Task :app:MainSimplestWalkThrough.main\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Listening on localhost:5432\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"connecting-to-the-server-with-psql\",children:[(0,n.jsx)(e.a,{href:\"#connecting-to-the-server-with-psql\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Connecting to the Server with \",(0,n.jsx)(e.code,{children:\"psql\"})]}),(0,n.jsxs)(e.p,{children:[\"Now, we can connect to our server using \",(0,n.jsx)(e.code,{children:\"psql\"}),\":\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ psql -h localhost -p \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5432\"}),` -U postgres\n`]})})}),(0,n.jsxs)(e.p,{children:[\"We should see \",(0,n.jsx)(e.code,{children:\"psql\"}),\" hang at the prompt, and the server should print out the following:\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Accepted connection from /127.0.0.1:41826\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:41826\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Great! We're now able to receive messages from the client.\"}),(0,n.jsxs)(e.h2,{id:\"step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message\",children:[(0,n.jsx)(e.a,{href:\"#step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1.2 - Responding to the SSL Negotiation message and the Startup Message\"]}),(0,n.jsx)(e.p,{children:\"What we want to do is just make sure that we're able to receive messages from the client, and respond to the:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Initial SSL Negotiation message with a \",(0,n.jsx)(e.code,{children:\"'N'\"}),\" byte (for No)\"]}),(0,n.jsxs)(e.li,{children:[\"Startup Message with an \",(0,n.jsx)(e.code,{children:\"AuthenticationOk\"}),\" message\"]})]}),(0,n.jsx)(e.p,{children:\"Finally, we'll write a:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"BackendKeyData\"}),\" message, which is used to identify the connection to the client\"]}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"ReadyForQuery\"}),\" message, which indicates that the server is ready to accept commands.\"]})]}),(0,n.jsx)(e.p,{children:\"Below is the updated code:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Received message from client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Buffer: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// First, write 'N' for SSL negotiation\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" response \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'N'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" authOk \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'R'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'R' for AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write BackendKeyData\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" backendKeyData \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"17\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'K'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Message type\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Message length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1234\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Process ID\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5678\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Secret key\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" readyForQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Z'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'Z' for ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'I'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Transaction status indicator, 'I' for idle\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Failed to write to client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"From this point on, it'll be useful to be able to visualize the messages that we're sending and receiving.\"}),(0,n.jsx)(e.p,{children:\"There are a few tools that you can use to do this:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Wireshark/tshark\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://zignar.net/2022/09/24/using-tshark-to-monitor-pg-traffic/\",children:\"https://zignar.net/2022/09/24/using-tshark-to-monitor-pg-traffic/\"})})})]}),(0,n.jsxs)(e.li,{children:[\"pgs-debug (part of \",(0,n.jsx)(e.code,{children:\"pgshark\"}),\")\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/dalibo/pgshark\",children:\"https://github.com/dalibo/pgshark\"})})})]}),(0,n.jsxs)(e.li,{children:[\"pgmockproxy\",(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/jackc/pgmock#pgmockproxy\",children:\"https://github.com/jackc/pgmock#pgmockproxy\"})})})]})]}),(0,n.jsxs)(e.p,{children:[\"I recommend using Wireshark's GUI, it's the easiest to use. For this tutorial I'll be using \",(0,n.jsx)(e.code,{children:\"pgs-debug\"}),\", for two reasons:\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Wireshark doesn't work on WSL\"}),(0,n.jsx)(e.li,{children:\"I want to be able to paste the ASCII output into the tutorial\"})]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"NOTE: If you want a video tutorial on how to capture Postgres traffic with Wireshark, I have a short demo on my \",(0,n.jsx)(e.code,{children:\"pgprotokt\"}),\" repo here:\"]})}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/GavinRay97/PgProtoKt#demo-video-with-psql\",children:\"https://github.com/GavinRay97/PgProtoKt#demo-video-with-psql\"})})}),(0,n.jsxs)(e.p,{children:[\"To capture the output with \",(0,n.jsx)(e.code,{children:\"pgs-debug\"}),\", I'll be using the command:\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Capture on loopback interface\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sudo\"}),` pgs-debug --interface lo\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"If we start up the server and connect with \",(0,n.jsx)(e.code,{children:\"psql\"}),\", we should see the following:\"]}),(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"psql\"}),\" client:\"]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"user@MSI ~\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"$ psql -h localhost -p \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5432\"}),` -U postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"psql \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"15.0\"}),\", server \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.0\"}),\".0\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"WARNING: psql major version \",(0,n.jsx)(e.span,{className:\"token number\",children:\"15\"}),\", server major version \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.0\"}),`.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         Some psql features might not work.\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Type \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"pgs-debug\"}),\" output:\"]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"user@MSI ~\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sudo\"}),` pgs-debug --interface lo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.924458\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"SSLRequest, F -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` B\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`SSL REQUEST\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.928187\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"SSLAnswer, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`SSL BACKEND ANSWER: N\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.928222\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"StartupMessage, F -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` B\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"STARTUP MESSAGE version: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"application_name\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`psql\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"database\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"client_encoding\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`UTF8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"user\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`postgres\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.928318\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"AuthenticationOk, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"AUTHENTIFICATION REQUEST \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"code\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"SUCCESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.970239\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"BackendKeyData, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"BACKEND KEY DATA \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"pid\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1234\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5678\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673886702.970239\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643347544\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"ReadyForQuery, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"READY FOR QUERY \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"IDLE\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"Server output:\"})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Listening on localhost:5432\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Accepted connection from /127.0.0.1:47544\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:47544\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:47544\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"84\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"step-13---differentiating-between-the-sslauthentication-request-and-command-messages\",children:[(0,n.jsx)(e.a,{href:\"#step-13---differentiating-between-the-sslauthentication-request-and-command-messages\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1.3 - Differentiating between the SSL/Authentication request, and Command messages\"]}),(0,n.jsx)(e.p,{children:\"We need to be able to differentiate between the SSL Negotiation message, the Authentication request, and the standard command messages.\"}),(0,n.jsx)(e.p,{children:\"This is so that we can properly route the messages to the appropriate handlers. Otherwise we wouldn't be able to serve more than one client at a time.\"}),(0,n.jsx)(e.p,{children:\"To do this, we can create some predicate helpers for testing the message type to determine whether it's the SSL Request or Startup Message.\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Predicate\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" isSSLRequest \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x04\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xd2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x2f\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Predicate\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" isStartupMessage \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"remaining\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x03\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Protocol version 3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Received message from client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Buffer: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isSSLRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"test\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] SSL Request\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" sslResponse \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'N'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isStartupMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"test\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Startup Message\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" authOk \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'R'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'R' for AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authOk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write BackendKeyData\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" backendKeyData \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"17\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'K'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Message type\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Message length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1234\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Process ID\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5678\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Secret key\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" readyForQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Z'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'Z' for ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'I'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Transaction status indicator, 'I' for idle\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Unknown message\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Write result: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Failed to write to client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"If we re-start and reconnect with \",(0,n.jsx)(e.code,{children:\"psql\"}),\", we should now see:\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Listening on localhost:5432\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Accepted connection from /127.0.0.1:35090\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:35090\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` SSL Request\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Write result: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:35090\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"84\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Startup Message\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Write result: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"step-14---handle-a-query-and-return-data-rows\",children:[(0,n.jsx)(e.a,{href:\"#step-14---handle-a-query-and-return-data-rows\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1.4 - Handle a query and return data rows\"]}),(0,n.jsx)(e.p,{children:\"Now, the moment you've likely all been waiting for. Let's handle a query and return some data rows.\"}),(0,n.jsx)(e.p,{children:`\"Handle\" in this case means that we'll just return a hard-coded set of rows, and not actually query a database (sorry to disappoint!). I did say \"no libraries\" =(`}),(0,n.jsxs)(e.p,{children:[\"To do this, we'll need to handle the \",(0,n.jsx)(e.code,{children:\"Query\"}),\" message, and then send a \",(0,n.jsx)(e.code,{children:\"RowDescription\"}),\" message, followed by a \",(0,n.jsx)(e.code,{children:\"DataRow\"}),\" message for each row, and finally a \",(0,n.jsx)(e.code,{children:\"CommandComplete\"}),\" message.\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"For our \",(0,n.jsx)(e.code,{children:\"RowDescription\"}),` message, we'll send two columns, with names \"id\" and \"name\"`]}),(0,n.jsxs)(e.li,{children:[\"For our \",(0,n.jsx)(e.code,{children:\"DataRow\"}),` message, we'll send two rows, with values (1, \"one\") and (2, \"two\")`]})]}),(0,n.jsxs)(e.p,{children:[\"To complete the cycle, we lastly need to follow up with a \",(0,n.jsx)(e.code,{children:\"ReadyForQuery\"}),\" message.\"]}),(0,n.jsx)(e.p,{children:\"This is the hairiest part of the protocol, so the annotated code below should hopefully help you understand what's going on:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Unknown message\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Let's assume it's a query message, and just send a simple response\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:`// First we send a RowDescription. We'll send two columns, with names \"id\" and \"name\"`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" rowDescription \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"51\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'T'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'T' for RowDescription\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Number of fields/columns\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// For each field/column:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Column name of column 1 (null-terminated)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Object ID of column 1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Attribute number of column 1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Data type OID of column 1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Data type size of column 1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Type modifier of column 1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Format code of column 1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Column name of column 2 (null-terminated)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Object ID of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Attribute number of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Data type OID of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Data type size of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Type modifier of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Format code of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:`// Then we send a DataRow for each row. We'll send two rows, with values (1, \"one\") and (2, \"two\")`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" dataRow1 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"19\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'D'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'D' for DataRow\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"18\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length (4)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Number of columns (5-6)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length of column 1 (7-10)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Value of column 1 (11-11)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length of column 2 (12-15)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"one\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Value of column 2 (16-18)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" dataRow2 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"19\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'D'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'D' for DataRow\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"18\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Number of columns\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'2'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Value of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"two\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Value of column 2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// We send a CommandComplete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" commandComplete \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"14\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'C'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'C' for CommandComplete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"13\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"SELECT 2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Command tag\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Null terminator\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Finally, write ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" readyForQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Z'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'Z' for ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'I'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Transaction status indicator, 'I' for idle\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"If we run this, we should see the following output:\"}),(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"psql\"}),\" Client:\"]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ psql -h localhost -p \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5432\"}),` -U postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"psql \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"15.0\"}),\", server \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.0\"}),\".0\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"WARNING: psql major version \",(0,n.jsx)(e.span,{className:\"token number\",children:\"15\"}),\", server major version \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.0\"}),`.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         Some psql features might not work.\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Type \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),` name\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`----+------\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),` one\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),` two\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"pgs-debug\"}),\" output:\"]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.207655\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"SSLRequest, F -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` B\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`SSL REQUEST\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.210943\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"SSLAnswer, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`SSL BACKEND ANSWER: N\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.210986\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"StartupMessage, F -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` B\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"STARTUP MESSAGE version: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"client_encoding\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`UTF8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"user\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"database\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"application_name\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`psql\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.211448\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"AuthenticationOk, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"AUTHENTIFICATION REQUEST \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"code\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"SUCCESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.260990\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"BackendKeyData, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"BACKEND KEY DATA \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"pid\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1234\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5678\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887134.260990\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"ReadyForQuery, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"READY FOR QUERY \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"IDLE\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.771401\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"Query, F -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` B\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"QUERY \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"select \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.772593\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"RowDescription, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ROW DESCRIPTION: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"num_fields\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Field 01\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type_len\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type_mod\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4294967295\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"relid\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"attnum\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Field 02\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type_len\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"65535\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type_mod\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4294967295\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"relid\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"attnum\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.772650\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"DataRow, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"DATA ROW \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"num_values\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Value 0001\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'1'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Value 0002\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'one'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.772717\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"DataRow, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"DATA ROW \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"num_values\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Value 0001\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'2'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ---\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Value 0002\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`---\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'two'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.772759\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"CommandComplete, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"COMMAND COMPLETE \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"command\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'SELECT 2'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Packet: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"t\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1673887136.772792\"}),\", \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"213070643346422\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"PGSQL: \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"ReadyForQuery, B -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"READY FOR QUERY \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"IDLE\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:\"Server output:\"})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Listening on localhost:5432\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Accepted connection from /127.0.0.1:46422\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:46422\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` SSL Request\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Write result: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:46422\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"84\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Startup Message\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Write result: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Received message from client: sun.nio.ch.UnixAsynchronousSocketChannelImpl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"connected \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:5432 \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"remote\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"/127.0.0.1:46422\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Buffer: java.nio.HeapByteBuffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"lim\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"15\"}),\" \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"cap\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1024\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` Unknown message\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"SERVER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Write result: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),`\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"step-2-refactoring\",children:[(0,n.jsx)(e.a,{href:\"#step-2-refactoring\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 2: Refactoring\"]}),(0,n.jsx)(e.p,{children:\"Now that we have a working server, we can start refactoring the code to make it more readable and maintainable.\"}),(0,n.jsx)(e.p,{children:\"This is where we'll pull in some of the more advanced features of recent Java versions, like Sealed Interfaces, Records, and Pattern Matching.\"}),(0,n.jsx)(e.p,{children:\"Our plan for refactoring is going to be to:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Pull both the Client -\u003e Server, and Server -\u003e Client messages into their own sealed interfaces, where each message type is represented by a record.\"}),(0,n.jsxs)(e.li,{children:[\"We'll then use encoders/decoders to convert between the raw bytes and the message types\",(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[\"And do this in a succinct way using pattern matching in a \",(0,n.jsx)(e.code,{children:\"return switch + yield\"}),\" statement.\"]})})]}),(0,n.jsxs)(e.li,{children:[\"Along the way, we'll see how we can use some of the API methods from the \",(0,n.jsx)(e.code,{children:\"Foreign Function and Memory\"}),\" JEP to help us work with \",(0,n.jsx)(e.code,{children:\"C-Strings\"}),\" from raw bytes.\"]})]}),(0,n.jsx)(e.p,{children:\"In a Mermaid diagram, the hierarchy of sealed interface types for client and server messages looks like this:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://mermaid.live/edit#pako:eNp90c1OwzAMB_BXqXzeXqDiAqvgAIyPXnuxkj8lapNUjgOqxt6dbNoBEEoujqyfZVs-kIkW1JKZOaXO8Sjsh9CU93y3mx2CPiIlHtFcfW23Td8_7DFGZXUx1JyyaF4uuQp8yZD1D-shH5Bf7Drreyl15tz4aarQGzYTgr3H2rFyBb6C7Xob5TxCzcXPDsmIW34u_Q889Su4InbRew62hGWGgjbkIZ6dLRc4nOoGKnt6DNSWr2WZBhrCsTjOGvs1GGpVMjaUF8uKy8GofeM54fgNtMqdBw\",children:(0,n.jsx)(e.img,{alt:\"\",src:\"https://mermaid.ink/img/pako:eNp90c1OwzAMB_BXqXzeXqDiAqvgAIyPXnuxkj8lapNUjgOqxt6dbNoBEEoujqyfZVs-kIkW1JKZOaXO8Sjsh9CU93y3mx2CPiIlHtFcfW23Td8_7DFGZXUx1JyyaF4uuQp8yZD1D-shH5Bf7Drreyl15tz4aarQGzYTgr3H2rFyBb6C7Xob5TxCzcXPDsmIW34u_Q889Su4InbRew62hGWGgjbkIZ6dLRc4nOoGKnt6DNSWr2WZBhrCsTjOGvs1GGpVMjaUF8uKy8GofeM54fgNtMqdBw?type=png\"})})}),(0,n.jsxs)(e.h2,{id:\"refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side\",children:[(0,n.jsx)(e.a,{href:\"#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 1. Client Side)\"]}),(0,n.jsx)(e.p,{children:\"We'll start with the client side, since it's a bit simpler.\"}),(0,n.jsx)(e.p,{children:\"Most of this code is pretty straightforward, though there's one interesting bit that I'll point out.\"}),(0,n.jsxs)(e.p,{children:[\"When we decode the \",(0,n.jsx)(e.code,{children:\"StartupMessage\"}),\", what we have are a series of null-terminated key/value string pairs.\"]}),(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"Foreign Function and Memory\"}),\" JEP provides a \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\" class that we can use to work with raw bytes. One of the convenience methods on \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\" is \",(0,n.jsx)(e.code,{children:\"getUtf8String(long offset)\"}),\", which will read a null-terminated string from the given offset.\"]}),(0,n.jsxs)(e.p,{children:[\"This method is incredibly useful, previously it required a lot of boilerplate when working with \",(0,n.jsx)(e.code,{children:\"ByteBuffer\"}),\" to read a null-terminated C-String. Unfortunately this method does not directly return a Java string, so we need to do some extra conversion to convert the \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\" bytes further to a \",(0,n.jsx)(e.code,{children:\"String\"}),\".\"]}),(0,n.jsx)(e.p,{children:\"With these records and encoders in place, it allows our dispatch logic to become a succinct pattern match statement:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" message \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"decode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SSLNegotation\"]}),\" ssl \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleSSLRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ssl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StartupMessage\"]}),\" startup \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleStartupMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"startup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"QueryMessage\"]}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleQueryMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"The full code for the client message types and decoders is below:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"permits\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SSLNegotation\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StartupMessage\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"QueryMessage\"]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SSLNegotation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StartupMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"QueryMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Predicate\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" isSSLRequest \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x04\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xd2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x2f\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Predicate\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" isStartupMessage \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"remaining\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x03\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Protocol version 3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" b\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0x00\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"decode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isSSLRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"test\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SSLNegotation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isStartupMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"test\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" segment \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" parameters \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashMap\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" segment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getUtf8String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"offset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" value \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" segment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getUtf8String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"offset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StartupMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Assume it's a query message\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getUtf8String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"QueryMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// In \"AsynchronousSocketServer\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onMessageReceived\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Received message from client: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Buffer: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),\" message \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGClientMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"decode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SSLNegotation\"]}),\" ssl \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleSSLRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ssl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StartupMessage\"]}),\" startup \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleStartupMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"startup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"QueryMessage\"]}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleQueryMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// Where each of those methods contains the previous logic it held in the \"if/else\" statement, for example:'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleSSLRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SSLNegotation\"]}),\" sslRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] SSL Request: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" sslRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" sslResponse \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'N'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"sslResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side\",children:[(0,n.jsx)(e.a,{href:\"#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 2. Server Side)\"]}),(0,n.jsx)(e.p,{children:\"The final section of our journey, is just more of the same, so I will leave this section a bit more brief.\"}),(0,n.jsx)(e.p,{children:\"It does what it says on the tin, we refactor the server side to use sealed interfaces with records and message decoders.\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"permits\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"AuthenticationRequest\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BackendKeyData\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReadyForQuery\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RowDescription\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DataRow\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CommandComplete\"]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AuthenticationRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"BackendKeyData\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" processId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" secretKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ReadyForQuery\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"RowDescription\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"RowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Field\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" fields\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tableObjectId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" columnAttributeNumber\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" dataTypeObjectId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" dataTypeSize\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" typeModifier\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" formatCode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4 (int tableObjectId) + 2 (short columnAttributeNumber) + 4 (int dataTypeObjectId) + 2 (short dataTypeSize) + 4 (int typeModifier) + 2 (short formatCode)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4 + 2 + 4 + 2 + 4 + 2 = 18\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Add name length, plus 1 for null terminator '\\\\0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"18\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DataRow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"CommandComplete\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" commandTag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),\" message\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AuthenticationRequest\"}),\" auth \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'R'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'R' for AuthenticationRequest\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Authentication type, 0 for OK\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"BackendKeyData\"}),\" keyData \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"13\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'K'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'K' for BackendKeyData\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"keyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"processId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Process ID\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"keyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"secretKey\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Secret key\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ReadyForQuery\"}),\" ready \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Z'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 'Z' for ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'I'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Transaction status indicator, 'I' for idle\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"RowDescription\"}),\" rowDesc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" fields \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" rowDesc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"fields\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" fields\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"mapToInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"RowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Field\"]}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sum\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'T'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" fields\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                fields\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"forEach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),` buffer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// null-terminated\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"tableObjectId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"columnAttributeNumber\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dataTypeObjectId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dataTypeSize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"typeModifier\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"formatCode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DataRow\"}),\" dataRow \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" values \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" dataRow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"values\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// For each value, we need to add 4 bytes for the length, plus the length of the value\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"remaining\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sum\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" buffer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +1 for msg type\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'D'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +4 for length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putShort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"short\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +2 for number of columns\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" value \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"remaining\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"CommandComplete\"}),\" cmdComplete \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" commandTag \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cmdComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"commandTag\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" commandTag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"length\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"yield\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +1 for msg type\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'C'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"putInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +4 for length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"commandTag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// null terminator\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"flip\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// In \"AsynchronousSocketServer\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleStartupMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StartupMessage\"]}),\" startup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Startup Message: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" startup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write AuthenticationOk\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"AuthenticationRequest\"]}),\" authRequest \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"AuthenticationRequest\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write BackendKeyData\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BackendKeyData\"]}),\" backendKeyData \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BackendKeyData\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1234\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5678\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"backendKeyData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Then, write ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReadyForQuery\"]}),\" readyForQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReadyForQuery\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handleQueryMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGClientMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"QueryMessage\"]}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AsynchronousSocketChannel\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[SERVER] Query Message: \"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Future\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Let's assume it's a query message, and just send a simple response\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:`// First we send a RowDescription. We'll send two columns, with names \"id\" and \"name\"`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RowDescription\"]}),\" rowDescription \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RowDescription\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Field\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Field\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"rowDescription\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:`// Then we send a DataRow for each row. We'll send two rows, with values (1, \"one\") and (2, \"two\")`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DataRow\"]}),\" dataRow1 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DataRow\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"one\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dataRow1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DataRow\"]}),\" dataRow2 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DataRow\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"two\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StandardCharsets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"UTF_8\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dataRow2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// We send a CommandComplete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CommandComplete\"]}),\" commandComplete \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CommandComplete\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"SELECT 2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"commandComplete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Finally, write ReadyForQuery\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReadyForQuery\"]}),\" readyForQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"PGServerMessage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReadyForQuery\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    writeResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"write\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PGServerMessage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"encode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"readyForQuery\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        writeResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})})]})}}var w=b;function S(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"Outline","url":"#outline","depth":1},{"value":"Introduction to the PostgreSQL Wire Protocol","url":"#introduction-to-the-postgresql-wire-protocol","depth":1},{"value":"Step 1: Doing The Simplest Thing That Could Possibly Work (TM)","url":"#step-1-doing-the-simplest-thing-that-could-possibly-work-tm","depth":1},{"value":"Step 1.1 - Initial Server Skeleton","url":"#step-11---initial-server-skeleton","depth":2},{"value":"Connecting to the Server with psql","url":"#connecting-to-the-server-with-psql","depth":3},{"value":"Step 1.2 - Responding to the SSL Negotiation message and the Startup Message","url":"#step-12---responding-to-the-ssl-negotiation-message-and-the-startup-message","depth":2},{"value":"Step 1.3 - Differentiating between the SSL/Authentication request, and Command messages","url":"#step-13---differentiating-between-the-sslauthentication-request-and-command-messages","depth":2},{"value":"Step 1.4 - Handle a query and return data rows","url":"#step-14---handle-a-query-and-return-data-rows","depth":2},{"value":"Step 2: Refactoring","url":"#step-2-refactoring","depth":1},{"value":"Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 1. Client Side)","url":"#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-1-client-side","depth":2},{"value":"Refactoring into Sealed Interfaces with Records and Message Decoders (Pt 2. Server Side)","url":"#refactoring-into-sealed-interfaces-with-records-and-message-decoders-pt-2-server-side","depth":2}],"frontMatter":{"readingTime":{"text":"40 min read","minutes":39.435,"time":2366100,"words":7887},"slug":"postgres-wire-protocol-jdk-21","fileName":"postgres-wire-protocol-jdk-21.mdx","title":"Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21","date":"2023-01-16T00:00:00.000Z","tags":["java","jdk","jvm","postgres","wire-protocol","databases","server"],"draft":false,"summary":"A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function \u0026 Memory API.\n","images":["/static/images/postgres-wire-protocol-display-image.png"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.85,"time":51000,"words":170},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"Adding Design-by-Contract [[invariant]] conditions to C++, via a GCC plugin","date":"2022-12-31T00:00:00.000Z","tags":["cpp","gcc","design-by-contract"],"draft":false,"summary":"Design-by-Contract's invariant attribute allows you to enforce important properties of systems and data structures, making it an incredibly useful tool for developers. In this blog post, we'll be exploring the development of a GCC plugin that adds support for [[invariant]] conditions in C++ classes and structs. We'll also be looking at an example of how invariant can be used to improve the integrity of a Stack data structure. This is especially timely as GCC has recently added support for Contracts, allowing you to annotate functions with pre/post conditions. Don't miss out on learning how to use this powerful feature in your own projects!\n","images":["/static/images/design-by-contract-logo.png"],"slug":"adding-invariant-to-cpp-design-by-contract"},"next":{"title":"What good are Record Patterns in Java? An example based on Spark's Catalyst Optimizer and it's Tree Rewriting Rules","date":"2023-02-04T00:00:00.000Z","tags":["java","jdk","jvm"],"draft":false,"summary":"A tutorial on how to use Java's new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.\n","images":["/static/images/ast-visualization.png"],"slug":"what-good-are-record-patterns"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["postgres-wire-protocol-jdk-21"]},"buildId":"DWSLCyuJr0RZE9vUMLx8-","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>