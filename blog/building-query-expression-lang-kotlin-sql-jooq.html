<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ</title><meta name="robots" content="follow, index"/><meta name="description" content="A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation"/><meta property="og:url" content="https://gavinray97.github.io/blog/building-query-expression-lang-kotlin-sql-jooq"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Gavin Ray Blog"/><meta property="og:description" content="A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation"/><meta property="og:title" content="Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ"/><meta property="og:image" content="https://gavinray97.github.io/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/GavinRayDev"/><meta name="twitter:title" content="Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ"/><meta name="twitter:description" content="A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation"/><meta name="twitter:image" content="https://gavinray97.github.io/static/images/twitter-card.png"/><link rel="canonical" href="https://gavinray97.github.io/blog/building-query-expression-lang-kotlin-sql-jooq"/><meta property="article:published_time" content="2022-03-19T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gavinray97.github.io/blog/building-query-expression-lang-kotlin-sql-jooq"
  },
  "headline": "Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2022-03-19T00:00:00.000Z",
  "dateModified": "2022-03-19T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Gavin Ray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Gavin Ray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/logo.png"
    }
  },
  "description": "A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/520446def45941a6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/520446def45941a6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-608ae2945a2f0297.js" defer=""></script><script src="/_next/static/chunks/main-bb8a1082161dc7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-da15d2a3f366f449.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-dd685ae53e609b20.js" defer=""></script><script src="/_next/static/chunks/620-0b0422a5eb308c03.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-52c7b4963ecd0646.js" defer=""></script><script src="/_next/static/ZbXNnN9hf66Pg6jXsQWAA/_buildManifest.js" defer=""></script><script src="/_next/static/ZbXNnN9hf66Pg6jXsQWAA/_ssgManifest.js" defer=""></script><script src="/_next/static/ZbXNnN9hf66Pg6jXsQWAA/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="" href="/"><div class="flex items-center justify-between"><div class="mr-3"></div><div class="hidden h-6 text-2xl font-semibold sm:block"></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-03-19T00:00:00.000Z">Saturday, March 19, 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/me.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Gavin Ray</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@GavinRayDev</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pt-2 pb-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#overview">Overview</a></li><li class="ml-6"><a href="#motivation">Motivation</a></li><li class="ml-6"><a href="#goals">Goals</a></li><li class="false"><a href="#architecture">Architecture</a></li><li class="false"><a href="#lets-build-it">Let&#x27;s Build It</a></li><li class="ml-6"><a href="#implementing-the-expression-ast">Implementing the Expression AST</a></li><li class="ml-6"><a href="#the-query-object">The Query object</a></li><li class="ml-6"><a href="#the-expressiontranslator-interface">The ExpressionTranslator Interface</a></li><li class="ml-6"><a href="#a-simple-string-translator">A simple String translator</a></li><li class="ml-6"><a href="#testing-the-string-translator">Testing the String translator</a></li><li class="ml-6"><a href="#the-jooq-translator">The jOOQ translator</a></li><li class="ml-6"><a href="#testing-the-jooq-translator">Testing the jOOQ translator</a></li></ul></div></details><hr/><h1 id="overview"><a href="#overview" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Overview</h1><p>In this post we&#x27;ll walk through building a simple query expression language in Kotlin, and then using it to generate dynamic SQL. First via a simple string-producing function, then through a less fragile method via jOOQ&#x27;s query DSL.</p><h2 id="motivation"><a href="#motivation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Motivation</h2><p>This sort of AST/intermediate representation of data-compute operations is useful in many situations, including:</p><ul><li>Creating structured/serializeable expressions that can be transfered between systems<ul><li>See: <a target="_blank" rel="noopener noreferrer" href="https://substrait.io/">Substrait: Cross-Language Serialization for Relational Algebra</a></li></ul></li><li>Writing translations between query languages</li><li>The development of query engines and their planners/optimizers</li></ul><p>In my spare time over the past months I&#x27;ve had <a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/GraphQLCalcite">a passion project that involves parsing GraphQL queries into an IR, and then generating + executing SQL from it.</a></p><p>This post is an attempt to share some of the knowledge and tips I&#x27;ve gained from working on that project, as well as showcase what an excellent language Kotlin is.</p><h2 id="goals"><a href="#goals" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Goals</h2><p>What we&#x27;ll ultimately be building is a program that can consume/produce a structured operation expression like the below:</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;select&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;where&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EQ&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;COLUMN&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LITERAL&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;groupBy&quot;</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;orderBy&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And convert it into the corresponding SQL query:</p><div class="relative"><pre><code class="code-highlight language-sql"><span class="code-line"><span class="token keyword">select</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age
</span><span class="code-line"><span class="token keyword">from</span> users
</span><span class="code-line"><span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#x27;John&#x27;</span>
</span><span class="code-line"><span class="token keyword">order</span> <span class="token keyword">by</span> name
</span><span class="code-line"><span class="token keyword">offset</span> <span class="token number">2</span> <span class="token keyword">rows</span>
</span><span class="code-line"><span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token number">5</span> <span class="token keyword">rows</span> only
</span></code></pre></div><p>Represented as code, this expression will look like this:</p><div class="relative"><pre><code class="code-highlight language-kt"><span class="code-line"><span class="token function">Query</span><span class="token punctuation">(</span>
</span><span class="code-line">    from <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    select <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    orderBy <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    limit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
</span><span class="code-line">    offset <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">where</span> <span class="token operator">=</span> <span class="token function">EQ</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token function">COLUMN</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token function">LITERAL</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div><h1 id="architecture"><a href="#architecture" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Architecture</h1><p>The high-level architecture of the program is as follows:</p><ul><li>A sealed interface/algebraic data type, <code>Expression</code>, which represents the abstract syntax tree of a query <code>where</code> clause</li><li>An interface, <code>ExpressionTranslator&lt;T&gt;</code> which represents a function that translates an <code>Expression</code> into a concrete value<ul><li>A class, <code>SimpleStringExpressionTranslator</code>, which implements <code>ExpressionTranslator&lt;String&gt;</code></li><li>A class, <code>jOOQExpressionTranslator</code>, which implements <code>ExpressionTranslator&lt;org.jooq.QueryPart&gt;</code></li></ul></li><li>A class, <code>Query</code>, which contains the entirety of single query operation:<ul><li><code>select</code>/<code>from</code>/<code>where</code>/<code>group by</code>/<code>order by</code>/<code>limit</code>/<code>offset</code></li></ul></li><li>An interface, <code>QueryTranslator</code> which represents a function that translates a <code>Query</code> into a concrete value<ul><li>A class, <code>SimpleStringQueryTranslator</code>, which implements <code>QueryTranslator&lt;String&gt;</code></li><li>A class, <code>jOOQQueryTranslator</code>, which implements <code>QueryTranslator&lt;String&gt;</code></li></ul></li></ul><h1 id="lets-build-it"><a href="#lets-build-it" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s Build It</h1><h2 id="implementing-the-expression-ast"><a href="#implementing-the-expression-ast" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Implementing the <code>Expression</code> AST</h2><p>The below diagram shows the structure of the <code>Expression</code> interface we&#x27;ll be building (with some <code>BinaryOperation</code> members omitted for size):</p><img src="/static/images/kotlin-query-expression-hierarchy-diagram.svg"/><p>We have three <em>classes</em> of nodes:</p><ul><li><code>BinaryOperation</code>&#x27;s. These are operations that have two operands, such as <code>EQ</code>, <code>GT</code>, <code>LT</code>, etc, as well as the boolean <code>AND</code> and <code>OR</code></li><li><code>UnaryOperation</code>&#x27;s. These are operations that have one operand, such as <code>NOT</code>, <code>IS NULL</code>, etc</li><li>&quot;Other&quot; -- <code>COLUMN</code> and <code>LITERAL</code>, our two concrete/leaf nodes</li></ul><p>Represented as Kotlin types, these classes look like this:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> Expression
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> BinaryOperation <span class="token operator">:</span> Expression <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">val</span> <span class="token keyword">operator</span><span class="token operator">:</span> String
</span><span class="code-line">    <span class="token keyword">val</span> left<span class="token operator">:</span> Expression
</span><span class="code-line">    <span class="token keyword">val</span> right<span class="token operator">:</span> Expression
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> UnaryOperation <span class="token operator">:</span> Expression <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">val</span> <span class="token keyword">operator</span><span class="token operator">:</span> String
</span><span class="code-line">    <span class="token keyword">val</span> operand<span class="token operator">:</span> Expression
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">AND</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Expression<span class="token punctuation">,</span> <span class="token keyword">override</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Expression<span class="token punctuation">)</span> <span class="token operator">:</span> BinaryOperation <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">val</span> <span class="token keyword">operator</span> <span class="token operator">=</span> <span class="token string">&quot;AND&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">OR</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Expression<span class="token punctuation">,</span> <span class="token keyword">override</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Expression<span class="token punctuation">)</span> <span class="token operator">:</span> BinaryOperation <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">val</span> <span class="token keyword">operator</span> <span class="token operator">=</span> <span class="token string">&quot;OR&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">EQ</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> left<span class="token operator">:</span> Expression<span class="token punctuation">,</span> <span class="token keyword">override</span> <span class="token keyword">val</span> right<span class="token operator">:</span> Expression<span class="token punctuation">)</span> <span class="token operator">:</span> BinaryOperation <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">val</span> <span class="token keyword">operator</span> <span class="token operator">=</span> <span class="token string">&quot;=&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Let&#x27;s skip the rest of the `BinaryOperation`s for brevity</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">NOT</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> operand<span class="token operator">:</span> Expression<span class="token punctuation">)</span> <span class="token operator">:</span> UnaryOperation <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">val</span> <span class="token keyword">operator</span> <span class="token operator">=</span> <span class="token string">&quot;NOT&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">IS_NULL</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> operand<span class="token operator">:</span> Expression<span class="token punctuation">)</span> <span class="token operator">:</span> UnaryOperation <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">val</span> <span class="token keyword">operator</span> <span class="token operator">=</span> <span class="token string">&quot;IS NULL&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">COLUMN</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> Expression
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">LITERAL</span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> Any<span class="token punctuation">)</span> <span class="token operator">:</span> Expression
</span></code></pre></div><h2 id="the-query-object"><a href="#the-query-object" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The <code>Query</code> object</h2><p>Below will be our representation of a query:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Query</span><span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token keyword">val</span> select<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> from<span class="token operator">:</span> String<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> <span class="token keyword">where</span><span class="token operator">:</span> Expression<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> groupBy<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> orderBy<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> limit<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">val</span> offset<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div><h2 id="the-expressiontranslator-interface"><a href="#the-expressiontranslator-interface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The <code>ExpressionTranslator</code> Interface</h2><p>We need an interface/typeclass that allows us to translate an <code>Expression</code> into a concrete value.</p><p>This is the purpose of <code>ExpressionTranslator</code>:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">interface</span> ExpressionTranslator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token operator">:</span> Expression<span class="token punctuation">)</span><span class="token operator">:</span> T
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="a-simple-string-translator"><a href="#a-simple-string-translator" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A simple String translator</h3><p>Now we can implement the equivalent of an &quot;interpreter&quot; that produces a string from an <code>Expression</code> AST.</p><p>We&#x27;ll call this object <code>SimpleStringExpressionTranslator</code>, and it will implement the <code>ExpressionTranslator&lt;String&gt;</code> interface:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">interface</span> ExpressionTranslator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token operator">:</span> Expression<span class="token punctuation">)</span><span class="token operator">:</span> T
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">object</span> SimpleStringExpressionTranslator <span class="token operator">:</span> ExpressionTranslator<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token operator">:</span> Expression<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">is</span> COLUMN <span class="token operator">-&gt;</span> expression<span class="token punctuation">.</span>name
</span><span class="code-line">            <span class="token keyword">is</span> LITERAL <span class="token operator">-&gt;</span> expression<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">is</span> BinaryOperation <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">val</span> left <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">val</span> right <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token string">&quot;<span class="token variable interpolation">$left</span> <span class="token interpolation"><span class="token variable delimiter">${</span>expression<span class="token punctuation">.</span>operator<span class="token variable delimiter">}</span></span> <span class="token variable interpolation">$right</span>&quot;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">is</span> UnaryOperation <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">val</span> operand <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>operand<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token string">&quot;<span class="token interpolation"><span class="token variable delimiter">${</span>expression<span class="token punctuation">.</span>operator<span class="token variable delimiter">}</span></span> <span class="token variable interpolation">$operand</span>&quot;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>We&#x27;ll combine this translator for the <code>where</code> clause of a query with a translator for the other bits of a query, to produce a complete SQL expression:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">fun</span> <span class="token keyword">interface</span> QueryTranslator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span><span class="token operator">:</span> T
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">object</span> SimpleStringQueryTranslator <span class="token operator">:</span> QueryTranslator<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">val</span> select <span class="token operator">=</span> query<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">joinToString</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">val</span> <span class="token keyword">where</span> <span class="token operator">=</span> query<span class="token punctuation">.</span>where<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> SimpleStringExpressionTranslator<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">val</span> groupBy <span class="token operator">=</span> query<span class="token punctuation">.</span>groupBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">joinToString</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">val</span> orderBy <span class="token operator">=</span> query<span class="token punctuation">.</span>orderBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">joinToString</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">val</span> limit <span class="token operator">=</span> query<span class="token punctuation">.</span>limit
</span><span class="code-line">        <span class="token keyword">val</span> offset <span class="token operator">=</span> query<span class="token punctuation">.</span>offset
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string raw-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string raw-string">            SELECT <span class="token variable interpolation">$select</span>
</span></span><span class="code-line"><span class="token string raw-string">            FROM <span class="token interpolation"><span class="token variable delimiter">${</span>query<span class="token punctuation">.</span>from<span class="token variable delimiter">}</span></span>
</span></span><span class="code-line"><span class="token string raw-string">            <span class="token interpolation"><span class="token variable delimiter">${</span><span class="token keyword">where</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token string">&quot;WHERE <span class="token variable interpolation">$it</span>&quot;</span> <span class="token variable delimiter">}</span></span> ?: &quot;&quot;}
</span></span><span class="code-line"><span class="token string raw-string">            <span class="token interpolation"><span class="token variable delimiter">${</span>groupBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token string">&quot;GROUP BY <span class="token variable interpolation">$it</span>&quot;</span> <span class="token variable delimiter">}</span></span> ?: &quot;&quot;}
</span></span><span class="code-line"><span class="token string raw-string">            <span class="token interpolation"><span class="token variable delimiter">${</span>orderBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token string">&quot;ORDER BY <span class="token variable interpolation">$it</span>&quot;</span> <span class="token variable delimiter">}</span></span> ?: &quot;&quot;}
</span></span><span class="code-line"><span class="token string raw-string">            <span class="token interpolation"><span class="token variable delimiter">${</span>limit<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token string">&quot;LIMIT <span class="token variable interpolation">$it</span>&quot;</span> <span class="token variable delimiter">}</span></span> ?: &quot;&quot;}
</span></span><span class="code-line"><span class="token string raw-string">            <span class="token interpolation"><span class="token variable delimiter">${</span>offset<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token string">&quot;OFFSET <span class="token variable interpolation">$it</span>&quot;</span> <span class="token variable delimiter">}</span></span> ?: &quot;&quot;}
</span></span><span class="code-line"><span class="token string raw-string">        &quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">trimIndent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="testing-the-string-translator"><a href="#testing-the-string-translator" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Testing the String translator</h3><p>Now we can <a target="_blank" rel="noopener noreferrer" href="https://pl.kotl.in/3PgFe73wT">test our simple translator in the Kotlin Playground</a>:</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">val</span> expression <span class="token operator">=</span> <span class="token function">AND</span><span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token function">OR</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token function">EQ</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token function">COLUMN</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token function">LITERAL</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token function">LT</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token function">COLUMN</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token function">LITERAL</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token function">NOT</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token function">EQ</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token function">COLUMN</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token function">LITERAL</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">val</span> query <span class="token operator">=</span> <span class="token function">Query</span><span class="token punctuation">(</span>
</span><span class="code-line">    from <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    select <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    orderBy <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    limit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
</span><span class="code-line">    offset <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">where</span> <span class="token operator">=</span> expression
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">val</span> t <span class="token operator">=</span> SimpleStringQueryTranslator
</span><span class="code-line"><span class="token keyword">val</span> result <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</span></code></pre></div><p>The output should be:</p><div class="relative"><pre><code class="code-highlight language-sql"><span class="code-line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age
</span><span class="code-line"><span class="token keyword">FROM</span> users
</span><span class="code-line"><span class="token keyword">WHERE</span> name <span class="token operator">=</span> John <span class="token operator">OR</span> age <span class="token operator">&lt;</span> <span class="token number">30</span> <span class="token operator">AND</span> <span class="token operator">NOT</span> id <span class="token operator">=</span> <span class="token number">42</span>
</span><span class="code-line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name
</span><span class="code-line"><span class="token keyword">LIMIT</span> <span class="token number">5</span>
</span><span class="code-line"><span class="token keyword">OFFSET</span> <span class="token number">2</span>
</span></code></pre></div><h3 id="the-jooq-translator"><a href="#the-jooq-translator" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The jOOQ translator</h3><p>Now we&#x27;ll implement the above, but using jOOQ&#x27;s DSL API.</p><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">object</span> jOOQExpressionTranslator <span class="token operator">:</span> ExpressionTranslator<span class="token operator">&lt;</span>QueryPart<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token operator">:</span> Expression<span class="token punctuation">)</span><span class="token operator">:</span> QueryPart <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">is</span> COLUMN <span class="token operator">-&gt;</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">is</span> LITERAL <span class="token operator">-&gt;</span> <span class="token keyword">inline</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">is</span> BinaryOperation <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">val</span> left <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">val</span> right <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">when</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token keyword">is</span> AND <span class="token operator">-&gt;</span> <span class="token function">and</span><span class="token punctuation">(</span>left <span class="token keyword">as</span> Condition<span class="token punctuation">,</span> right <span class="token keyword">as</span> Condition<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> OR <span class="token operator">-&gt;</span> <span class="token function">or</span><span class="token punctuation">(</span>left <span class="token keyword">as</span> Condition<span class="token punctuation">,</span> right <span class="token keyword">as</span> Condition<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> EQ <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> NEQ <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> LT <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> LTE <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> GT <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> GTE <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> IN <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>left <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">`in`</span><span class="token punctuation">(</span>right <span class="token keyword">as</span> Any<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">is</span> UnaryOperation <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">val</span> operand <span class="token operator">=</span> <span class="token function">translate</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span>operand<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">when</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token keyword">is</span> NOT <span class="token operator">-&gt;</span> <span class="token function">not</span><span class="token punctuation">(</span>operand <span class="token keyword">as</span> Condition<span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token keyword">is</span> IS_NULL <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>operand <span class="token keyword">as</span> Field<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isNull
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-kotlin code-highlight"><span class="code-line"><span class="token keyword">object</span> jOOQQueryTranslator <span class="token operator">:</span> QueryTranslator<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">val</span> ctx<span class="token operator">:</span> DSLContext <span class="token operator">=</span> DSL<span class="token punctuation">.</span><span class="token function">using</span><span class="token punctuation">(</span>
</span><span class="code-line">        SQLDialect<span class="token punctuation">.</span>POSTGRES<span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token function">Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">withRenderFormatted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">withRenderQuotedNames</span><span class="token punctuation">(</span>RenderQuotedNames<span class="token punctuation">.</span>EXPLICIT_DEFAULT_UNQUOTED<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">translate</span><span class="token punctuation">(</span>query<span class="token operator">:</span> Query<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">val</span> statement <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
</span><span class="code-line">                query<span class="token punctuation">.</span>where<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token keyword">where</span><span class="token punctuation">(</span>jOOQExpressionTranslator<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token keyword">as</span> Condition<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">                query<span class="token punctuation">.</span>groupBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token function">groupBy</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">                query<span class="token punctuation">.</span>orderBy<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token function">orderBy</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">                query<span class="token punctuation">.</span>limit<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token function">limit</span><span class="token punctuation">(</span><span class="token keyword">inline</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">                query<span class="token punctuation">.</span>offset<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> <span class="token function">offset</span><span class="token punctuation">(</span><span class="token keyword">inline</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="testing-the-jooq-translator"><a href="#testing-the-jooq-translator" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Testing the jOOQ translator</h3><p>Unfortunately due to needing the jOOQ library, we can&#x27;t test this in the Kotlin Playground.</p><p>But, I&#x27;ve uploaded the full working application to repl.it <a target="_blank" rel="noopener noreferrer" href="https://replit.com/@GavinRay97/Blogpost-Building-a-Query-Expression-Language-in-Kotlin-mvn#src/main/kotlin/Application.kt">that you can access here</a>:</p><blockquote><p>Note: Scroll up slightly in the <code>Console</code> panel at the bottom of the repl.it embed below to see the <code>println()</code> output of the generated SQL</p></blockquote><iframe frameborder="0" width="100%" height="500px" src="https://replit.com/@GavinRay97/Blogpost-Building-a-Query-Expression-Language-in-Kotlin-mvn?lite=true"></iframe></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fgavinray97.github.io%2Fblog%2Fbuilding-query-expression-lang-kotlin-sql-jooq">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/GavinRay97.github.io/blob/master/data/blog/building-query-expression-lang-kotlin-sql-jooq.mdx">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kotlin">kotlin</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/sql">sql</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jvm">jvm</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/query-engines">query-engines</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jooq">jooq</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/panama-not-so-foreign-memory">Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:ray.gavin97@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Gavin Ray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">Gavin Ray Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var o=a=\u003el(a,\"__esModule\",{value:!0});var k=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{o(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},y=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!N.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ey(o(l(a!=null?p(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=k((E,i)=\u003e{i.exports=_jsx_runtime});var b={};u(b,{default:()=\u003ev,frontmatter:()=\u003ew});var n=g(r()),w={title:\"Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ\",date:\"2022-03-19\",tags:[\"kotlin\",\"sql\",\"jvm\",\"query-engines\",\"jooq\"],draft:!1,summary:\"A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation\",images:[]};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",h2:\"h2\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",em:\"em\",h3:\"h3\",blockquote:\"blockquote\"},a.components),{TOCInline:t}=e;return t||x(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{toc:a.toc,indentDepth:2,asDisclosure:!0}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h1,{id:\"overview\",children:[(0,n.jsx)(e.a,{href:\"#overview\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Overview\"]}),(0,n.jsx)(e.p,{children:\"In this post we'll walk through building a simple query expression language in Kotlin, and then using it to generate dynamic SQL. First via a simple string-producing function, then through a less fragile method via jOOQ's query DSL.\"}),(0,n.jsxs)(e.h2,{id:\"motivation\",children:[(0,n.jsx)(e.a,{href:\"#motivation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Motivation\"]}),(0,n.jsx)(e.p,{children:\"This sort of AST/intermediate representation of data-compute operations is useful in many situations, including:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Creating structured/serializeable expressions that can be transfered between systems\",(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[\"See: \",(0,n.jsx)(e.a,{href:\"https://substrait.io/\",children:\"Substrait: Cross-Language Serialization for Relational Algebra\"})]})})]}),(0,n.jsx)(e.li,{children:\"Writing translations between query languages\"}),(0,n.jsx)(e.li,{children:\"The development of query engines and their planners/optimizers\"})]}),(0,n.jsxs)(e.p,{children:[\"In my spare time over the past months I've had \",(0,n.jsx)(e.a,{href:\"https://github.com/GavinRay97/GraphQLCalcite\",children:\"a passion project that involves parsing GraphQL queries into an IR, and then generating + executing SQL from it.\"})]}),(0,n.jsx)(e.p,{children:\"This post is an attempt to share some of the knowledge and tips I've gained from working on that project, as well as showcase what an excellent language Kotlin is.\"}),(0,n.jsxs)(e.h2,{id:\"goals\",children:[(0,n.jsx)(e.a,{href:\"#goals\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Goals\"]}),(0,n.jsx)(e.p,{children:\"What we'll ultimately be building is a program that can consume/produce a structured operation expression like the below:\"}),(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-json\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"select\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"age\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"from\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"users\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"where\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"type\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"EQ\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"left\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"type\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"COLUMN\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"right\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"type\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"LITERAL\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"value\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"John\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"groupBy\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword null\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"orderBy\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"limit\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"offset\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"And convert it into the corresponding SQL query:\"}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-sql\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` age\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` users\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'John'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"order\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"by\"}),` name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"offset\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"rows\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fetch\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"next\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"rows\"}),` only\n`]})]})}),(0,n.jsx)(e.p,{children:\"Represented as code, this expression will look like this:\"}),(0,n.jsx)(e.pre,{className:\"language-kt\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-kt\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"Query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    from \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"users\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    select \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"listOf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"age\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    orderBy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"listOf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    limit \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EQ\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"COLUMN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LITERAL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"John\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"architecture\",children:[(0,n.jsx)(e.a,{href:\"#architecture\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Architecture\"]}),(0,n.jsx)(e.p,{children:\"The high-level architecture of the program is as follows:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"A sealed interface/algebraic data type, \",(0,n.jsx)(e.code,{children:\"Expression\"}),\", which represents the abstract syntax tree of a query \",(0,n.jsx)(e.code,{children:\"where\"}),\" clause\"]}),(0,n.jsxs)(e.li,{children:[\"An interface, \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\u003cT\u003e\"}),\" which represents a function that translates an \",(0,n.jsx)(e.code,{children:\"Expression\"}),\" into a concrete value\",(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"A class, \",(0,n.jsx)(e.code,{children:\"SimpleStringExpressionTranslator\"}),\", which implements \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\u003cString\u003e\"})]}),(0,n.jsxs)(e.li,{children:[\"A class, \",(0,n.jsx)(e.code,{children:\"jOOQExpressionTranslator\"}),\", which implements \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\u003corg.jooq.QueryPart\u003e\"})]})]})]}),(0,n.jsxs)(e.li,{children:[\"A class, \",(0,n.jsx)(e.code,{children:\"Query\"}),\", which contains the entirety of single query operation:\",(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"select\"}),\"/\",(0,n.jsx)(e.code,{children:\"from\"}),\"/\",(0,n.jsx)(e.code,{children:\"where\"}),\"/\",(0,n.jsx)(e.code,{children:\"group by\"}),\"/\",(0,n.jsx)(e.code,{children:\"order by\"}),\"/\",(0,n.jsx)(e.code,{children:\"limit\"}),\"/\",(0,n.jsx)(e.code,{children:\"offset\"})]})})]}),(0,n.jsxs)(e.li,{children:[\"An interface, \",(0,n.jsx)(e.code,{children:\"QueryTranslator\"}),\" which represents a function that translates a \",(0,n.jsx)(e.code,{children:\"Query\"}),\" into a concrete value\",(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"A class, \",(0,n.jsx)(e.code,{children:\"SimpleStringQueryTranslator\"}),\", which implements \",(0,n.jsx)(e.code,{children:\"QueryTranslator\u003cString\u003e\"})]}),(0,n.jsxs)(e.li,{children:[\"A class, \",(0,n.jsx)(e.code,{children:\"jOOQQueryTranslator\"}),\", which implements \",(0,n.jsx)(e.code,{children:\"QueryTranslator\u003cString\u003e\"})]})]})]})]}),(0,n.jsxs)(e.h1,{id:\"lets-build-it\",children:[(0,n.jsx)(e.a,{href:\"#lets-build-it\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Let's Build It\"]}),(0,n.jsxs)(e.h2,{id:\"implementing-the-expression-ast\",children:[(0,n.jsx)(e.a,{href:\"#implementing-the-expression-ast\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Implementing the \",(0,n.jsx)(e.code,{children:\"Expression\"}),\" AST\"]}),(0,n.jsxs)(e.p,{children:[\"The below diagram shows the structure of the \",(0,n.jsx)(e.code,{children:\"Expression\"}),\" interface we'll be building (with some \",(0,n.jsx)(e.code,{children:\"BinaryOperation\"}),\" members omitted for size):\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/kotlin-query-expression-hierarchy-diagram.svg\"}),(0,n.jsxs)(e.p,{children:[\"We have three \",(0,n.jsx)(e.em,{children:\"classes\"}),\" of nodes:\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"BinaryOperation\"}),\"'s. These are operations that have two operands, such as \",(0,n.jsx)(e.code,{children:\"EQ\"}),\", \",(0,n.jsx)(e.code,{children:\"GT\"}),\", \",(0,n.jsx)(e.code,{children:\"LT\"}),\", etc, as well as the boolean \",(0,n.jsx)(e.code,{children:\"AND\"}),\" and \",(0,n.jsx)(e.code,{children:\"OR\"})]}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"UnaryOperation\"}),\"'s. These are operations that have one operand, such as \",(0,n.jsx)(e.code,{children:\"NOT\"}),\", \",(0,n.jsx)(e.code,{children:\"IS NULL\"}),\", etc\"]}),(0,n.jsxs)(e.li,{children:['\"Other\" -- ',(0,n.jsx)(e.code,{children:\"COLUMN\"}),\" and \",(0,n.jsx)(e.code,{children:\"LITERAL\"}),\", our two concrete/leaf nodes\"]})]}),(0,n.jsx)(e.p,{children:\"Represented as Kotlin types, these classes look like this:\"}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),` Expression\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` String\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Expression\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Expression\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" UnaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` String\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" operand\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Expression\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"AND\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AND\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"OR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"OR\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EQ\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Let's skip the rest of the `BinaryOperation`s for brevity\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"NOT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" operand\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" UnaryOperation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"NOT\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"IS_NULL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" operand\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" UnaryOperation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"operator\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"IS NULL\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"COLUMN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" String\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Expression\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LITERAL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" value\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Any\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Expression\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"the-query-object\",children:[(0,n.jsx)(e.a,{href:\"#the-query-object\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The \",(0,n.jsx)(e.code,{children:\"Query\"}),\" object\"]}),(0,n.jsx)(e.p,{children:\"Below will be our representation of a query:\"}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"data\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" select\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" List\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" from\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" String\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" groupBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" List\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" orderBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" List\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" limit\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Int\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" offset\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Int\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"the-expressiontranslator-interface\",children:[(0,n.jsx)(e.a,{href:\"#the-expressiontranslator-interface\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\"}),\" Interface\"]}),(0,n.jsxs)(e.p,{children:[\"We need an interface/typeclass that allows us to translate an \",(0,n.jsx)(e.code,{children:\"Expression\"}),\" into a concrete value.\"]}),(0,n.jsxs)(e.p,{children:[\"This is the purpose of \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\"}),\":\"]}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" ExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"T\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` T\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"a-simple-string-translator\",children:[(0,n.jsx)(e.a,{href:\"#a-simple-string-translator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"A simple String translator\"]}),(0,n.jsxs)(e.p,{children:['Now we can implement the equivalent of an \"interpreter\" that produces a string from an ',(0,n.jsx)(e.code,{children:\"Expression\"}),\" AST.\"]}),(0,n.jsxs)(e.p,{children:[\"We'll call this object \",(0,n.jsx)(e.code,{children:\"SimpleStringExpressionTranslator\"}),\", and it will implement the \",(0,n.jsx)(e.code,{children:\"ExpressionTranslator\u003cString\u003e\"}),\" interface:\"]}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" ExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"T\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` T\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"object\"}),\" SimpleStringExpressionTranslator \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" ExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" String \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"when\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" COLUMN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" LITERAL \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"left\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$left\"}),\" \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"operator\",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$right\"}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" UnaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" operand \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"operand\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"operator\",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$operand\"}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"We'll combine this translator for the \",(0,n.jsx)(e.code,{children:\"where\"}),\" clause of a query with a translator for the other bits of a query, to produce a complete SQL expression:\"]}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" QueryTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"T\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` T\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"object\"}),\" SimpleStringQueryTranslator \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" QueryTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" String \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" select \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"select\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"joinToString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" SimpleStringExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" groupBy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"groupBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"joinToString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" orderBy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"joinToString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\", \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" limit \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`limit\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`offset\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token string raw-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            SELECT \",(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$select\"}),`\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            FROM \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from\",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),`\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"WHERE ',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$it\"}),'\"']}),\" \",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),` ?: \"\"}\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"groupBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"GROUP BY ',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$it\"}),'\"']}),\" \",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),` ?: \"\"}\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"orderBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"ORDER BY ',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$it\"}),'\"']}),\" \",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),` ?: \"\"}\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"limit\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"LIMIT ',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$it\"}),'\"']}),\" \",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),` ?: \"\"}\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string raw-string\",children:[\"            \",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"${\"}),\"offset\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"OFFSET ',(0,n.jsx)(e.span,{className:\"token variable interpolation\",children:\"$it\"}),'\"']}),\" \",(0,n.jsx)(e.span,{className:\"token variable delimiter\",children:\"}\"})]}),` ?: \"\"}\n`]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string raw-string\",children:'        \"\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"trimIndent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"testing-the-string-translator\",children:[(0,n.jsx)(e.a,{href:\"#testing-the-string-translator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing the String translator\"]}),(0,n.jsxs)(e.p,{children:[\"Now we can \",(0,n.jsx)(e.a,{href:\"https://pl.kotl.in/3PgFe73wT\",children:\"test our simple translator in the Kotlin Playground\"}),\":\"]}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" expression \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"AND\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"OR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EQ\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"COLUMN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LITERAL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"John\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"COLUMN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"age\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LITERAL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"NOT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EQ\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"COLUMN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token function\",children:\"LITERAL\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"42\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    from \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"users\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    select \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"listOf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"age\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    orderBy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"listOf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    limit \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` expression\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" t \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` SimpleStringQueryTranslator\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"The output should be:\"}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-sql\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` age\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),` users\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WHERE\"}),\" name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" John \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"OR\"}),\" age \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"AND\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"NOT\"}),\" id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"42\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"BY\"}),` name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"LIMIT\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"OFFSET\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"the-jooq-translator\",children:[(0,n.jsx)(e.a,{href:\"#the-jooq-translator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The jOOQ translator\"]}),(0,n.jsx)(e.p,{children:\"Now we'll implement the above, but using jOOQ's DSL API.\"}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"object\"}),\" jOOQExpressionTranslator \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" ExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"QueryPart\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" QueryPart \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"when\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" COLUMN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" LITERAL \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"inline\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" BinaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" left \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"left\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" right \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"when\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" AND \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"and\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" right \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" OR \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"or\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" right \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" EQ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"eq\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" NEQ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ne\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" LT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"lt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" LTE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"le\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" GT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"gt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" GTE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ge\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" IN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"left \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"`in`\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"right \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Any\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" UnaryOperation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" operand \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"operand\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"when\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" NOT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"not\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"operand \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" IS_NULL \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"operand \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Field\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Any\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`isNull\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-kotlin\",children:(0,n.jsxs)(e.code,{className:\"language-kotlin code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"object\"}),\" jOOQQueryTranslator \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" QueryTranslator\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"String\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" ctx\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" DSLContext \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" DSL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"using\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        SQLDialect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"POSTGRES\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Settings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withRenderFormatted\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withRenderQuotedNames\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"RenderQuotedNames\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"EXPLICIT_DEFAULT_UNQUOTED\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"override\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fun\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" String \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" statement \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"select\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"select\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"table\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"apply\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"jOOQExpressionTranslator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"translate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Condition\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"groupBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderBy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"orderBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"limit\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"limit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"inline\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"offset\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"let\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"offset\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"inline\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"it\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"render\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"statement\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"testing-the-jooq-translator\",children:[(0,n.jsx)(e.a,{href:\"#testing-the-jooq-translator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing the jOOQ translator\"]}),(0,n.jsx)(e.p,{children:\"Unfortunately due to needing the jOOQ library, we can't test this in the Kotlin Playground.\"}),(0,n.jsxs)(e.p,{children:[\"But, I've uploaded the full working application to repl.it \",(0,n.jsx)(e.a,{href:\"https://replit.com/@GavinRay97/Blogpost-Building-a-Query-Expression-Language-in-Kotlin-mvn#src/main/kotlin/Application.kt\",children:\"that you can access here\"}),\":\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"Note: Scroll up slightly in the \",(0,n.jsx)(e.code,{children:\"Console\"}),\" panel at the bottom of the repl.it embed below to see the \",(0,n.jsx)(e.code,{children:\"println()\"}),\" output of the generated SQL\"]})}),(0,n.jsx)(\"iframe\",{frameborder:\"0\",width:\"100%\",height:\"500px\",src:\"https://replit.com/@GavinRay97/Blogpost-Building-a-Query-Expression-Language-in-Kotlin-mvn?lite=true\"})]})}}var v=f;function x(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return b;})();\n;return Component;","toc":[{"value":"Overview","url":"#overview","depth":1},{"value":"Motivation","url":"#motivation","depth":2},{"value":"Goals","url":"#goals","depth":2},{"value":"Architecture","url":"#architecture","depth":1},{"value":"Let's Build It","url":"#lets-build-it","depth":1},{"value":"Implementing the Expression AST","url":"#implementing-the-expression-ast","depth":2},{"value":"The Query object","url":"#the-query-object","depth":2},{"value":"The ExpressionTranslator Interface","url":"#the-expressiontranslator-interface","depth":2},{"value":"A simple String translator","url":"#a-simple-string-translator","depth":3},{"value":"Testing the String translator","url":"#testing-the-string-translator","depth":3},{"value":"The jOOQ translator","url":"#the-jooq-translator","depth":3},{"value":"Testing the jOOQ translator","url":"#testing-the-jooq-translator","depth":3}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.31,"time":738600,"words":2462},"slug":"building-query-expression-lang-kotlin-sql-jooq","fileName":"building-query-expression-lang-kotlin-sql-jooq.mdx","title":"Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ","date":"2022-03-19T00:00:00.000Z","tags":["kotlin","sql","jvm","query-engines","jooq"],"draft":false,"summary":"A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.23,"time":13800,"words":46},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":null,"next":{"title":"Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.","date":"2022-09-03T00:00:00.000Z","tags":["java","jvm","foreign-memory","panama"],"draft":false,"summary":"An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications","images":[],"slug":"panama-not-so-foreign-memory"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["building-query-expression-lang-kotlin-sql-jooq"]},"buildId":"ZbXNnN9hf66Pg6jXsQWAA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>