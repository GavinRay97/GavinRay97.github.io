<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.</title><meta name="robots" content="follow, index"/><meta name="description" content="An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications"/><meta property="og:url" content="https://tailwind-nextjs-starter-blog.vercel.app/blog/panama-not-so-foreign-memory"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Gavin Ray Blog"/><meta property="og:description" content="An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications"/><meta property="og:title" content="Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement."/><meta property="og:image" content="https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/GavinRayDev"/><meta name="twitter:title" content="Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement."/><meta name="twitter:description" content="An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications"/><meta name="twitter:image" content="https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png"/><link rel="canonical" href="https://tailwind-nextjs-starter-blog.vercel.app/blog/panama-not-so-foreign-memory"/><meta property="article:published_time" content="2022-09-03T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tailwind-nextjs-starter-blog.vercel.app/blog/panama-not-so-foreign-memory"
  },
  "headline": "Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2022-09-03T00:00:00.000Z",
  "dateModified": "2022-09-03T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Gavin Ray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Gavin Ray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tailwind-nextjs-starter-blog.vercel.app/static/images/logo.png"
    }
  },
  "description": "An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/2c675d2f0823f12c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2c675d2f0823f12c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-796a8eaf6e3a4c88.js" defer=""></script><script src="/_next/static/chunks/main-bb8a1082161dc7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c210f8190a2b13b4.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-dd685ae53e609b20.js" defer=""></script><script src="/_next/static/chunks/620-0b0422a5eb308c03.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-52c7b4963ecd0646.js" defer=""></script><script src="/_next/static/_OoQ-D-sxB0bbLNidnYJW/_buildManifest.js" defer=""></script><script src="/_next/static/_OoQ-D-sxB0bbLNidnYJW/_ssgManifest.js" defer=""></script><script src="/_next/static/_OoQ-D-sxB0bbLNidnYJW/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="" href="/"><div class="flex items-center justify-between"><div class="mr-3"></div><div class="hidden h-6 text-2xl font-semibold sm:block"></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-09-03T00:00:00.000Z">Saturday, September 3, 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/me.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Gavin Ray</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@GavinRayDev</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pt-2 pb-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#preface">Preface</a></li><li class="false"><a href="#overview">Overview</a></li><li class="false"><a href="#implementation-offset-based">Implementation (Offset-based)</a></li><li class="false"><a href="#implementation-structure-based">Implementation (Structure-based)</a></li><li class="false"><a href="#further-tips--tricks">Further Tips &amp; Tricks</a></li><li class="ml-6"><a href="#conversions-between-memorysegment-and-arrays-or-bytebuffers">Conversions between MemorySegment and arrays or ByteBuffers</a></li><li class="ml-6"><a href="#working-with-char-or-similar---opaque-sized-binary-chunk">Working with char* (or similar - opaque, sized binary chunk)</a></li><li class="ml-6"><a href="#autogenerating-readerwriter-code-for-binary-data-types">Autogenerating reader/writer code for binary data types</a></li><li class="false"><a href="#resources-thanks--acknowledgements">Resources, Thanks &amp; Acknowledgements</a></li><li class="false"><a href="#future-discussion">Future Discussion</a></li></ul></div></details><hr/><h1 id="preface"><a href="#preface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Preface</h1><p>If I asked you to write performance-sensitive code for working with binary data/bytes on the JVM, you&#x27;d probably use one of the following:</p><ul><li><code>byte[]</code></li><li><code>ByteBuffer</code></li><li><code>Unsafe</code></li></ul><p>These are fine answers -- and, to date, essentially the <em>only</em> answers.</p><p>While reading the <a target="_blank" rel="noopener noreferrer" href="https://github.com/openjdk/panama-foreign/blob/foreign-memaccess%2Babi/doc/panama_memaccess.md#segments">Panama Memory Access explainer</a>, I recognized a usecase based on hobby projects I&#x27;d done lately which (to me) wasn&#x27;t immediately obvious from the document or the names of the API&#x27;s:</p><p>Panama&#x27;s <code>MemorySegment</code> API provides a drop-in compatible <code>ByteBuffer</code> replacement with better performance, no 2GB size limit, and proper API&#x27;s for working with structured binary data.</p><p>Even if there&#x27;s nothing &quot;Foreign&quot;/&quot;Native&quot; about your data, if you&#x27;re working with bytes &amp; bits, you could likely benefit from Panama.</p><p>Let&#x27;s take a look at how.</p><h1 id="overview"><a href="#overview" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Overview</h1><p>I have an avid interest in databases/query engines, and during the past months have been spending most of my spare time studying their internals.</p><p>If you write a DB on the JVM, you need be able to read/write binary data efficiently. Educational databases like SimpleDB use <code>ByteBuffer</code>, but we can do better nowadays.</p><p><strong>Let&#x27;s look at a real-world implementation:</strong></p><p>What we&#x27;ll implement is the reading/writing of a database&#x27;s <code>Heap File Page</code> header using MemorySegment&#x27;s. The design is taken from <a target="_blank" rel="noopener noreferrer" href="https://github.com/cmu-db/bustub/blob/734cd67a7834886f4c172514f188919fbbfb9d88/src/include/storage/page/table_page.h#L27-L44">CMU&#x27;s BusTub educational DB</a>:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">Header format (size in bytes):
</span><span class="code-line">----------------------------------------------------------------------------
</span><span class="code-line">| PageId (4)| LSN (4)| PrevPageId (4)| NextPageId (4)| FreeSpacePointer(4) |
</span><span class="code-line">----------------------------------------------------------------------------
</span><span class="code-line">----------------------------------------------------------------
</span><span class="code-line">| TupleCount (4) | Tuple_1 offset (4) | Tuple_1 size (4) | ... |
</span><span class="code-line">----------------------------------------------------------------
</span></code></pre></div><h1 id="implementation-offset-based"><a href="#implementation-offset-based" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Implementation (Offset-based)</h1><p>In a proper implementation, the <code>getter</code>/<code>setter</code> would proxy the underlying access to the memory segment. (You don&#x27;t want to allocate objects and perform extra serialization)</p><p>Because that&#x27;d be a lot of boilerplate code, what we&#x27;ll do instead is make a POJO that has <code>fromBytes()</code> and <code>toBytes()</code> method, which will illustrate the same idea:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> pageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> lsn<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> prevPageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> nextPageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> freeSpacePointer<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> tupleCount<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Constructor omitted</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token function">fromBytes</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">(</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> lsn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> prevPageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> nextPageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> freeSpacePointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> tupleCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h1 id="implementation-structure-based"><a href="#implementation-structure-based" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Implementation (Structure-based)</h1><p>Using it offset-based in this way is nearly identical to the API you&#x27;re used to from ByteBuffer. There&#x27;s not much else to it.</p><p>But <code>MemorySegment</code> also offers us a structure-based API, where we can define the shape of our binary data and use varhandles to reference the member offsets.</p><p>Implementing that looks something like this:</p><blockquote><p>Note: See &quot;Tips &amp; Tricks&quot; to see how this can be auto-generated</p></blockquote><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">MemoryLayout</span> HEADER_LAYOUT <span class="token operator">=</span> <span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">structLayout</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;pageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;lsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;prevPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;nextPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;freeSpacePointer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;tupleCount&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_PAGE_ID <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;pageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_LSN <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;lsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_PREV_PAGE_ID <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;prevPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_NEXT_PAGE_ID <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;nextPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_FREE_SPACE_POINTER <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;freeSpacePointer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_HEADER_TUPLE_COUNT <span class="token operator">=</span> HEADER_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;tupleCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token function">fromBytes</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">(</span>
</span><span class="code-line">                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_HEADER_LSN<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_HEADER_PREV_PAGE_ID<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_HEADER_NEXT_PAGE_ID<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_HEADER_FREE_SPACE_POINTER<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_HEADER_TUPLE_COUNT<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        VH_HEADER_PAGE_ID<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> pageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_HEADER_LSN<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> lsn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_HEADER_PREV_PAGE_ID<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> prevPageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_HEADER_NEXT_PAGE_ID<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> nextPageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_HEADER_FREE_SPACE_POINTER<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> freeSpacePointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_HEADER_TUPLE_COUNT<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> tupleCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>You may be thinking &quot;Wow, that&#x27;s a lot more code&quot;, but (beyond the fact it can be autogenerated) <a target="_blank" rel="noopener noreferrer" href="https://mail.openjdk.org/pipermail/panama-dev/2022-September/017519.html">to quote Maurizio Cimadamore, Panama project lead</a>:</p><blockquote><p>Using var handles is very useful when you want to access elements (e.g. structs inside other structs inside arrays) as it takes all the offset computation out of the way.</p></blockquote><blockquote><p>If you&#x27;re happy enough with hardwired offsets (and I agree that in this case things might be good enough), then there&#x27;s nothing wrong with using the ready-made accessor methods.</p></blockquote><p><code>MemorySegments</code> allow you to create sequences of repeated layouts/nested layouts, and pass indices into the accessors.</p><p>So rather than manually calculate byte offsets, you can do the equivalent of <code>foo[i].bar</code> as you would in C/C++:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Slot</span><span class="token punctuation">(</span><span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">MemoryLayout</span> SLOT_LAYOUT <span class="token operator">=</span> <span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">structLayout</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;offset&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;length&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Compose multiple layouts</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">MemoryLayout</span> PAGE_LAYOUT <span class="token operator">=</span> <span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">structLayout</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>HEADER_LAYOUT<span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">sequenceLayout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> SLOT_LAYOUT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;slots&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// slots[i].offset</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_OFFSET <span class="token operator">=</span> PAGE_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;slots&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sequenceElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;offset&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// slots[i].length</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> VH_LENGTH <span class="token operator">=</span> PAGE_LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;slots&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sequenceElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;length&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Slot</span> <span class="token function">fromBuffer</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_OFFSET<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> VH_LENGTH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Slot</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeToBuffer</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        VH_OFFSET<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> index<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        VH_LENGTH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> index<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h1 id="further-tips--tricks"><a href="#further-tips--tricks" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Further Tips &amp; Tricks</h1><h2 id="conversions-between-memorysegment-and-arrays-or-bytebuffers"><a href="#conversions-between-memorysegment-and-arrays-or-bytebuffers" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conversions between MemorySegment and arrays or ByteBuffers</h2><p>MemorySegment has API methods to convert to/from both arrays of primitives and <code>ByteBuffers</code>.</p><p>When wrapping a MemorySegment as a ByteBuffer, there is still a performance gain (see: &quot;ByteBuffers are dead, Long Live ByteBuffers!&quot; presentation in Resources section).</p><h2 id="working-with-char-or-similar---opaque-sized-binary-chunk"><a href="#working-with-char-or-similar---opaque-sized-binary-chunk" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Working with char* (or similar - opaque, sized binary chunk)</h2><p>If you need to work with the equivalent of <code>char*</code>, you can do it using the <code>MemorySegment.copy()</code> static method:</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://download.java.net/java/early_access/jdk19/docs/api/java.base/java/lang/foreign/MemorySegment.html#copy(java.lang.foreign.MemorySegment,long,java.lang.foreign.MemorySegment,long,long)">MemorySegment.copy() JDK 19 JavaDoc</a></li></ul><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">void</span> <span class="token function">setTupleData</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> tupleOffset<span class="token punctuation">,</span> <span class="token class-name">MemorySegment</span> tupleData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">MemorySegment</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>tupleData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> tupleOffset <span class="token operator">+</span> <span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>JAVA_INT<span class="token punctuation">.</span><span class="token function">byteSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tupleData<span class="token punctuation">.</span><span class="token function">byteSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="autogenerating-readerwriter-code-for-binary-data-types"><a href="#autogenerating-readerwriter-code-for-binary-data-types" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Autogenerating reader/writer code for binary data types</h2><p>The structure-based implementation of <code>HeapFileHeader</code> can be generated automatically, using the <code>jextract</code> tool.</p><ul><li>You can download it here: <a target="_blank" rel="noopener noreferrer" href="https://jdk.java.net/jextract/">https://jdk.java.net/jextract/</a></li></ul><p>To show how to do this, lets consider the C implementation of our <code>Header</code> structure:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> pageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> logSequenceNumber<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> prevPageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nextPageId<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> freeSpacePointer<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> tupleCount<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Assuming this is in a file called <code>structs.h</code>, we can run:</p><ul><li><code>jextract --source --out /some/dir /path/to/structs.h</code></li></ul><p>What this gives you is all the boilerplate code you&#x27;d need to work with reading/writing this struct from binary data using <code>MemorySegment</code>&#x27;s:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token comment">// Generated by jextract</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>invoke<span class="token punctuation">.</span></span><span class="token class-name">MethodHandle</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>invoke<span class="token punctuation">.</span></span><span class="token class-name">VarHandle</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteOrder</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>foreign<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>foreign<span class="token punctuation">.</span></span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapFilePageHeader</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span>  <span class="token class-name">GroupLayout</span> $struct$LAYOUT <span class="token operator">=</span> <span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">structLayout</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;pageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;logSequenceNumber&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;prevPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;nextPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;freeSpacePointer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">Constants</span>$root<span class="token punctuation">.</span>C_LONG$LAYOUT<span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;tupleCount&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;HeapFilePageHeader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MemoryLayout</span> $<span class="token function">LAYOUT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>$struct$LAYOUT<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> pageId$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;pageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> pageId$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>pageId$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> pageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>pageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> pageId$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>pageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> pageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>pageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> pageId$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>pageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> logSequenceNumber$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;logSequenceNumber&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> logSequenceNumber$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>logSequenceNumber$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> logSequenceNumber$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>logSequenceNumber$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> logSequenceNumber$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>logSequenceNumber$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> logSequenceNumber$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>logSequenceNumber$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> logSequenceNumber$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>logSequenceNumber$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> prevPageId$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;prevPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> prevPageId$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>prevPageId$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> prevPageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>prevPageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> prevPageId$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>prevPageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> prevPageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>prevPageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> prevPageId$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>prevPageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> nextPageId$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;nextPageId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> nextPageId$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>nextPageId$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> nextPageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>nextPageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> nextPageId$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>nextPageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> nextPageId$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>nextPageId$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> nextPageId$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>nextPageId$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> freeSpacePointer$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;freeSpacePointer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> freeSpacePointer$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>freeSpacePointer$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> freeSpacePointer$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>freeSpacePointer$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> freeSpacePointer$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>freeSpacePointer$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> freeSpacePointer$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>freeSpacePointer$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> freeSpacePointer$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>freeSpacePointer$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">VarHandle</span> tupleCount$VH <span class="token operator">=</span> $struct$LAYOUT<span class="token punctuation">.</span><span class="token function">varHandle</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout<span class="token punctuation">.</span>PathElement</span><span class="token punctuation">.</span><span class="token function">groupElement</span><span class="token punctuation">(</span><span class="token string">&quot;tupleCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">VarHandle</span> tupleCount$<span class="token function">VH</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>tupleCount$VH<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> tupleCount$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>tupleCount$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> tupleCount$<span class="token function">set</span><span class="token punctuation">(</span> <span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>tupleCount$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> tupleCount$<span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>tupleCount$VH<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> tupleCount$<span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MemorySegment</span> seg<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">HeapFilePageHeader</span><span class="token punctuation">.</span>tupleCount$VH<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span><span class="token function">asSlice</span><span class="token punctuation">(</span>index<span class="token operator">*</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> $<span class="token function">LAYOUT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">byteSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MemorySegment</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token class-name">SegmentAllocator</span> allocator<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> allocator<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>$<span class="token function">LAYOUT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MemorySegment</span> <span class="token function">allocateArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token class-name">SegmentAllocator</span> allocator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> allocator<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token class-name">MemoryLayout</span><span class="token punctuation">.</span><span class="token function">sequenceLayout</span><span class="token punctuation">(</span>len<span class="token punctuation">,</span> $<span class="token function">LAYOUT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MemorySegment</span> <span class="token function">ofAddress</span><span class="token punctuation">(</span><span class="token class-name">MemoryAddress</span> addr<span class="token punctuation">,</span> <span class="token class-name">MemorySession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">RuntimeHelper</span><span class="token punctuation">.</span><span class="token function">asArray</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> $<span class="token function">LAYOUT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h1 id="resources-thanks--acknowledgements"><a href="#resources-thanks--acknowledgements" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Resources, Thanks &amp; Acknowledgements</h1><p>I&#x27;d like to thank the folks on the <code>panama-dev</code> mailing list that took time to respond to my questions.</p><p>I&#x27;d also like to thank John Vornee for explaining the alignment rules to me and helping troubleshoot my code <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/73431044/13485494">on stackoverflow</a></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://mail.openjdk.org/pipermail/panama-dev/2022-August/017433.html">My panama-dev mailing list discussion: &quot;ByteBuffer vs MemorySegment for...&quot;</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=RYrk4wvar6g">YouTube: ByteBuffers are dead, long live ByteBuffers!</a></li></ul><h1 id="future-discussion"><a href="#future-discussion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Future Discussion</h1><p>This post hardly scratches the surface of the Foreign Memory API</p><p>Writing a DB involves managing memory allocation and a buffer pool.</p><p>There are some incredibly nifty tools in the Foreign Memory API, like the <code>SegmentAllocator</code> interface and it&#x27;s arena-allocation methods</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://download.java.net/java/early_access/loom/docs/api/jdk.incubator.foreign/jdk/incubator/foreign/SegmentAllocator.html"><code>SegmentAllocator</code>JavaDocs</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://download.java.net/java/early_access/loom/docs/api/jdk.incubator.foreign/jdk/incubator/foreign/SegmentAllocator.html#newNativeArena(long,long,jdk.incubator.foreign.ResourceScope)"><code>SegmentAllocator.newNativeArena()</code> JavaDocs</a></li></ul><p>I think it&#x27;d be interesting to do a follow-up post on the implementation of a buffer pool and memory-management strategies with the Foreign Memory methods, but I&#x27;ve got to figure that all out first.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Ftailwind-nextjs-starter-blog.vercel.app%2Fblog%2Fpanama-not-so-foreign-memory">Discuss on Twitter</a>  <a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog/blob/master/data/blog/panama-not-so-foreign-memory.mdx">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/java">java</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jvm">jvm</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/foreign-memory">foreign-memory</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/panama">panama</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/building-query-expression-lang-kotlin-sql-jooq">Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog"> Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:ray.gavin97@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Gavin Ray</div><div>  </div><div> 2022</div><div>  </div><a href="/">Gavin Ray Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var t=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var i=a=\u003et(a,\"__esModule\",{value:!0});var k=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},y=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of u(s))!h.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026t(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},f=a=\u003ey(i(t(a!=null?r(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var p=k((v,o)=\u003e{o.exports=_jsx_runtime});var P={};N(P,{default:()=\u003eb,frontmatter:()=\u003eg});var n=f(p()),g={title:\"Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.\",date:\"2022-09-03\",tags:[\"java\",\"jvm\",\"foreign-memory\",\"panama\"],draft:!1,summary:\"An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications\",images:[]};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",code:\"code\",em:\"em\",strong:\"strong\",pre:\"pre\",blockquote:\"blockquote\",h2:\"h2\"},a.components),{TOCInline:l}=e;return l||H(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{toc:a.toc,indentDepth:2,asDisclosure:!0}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h1,{id:\"preface\",children:[(0,n.jsx)(e.a,{href:\"#preface\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Preface\"]}),(0,n.jsx)(e.p,{children:\"If I asked you to write performance-sensitive code for working with binary data/bytes on the JVM, you'd probably use one of the following:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"byte[]\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"ByteBuffer\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"Unsafe\"})})]}),(0,n.jsxs)(e.p,{children:[\"These are fine answers -- and, to date, essentially the \",(0,n.jsx)(e.em,{children:\"only\"}),\" answers.\"]}),(0,n.jsxs)(e.p,{children:[\"While reading the \",(0,n.jsx)(e.a,{href:\"https://github.com/openjdk/panama-foreign/blob/foreign-memaccess%2Babi/doc/panama_memaccess.md#segments\",children:\"Panama Memory Access explainer\"}),\", I recognized a usecase based on hobby projects I'd done lately which (to me) wasn't immediately obvious from the document or the names of the API's:\"]}),(0,n.jsxs)(e.p,{children:[\"Panama's \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\" API provides a drop-in compatible \",(0,n.jsx)(e.code,{children:\"ByteBuffer\"}),\" replacement with better performance, no 2GB size limit, and proper API's for working with structured binary data.\"]}),(0,n.jsx)(e.p,{children:`Even if there's nothing \"Foreign\"/\"Native\" about your data, if you're working with bytes \u0026 bits, you could likely benefit from Panama.`}),(0,n.jsx)(e.p,{children:\"Let's take a look at how.\"}),(0,n.jsxs)(e.h1,{id:\"overview\",children:[(0,n.jsx)(e.a,{href:\"#overview\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Overview\"]}),(0,n.jsx)(e.p,{children:\"I have an avid interest in databases/query engines, and during the past months have been spending most of my spare time studying their internals.\"}),(0,n.jsxs)(e.p,{children:[\"If you write a DB on the JVM, you need be able to read/write binary data efficiently. Educational databases like SimpleDB use \",(0,n.jsx)(e.code,{children:\"ByteBuffer\"}),\", but we can do better nowadays.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Let's look at a real-world implementation:\"})}),(0,n.jsxs)(e.p,{children:[\"What we'll implement is the reading/writing of a database's \",(0,n.jsx)(e.code,{children:\"Heap File Page\"}),\" header using MemorySegment's. The design is taken from \",(0,n.jsx)(e.a,{href:\"https://github.com/cmu-db/bustub/blob/734cd67a7834886f4c172514f188919fbbfb9d88/src/include/storage/page/table_page.h#L27-L44\",children:\"CMU's BusTub educational DB\"}),\":\"]}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Header format (size in bytes):\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`----------------------------------------------------------------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`| PageId (4)| LSN (4)| PrevPageId (4)| NextPageId (4)| FreeSpacePointer(4) |\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`----------------------------------------------------------------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`----------------------------------------------------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`| TupleCount (4) | Tuple_1 offset (4) | Tuple_1 size (4) | ... |\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`----------------------------------------------------------------\n`})]})}),(0,n.jsxs)(e.h1,{id:\"implementation-offset-based\",children:[(0,n.jsx)(e.a,{href:\"#implementation-offset-based\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Implementation (Offset-based)\"]}),(0,n.jsxs)(e.p,{children:[\"In a proper implementation, the \",(0,n.jsx)(e.code,{children:\"getter\"}),\"/\",(0,n.jsx)(e.code,{children:\"setter\"}),\" would proxy the underlying access to the memory segment. (You don't want to allocate objects and perform extra serialization)\"]}),(0,n.jsxs)(e.p,{children:[\"Because that'd be a lot of boilerplate code, what we'll do instead is make a POJO that has \",(0,n.jsx)(e.code,{children:\"fromBytes()\"}),\" and \",(0,n.jsx)(e.code,{children:\"toBytes()\"}),\" method, which will illustrate the same idea:\"]}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" pageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" lsn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" prevPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" nextPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" freeSpacePointer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tupleCount\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Constructor omitted\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fromBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"20\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"toBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" lsn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" prevPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nextPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" freeSpacePointer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"20\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tupleCount\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"implementation-structure-based\",children:[(0,n.jsx)(e.a,{href:\"#implementation-structure-based\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Implementation (Structure-based)\"]}),(0,n.jsx)(e.p,{children:\"Using it offset-based in this way is nearly identical to the API you're used to from ByteBuffer. There's not much else to it.\"}),(0,n.jsxs)(e.p,{children:[\"But \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\" also offers us a structure-based API, where we can define the shape of our binary data and use varhandles to reference the member offsets.\"]}),(0,n.jsx)(e.p,{children:\"Implementing that looks something like this:\"}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:'Note: See \"Tips \u0026 Tricks\" to see how this can be auto-generated'})}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),\" HEADER_LAYOUT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"structLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"lsn\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"prevPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"nextPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"freeSpacePointer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"tupleCount\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_PAGE_ID \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_LSN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"lsn\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_PREV_PAGE_ID \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"prevPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_NEXT_PAGE_ID \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"nextPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_FREE_SPACE_POINTER \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"freeSpacePointer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_HEADER_TUPLE_COUNT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"tupleCount\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fromBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_HEADER_LSN\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_HEADER_PREV_PAGE_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_HEADER_NEXT_PAGE_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_HEADER_FREE_SPACE_POINTER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_HEADER_TUPLE_COUNT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"toBytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_PAGE_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_LSN\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" lsn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_PREV_PAGE_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" prevPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_NEXT_PAGE_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nextPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_FREE_SPACE_POINTER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" freeSpacePointer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_HEADER_TUPLE_COUNT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tupleCount\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[`You may be thinking \"Wow, that's a lot more code\", but (beyond the fact it can be autogenerated) `,(0,n.jsx)(e.a,{href:\"https://mail.openjdk.org/pipermail/panama-dev/2022-September/017519.html\",children:\"to quote Maurizio Cimadamore, Panama project lead\"}),\":\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"Using var handles is very useful when you want to access elements (e.g. structs inside other structs inside arrays) as it takes all the offset computation out of the way.\"})}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"If you're happy enough with hardwired offsets (and I agree that in this case things might be good enough), then there's nothing wrong with using the ready-made accessor methods.\"})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"MemorySegments\"}),\" allow you to create sequences of repeated layouts/nested layouts, and pass indices into the accessors.\"]}),(0,n.jsxs)(e.p,{children:[\"So rather than manually calculate byte offsets, you can do the equivalent of \",(0,n.jsx)(e.code,{children:\"foo[i].bar\"}),\" as you would in C/C++:\"]}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Slot\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" offset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),\" SLOT_LAYOUT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"structLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"offset\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"length\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Compose multiple layouts\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),\" PAGE_LAYOUT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"structLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"HEADER_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sequenceLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" SLOT_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"slots\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// slots[i].offset\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_OFFSET \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PAGE_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"slots\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sequenceElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"offset\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// slots[i].length\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" VH_LENGTH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PAGE_LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"slots\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sequenceElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"length\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Slot\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fromBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" offset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_OFFSET\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" length \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" VH_LENGTH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Slot\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"offset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"writeToBuffer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_OFFSET\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" offset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        VH_LENGTH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"further-tips--tricks\",children:[(0,n.jsx)(e.a,{href:\"#further-tips--tricks\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Further Tips \u0026 Tricks\"]}),(0,n.jsxs)(e.h2,{id:\"conversions-between-memorysegment-and-arrays-or-bytebuffers\",children:[(0,n.jsx)(e.a,{href:\"#conversions-between-memorysegment-and-arrays-or-bytebuffers\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conversions between MemorySegment and arrays or ByteBuffers\"]}),(0,n.jsxs)(e.p,{children:[\"MemorySegment has API methods to convert to/from both arrays of primitives and \",(0,n.jsx)(e.code,{children:\"ByteBuffers\"}),\".\"]}),(0,n.jsx)(e.p,{children:'When wrapping a MemorySegment as a ByteBuffer, there is still a performance gain (see: \"ByteBuffers are dead, Long Live ByteBuffers!\" presentation in Resources section).'}),(0,n.jsxs)(e.h2,{id:\"working-with-char-or-similar---opaque-sized-binary-chunk\",children:[(0,n.jsx)(e.a,{href:\"#working-with-char-or-similar---opaque-sized-binary-chunk\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Working with char* (or similar - opaque, sized binary chunk)\"]}),(0,n.jsxs)(e.p,{children:[\"If you need to work with the equivalent of \",(0,n.jsx)(e.code,{children:\"char*\"}),\", you can do it using the \",(0,n.jsx)(e.code,{children:\"MemorySegment.copy()\"}),\" static method:\"]}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://download.java.net/java/early_access/jdk19/docs/api/java.base/java/lang/foreign/MemorySegment.html#copy(java.lang.foreign.MemorySegment,long,java.lang.foreign.MemorySegment,long,long)\",children:\"MemorySegment.copy() JDK 19 JavaDoc\"})})}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setTupleData\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tupleOffset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" tupleData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"copy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tupleData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buffer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tupleOffset \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"JAVA_INT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"byteSize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tupleData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"byteSize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"autogenerating-readerwriter-code-for-binary-data-types\",children:[(0,n.jsx)(e.a,{href:\"#autogenerating-readerwriter-code-for-binary-data-types\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Autogenerating reader/writer code for binary data types\"]}),(0,n.jsxs)(e.p,{children:[\"The structure-based implementation of \",(0,n.jsx)(e.code,{children:\"HeapFileHeader\"}),\" can be generated automatically, using the \",(0,n.jsx)(e.code,{children:\"jextract\"}),\" tool.\"]}),(0,n.jsx)(e.ul,{children:(0,n.jsxs)(e.li,{children:[\"You can download it here: \",(0,n.jsx)(e.a,{href:\"https://jdk.java.net/jextract/\",children:\"https://jdk.java.net/jextract/\"})]})}),(0,n.jsxs)(e.p,{children:[\"To show how to do this, lets consider the C implementation of our \",(0,n.jsx)(e.code,{children:\"Header\"}),\" structure:\"]}),(0,n.jsx)(e.pre,{className:\"language-c\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-c\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" pageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" logSequenceNumber\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" prevPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" nextPageId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" freeSpacePointer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tupleCount\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Assuming this is in a file called \",(0,n.jsx)(e.code,{children:\"structs.h\"}),\", we can run:\"]}),(0,n.jsx)(e.ul,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"jextract --source --out /some/dir /path/to/structs.h\"})})}),(0,n.jsxs)(e.p,{children:[\"What this gives you is all the boilerplate code you'd need to work with reading/writing this struct from binary data using \",(0,n.jsx)(e.code,{children:\"MemorySegment\"}),\"'s:\"]}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Generated by jextract\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lang\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"invoke\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MethodHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lang\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"invoke\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ByteOrder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lang\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"foreign\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lang\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"foreign\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ValueLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"*\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\"  \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"GroupLayout\"}),\" $struct$LAYOUT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"structLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"logSequenceNumber\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"prevPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"nextPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"freeSpacePointer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Constants\"}),\"$root\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"C_LONG$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"tupleCount\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"HeapFilePageHeader\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),\" $\",(0,n.jsx)(e.span,{className:\"token function\",children:\"LAYOUT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"$struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" pageId$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" pageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" pageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" pageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" pageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" pageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" logSequenceNumber$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"logSequenceNumber\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" logSequenceNumber$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logSequenceNumber$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" logSequenceNumber$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logSequenceNumber$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" logSequenceNumber$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logSequenceNumber$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" logSequenceNumber$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logSequenceNumber$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" logSequenceNumber$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logSequenceNumber$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" prevPageId$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"prevPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" prevPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"prevPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" prevPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"prevPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" prevPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"prevPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" prevPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"prevPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" prevPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"prevPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" nextPageId$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"nextPageId\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" nextPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nextPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" nextPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nextPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" nextPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nextPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" nextPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nextPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" nextPageId$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nextPageId$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" freeSpacePointer$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"freeSpacePointer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" freeSpacePointer$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"freeSpacePointer$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" freeSpacePointer$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"freeSpacePointer$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" freeSpacePointer$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"freeSpacePointer$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" freeSpacePointer$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"freeSpacePointer$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" freeSpacePointer$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"freeSpacePointer$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" tupleCount$VH \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" $struct$LAYOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"varHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MemoryLayout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PathElement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"tupleCount\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"VarHandle\"}),\" tupleCount$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"VH\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tupleCount$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tupleCount$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tupleCount$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" tupleCount$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tupleCount$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" tupleCount$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tupleCount$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" tupleCount$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HeapFilePageHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tupleCount$VH\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asSlice\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"long\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sizeof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" $\",(0,n.jsx)(e.span,{className:\"token function\",children:\"LAYOUT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"byteSize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SegmentAllocator\"}),\" allocator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" allocator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"$\",(0,n.jsx)(e.span,{className:\"token function\",children:\"LAYOUT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"allocateArray\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"int\"}),\" len\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SegmentAllocator\"}),\" allocator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" allocator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"allocate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sequenceLayout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"len\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" $\",(0,n.jsx)(e.span,{className:\"token function\",children:\"LAYOUT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySegment\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"ofAddress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemoryAddress\"}),\" addr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MemorySession\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"RuntimeHelper\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asArray\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"addr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" $\",(0,n.jsx)(e.span,{className:\"token function\",children:\"LAYOUT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"resources-thanks--acknowledgements\",children:[(0,n.jsx)(e.a,{href:\"#resources-thanks--acknowledgements\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Resources, Thanks \u0026 Acknowledgements\"]}),(0,n.jsxs)(e.p,{children:[\"I'd like to thank the folks on the \",(0,n.jsx)(e.code,{children:\"panama-dev\"}),\" mailing list that took time to respond to my questions.\"]}),(0,n.jsxs)(e.p,{children:[\"I'd also like to thank John Vornee for explaining the alignment rules to me and helping troubleshoot my code \",(0,n.jsx)(e.a,{href:\"https://stackoverflow.com/a/73431044/13485494\",children:\"on stackoverflow\"})]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://mail.openjdk.org/pipermail/panama-dev/2022-August/017433.html\",children:'My panama-dev mailing list discussion: \"ByteBuffer vs MemorySegment for...\"'})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=RYrk4wvar6g\",children:\"YouTube: ByteBuffers are dead, long live ByteBuffers!\"})})]}),(0,n.jsxs)(e.h1,{id:\"future-discussion\",children:[(0,n.jsx)(e.a,{href:\"#future-discussion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Future Discussion\"]}),(0,n.jsx)(e.p,{children:\"This post hardly scratches the surface of the Foreign Memory API\"}),(0,n.jsx)(e.p,{children:\"Writing a DB involves managing memory allocation and a buffer pool.\"}),(0,n.jsxs)(e.p,{children:[\"There are some incredibly nifty tools in the Foreign Memory API, like the \",(0,n.jsx)(e.code,{children:\"SegmentAllocator\"}),\" interface and it's arena-allocation methods\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.a,{href:\"https://download.java.net/java/early_access/loom/docs/api/jdk.incubator.foreign/jdk/incubator/foreign/SegmentAllocator.html\",children:[(0,n.jsx)(e.code,{children:\"SegmentAllocator\"}),\"JavaDocs\"]})}),(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.a,{href:\"https://download.java.net/java/early_access/loom/docs/api/jdk.incubator.foreign/jdk/incubator/foreign/SegmentAllocator.html#newNativeArena(long,long,jdk.incubator.foreign.ResourceScope)\",children:[(0,n.jsx)(e.code,{children:\"SegmentAllocator.newNativeArena()\"}),\" JavaDocs\"]})})]}),(0,n.jsx)(e.p,{children:\"I think it'd be interesting to do a follow-up post on the implementation of a buffer pool and memory-management strategies with the Foreign Memory methods, but I've got to figure that all out first.\"})]})}}var b=w;function H(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return P;})();\n;return Component;","toc":[{"value":"Preface","url":"#preface","depth":1},{"value":"Overview","url":"#overview","depth":1},{"value":"Implementation (Offset-based)","url":"#implementation-offset-based","depth":1},{"value":"Implementation (Structure-based)","url":"#implementation-structure-based","depth":1},{"value":"Further Tips \u0026 Tricks","url":"#further-tips--tricks","depth":1},{"value":"Conversions between MemorySegment and arrays or ByteBuffers","url":"#conversions-between-memorysegment-and-arrays-or-bytebuffers","depth":2},{"value":"Working with char* (or similar - opaque, sized binary chunk)","url":"#working-with-char-or-similar---opaque-sized-binary-chunk","depth":2},{"value":"Autogenerating reader/writer code for binary data types","url":"#autogenerating-readerwriter-code-for-binary-data-types","depth":2},{"value":"Resources, Thanks \u0026 Acknowledgements","url":"#resources-thanks--acknowledgements","depth":1},{"value":"Future Discussion","url":"#future-discussion","depth":1}],"frontMatter":{"readingTime":{"text":"17 min read","minutes":16.815,"time":1008900,"words":3363},"slug":"panama-not-so-foreign-memory","fileName":"panama-not-so-foreign-memory.mdx","title":"Panama: Not-so-Foreign Memory. Using MemorySegment as a high-performance ByteBuffer replacement.","date":"2022-09-03T00:00:00.000Z","tags":["java","jvm","foreign-memory","panama"],"draft":false,"summary":"An overview of how the Panama Foreign Memory API can be useful outside of foreign/native applications","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.23,"time":13800,"words":46},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"Building a Query Expression Language in Kotlin, plus dynamic SQL Generation using jOOQ","date":"2022-03-19T00:00:00.000Z","tags":["kotlin","sql","jvm","query-engines","jooq"],"draft":false,"summary":"A tutorial on building a Query Expression Language/AST in Kotlin and implementing SQL generation","images":[],"slug":"building-query-expression-lang-kotlin-sql-jooq"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["panama-not-so-foreign-memory"]},"buildId":"_OoQ-D-sxB0bbLNidnYJW","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>