<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules</title><meta name="robots" content="follow, index"/><meta name="description" content="A tutorial on how to use Java&#x27;s new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.
"/><meta property="og:url" content="https://gavinray97.github.io/blog/what-good-are-record-patterns"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Gavin Ray Blog"/><meta property="og:description" content="A tutorial on how to use Java&#x27;s new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.
"/><meta property="og:title" content="What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules"/><meta property="og:image" content="https://gavinray97.github.io/static/images/ast-visualization.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/GavinRayDev"/><meta name="twitter:title" content="What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules"/><meta name="twitter:description" content="A tutorial on how to use Java&#x27;s new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.
"/><meta name="twitter:image" content="https://gavinray97.github.io/static/images/ast-visualization.png"/><link rel="canonical" href="https://gavinray97.github.io/blog/what-good-are-record-patterns"/><meta property="article:published_time" content="2023-02-04T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gavinray97.github.io/blog/what-good-are-record-patterns"
  },
  "headline": "What good are Record Patterns in Java? An example based on Spark's Catalyst Optimizer and it's Tree Rewriting Rules",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/ast-visualization.png"
    }
  ],
  "datePublished": "2023-02-04T00:00:00.000Z",
  "dateModified": "2023-02-04T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Gavin Ray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Gavin Ray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/logo.png"
    }
  },
  "description": "A tutorial on how to use Java's new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.\n"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/11bf37f52e8561b6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11bf37f52e8561b6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bdcdf64985b3467.js" defer=""></script><script src="/_next/static/chunks/main-bb8a1082161dc7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-da15d2a3f366f449.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-dd685ae53e609b20.js" defer=""></script><script src="/_next/static/chunks/620-407ce78f2f46843c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-52c7b4963ecd0646.js" defer=""></script><script src="/_next/static/yi_hyVvrRttOodt0N59ik/_buildManifest.js" defer=""></script><script src="/_next/static/yi_hyVvrRttOodt0N59ik/_ssgManifest.js" defer=""></script><script src="/_next/static/yi_hyVvrRttOodt0N59ik/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="" href="/"><div class="flex items-center justify-between"><div class="mr-3"></div><div class="hidden h-6 text-2xl font-semibold sm:block"></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-02-04T00:00:00.000Z">Saturday, February 4, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/me.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Gavin Ray</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@GavinRayDev</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li><a href="#preface">Preface</a></li><li><a href="#what-are-record-patterns">What are Record Patterns?</a></li><li><a href="#a-simple-example">A Simple Example</a><ul><li style="margin-left:24px"><a href="#a-person-pojo-what-youre-used-to">A Person POJO, what you&#x27;re used to</a></li><li style="margin-left:24px"><a href="#lets-rewrite-it-with-records-and-record-patterns">Let&#x27;s rewrite it with Records and Record Patterns</a></li><li style="margin-left:24px"><a href="#what-else-can-we-do">What else can we do?</a></li></ul></li><li><a href="#the-usecase-tree-rewritingast-transformations">The Usecase: Tree Rewriting/AST Transformations</a><ul><li style="margin-left:24px"><a href="#what-is-tree-rewriting">What is Tree Rewriting?</a></li><li style="margin-left:24px"><a href="#how-can-record-patterns-help">How can Record Patterns help?</a></li><li style="margin-left:24px"><a href="#implementing-the-rewriter">Implementing the Rewriter</a></li></ul></li><li><a href="#get-the-source-code">Get the Source Code</a></li><li><a href="#attribution">Attribution</a></li></ul></div></details><hr/><h1 id="preface"><a href="#preface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Preface</h1><p>Recently, Gunnar Morling made a stellar <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/gunnarmorling/status/1619412551200301057">tweet</a> about how he was interested in hearing of usecases for Java&#x27;s new <a target="_blank" rel="noopener noreferrer" href="https://openjdk.org/jeps/405">Record Patterns</a> feature. My dayjob involves a lot of work with AST/IR and a sort of <code>Query Expression Language</code>, so I immediately grew excited at being able to share this sort of usecase with the community.</p><blockquote class="twitter-tweet"><span lang="en" dir="ltr"><p>Playing around a bit with <a href="https://twitter.com/hashtag/Java?src=hash&amp;ref_src=twsrc%5Etfw">#Java</a> 19/20 record patterns. I generally like the ergonomics of it, matching whole object trees is kinda fun. <code>var</code> helps to gloss over irrelevant parts of the tree, might be even more concise though? Also curious what use cases folks see for this. <a href="https://t.co/v4NKUu6Cz7">pic.twitter.com/v4NKUu6Cz7</a></p></span><p>— Gunnar Morling 🌍 (@gunnarmorling) <a href="https://twitter.com/gunnarmorling/status/1619412551200301057?ref_src=twsrc%5Etfw">January 28, 2023</a></p></blockquote><script async="" src="https://platform.twitter.com/widgets.js" charSet="utf-8"></script><h1 id="what-are-record-patterns"><a href="#what-are-record-patterns" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What are Record Patterns?</h1><p>Record Patterns are a new feature in Java 19/20 that allow you to write concise, powerful pattern matching code.</p><p>&quot;Pattern Matching&quot; is a term adopted from the &quot;Functional Programming&quot; world, and is a way of expressing a conditional statement in a declarative way. Rather than writing a series of <code>if</code>/<code>else if</code>/<code>else</code> statements, you can write a series of patterns that match against the input, and execute a block of code when a pattern matches.</p><p>This simple principle is tremendously powerful, due to the flexibility in how patterns can be used. Though this is heavily dependent on whether the patterns allow you to <code>nest</code> them, and to <code>bind</code> variables to the matched values (as we&#x27;ll see below in a moment). Let&#x27;s take a look at some examples of &quot;traditional&quot; POJO code, and how we might rewrite it using Records and Record Patterns using more &quot;modern&quot; Java with declarative style.</p><h1 id="a-simple-example"><a href="#a-simple-example" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A Simple Example</h1><p>Let&#x27;s start with a simple example of a <code>Person</code> class, which has a <code>name</code> and <code>age</code>:</p><h2 id="a-person-pojo-what-youre-used-to"><a href="#a-person-pojo-what-youre-used-to" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A Person POJO, what you&#x27;re used to</h2><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Now, let&#x27;s write a simple function that takes a <code>Person</code> and returns a <code>String</code> based on their age:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPersonStatus</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string">&quot;Minor&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string">&quot;Adult&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string">&quot;Senior&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="lets-rewrite-it-with-records-and-record-patterns"><a href="#lets-rewrite-it-with-records-and-record-patterns" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s rewrite it with Records and Record Patterns</h2><p>This is a simple example, but it&#x27;s already starting to get a bit messy. We have to write a lot of boilerplate code, and we have to repeat the <code>person.getAge()</code> call multiple times. Let&#x27;s see how we can rewrite this using Record Patterns:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPersonStatus</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token keyword">var</span> _<span class="token punctuation">,</span> <span class="token keyword">var</span> age<span class="token punctuation">)</span> when age <span class="token operator">&lt;</span> <span class="token number">18</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Minor&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token keyword">var</span> _<span class="token punctuation">,</span> <span class="token keyword">var</span> age<span class="token punctuation">)</span> when age <span class="token operator">&lt;</span> <span class="token number">65</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Adult&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Senior&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="what-else-can-we-do"><a href="#what-else-can-we-do" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What else can we do?</h2><p>That&#x27;s a lot better!</p><p>This is just the tip of the iceberg though. We can do lots of things in patterns like:</p><ol><li>Use interface/superclass types in patterns, which will match based on specificity</li><li>Nest patterns in our <code>case</code> statements</li></ol><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token keyword">permits</span> <span class="token class-name">Circle</span><span class="token punctuation">,</span> <span class="token class-name">Rectangle</span><span class="token punctuation">,</span> <span class="token class-name">Square</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token keyword">double</span> width<span class="token punctuation">,</span> <span class="token keyword">double</span> height<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Square</span><span class="token punctuation">(</span><span class="token keyword">double</span> side<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token class-name">Shape</span> shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token keyword">var</span> radius<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Math</span><span class="token punctuation">.</span>PI <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token keyword">var</span> width<span class="token punctuation">,</span> <span class="token keyword">var</span> height<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">case</span> <span class="token class-name">Square</span><span class="token punctuation">(</span><span class="token keyword">var</span> side<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> side <span class="token operator">*</span> side<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">PhoneNumber</span><span class="token punctuation">(</span><span class="token class-name">String</span> countryCode<span class="token punctuation">,</span> <span class="token class-name">String</span> areaCode<span class="token punctuation">,</span> <span class="token class-name">String</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">PhoneNumber</span> phoneNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// I&#x27;m using &quot;_&quot; for readability here, this won&#x27;t compile</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPeopleWithAreaCode</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> people<span class="token punctuation">,</span> <span class="token class-name">String</span> areaCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> people<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>person <span class="token operator">-&gt;</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token comment">// Silly example for demo, doesn&#x27;t make a lot of sense</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token class-name">PhoneNumber</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token keyword">var</span> areaCode<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h1 id="the-usecase-tree-rewritingast-transformations"><a href="#the-usecase-tree-rewritingast-transformations" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Usecase: Tree Rewriting/AST Transformations</h1><p>Now that we&#x27;ve seen some examples of how Record Patterns can be used, let&#x27;s take a look at a real-world usecase for them: Tree Rewriting/AST Transformations.</p><h2 id="what-is-tree-rewriting"><a href="#what-is-tree-rewriting" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is Tree Rewriting?</h2><p>Tree rewriting is a technique used in compilers to transform the AST/IR of a program. This is done by writing a series of rewrite rules that match against the AST, and then rewrite the AST based on the matched rules.</p><p>For example, let&#x27;s say we have a simple <code>Expression</code> AST:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">Expr</span> <span class="token keyword">permits</span> <span class="token class-name">Add</span><span class="token punctuation">,</span> <span class="token class-name">Sub</span><span class="token punctuation">,</span> <span class="token class-name">Mul</span><span class="token punctuation">,</span> <span class="token class-name">Div</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">,</span> <span class="token class-name">Var</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>We can then write a simple <code>eval</code> function that evaluates the expression, given a map of variable names to values (the <code>enviroment</code>):</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">Evaluator</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> value<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>A rewrite-rule would be a pattern that matches against the <code>Expr</code> AST, and then rewrites it to a new <code>Expr</code> AST. For example, we could write a rule that rewrites <code>x + 0</code> to just <code>x</code>.</p><p>In the Apache Spark project, the Scala language makes it incredibly easy to write such rules using <code>case classes</code> and <code>case</code> statements. The <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala">Catalyst optimizer code</a> is full of such rewrite rules, and it&#x27;s a joy to read.</p><h2 id="how-can-record-patterns-help"><a href="#how-can-record-patterns-help" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>How can Record Patterns help?</h2><p>Let&#x27;s take the above example of a rule that rewrites <code>x + 0</code> to just <code>x</code>.</p><p>We can write this rule as follows, using Record Patterns (going a bit further than just <code>x + 0</code>, to cover some more cases):</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">SimplifyZeroOpPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Expr</span> <span class="token function">simplify</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token comment">// x + 0 = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// 0 + x = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// x - 0 = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// x * 1 = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// 1 * x = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// x / 1 = x</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Var</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// 0 / x = 0</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">var</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token keyword">var</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> when value <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// Otherwise, just return the expression</span>
</span><span class="code-line">            <span class="token keyword">default</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Can you imagine if we had to write this using traditional <code>instanceof</code> and <code>if</code> statements? It would be a nightmare!</p><p>It would be something like this (Not checked for accuracy):</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">SimplifyZeroOpPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Expr</span> <span class="token function">simplify</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>expr <span class="token keyword">instanceof</span> <span class="token class-name">Add</span> add<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>add<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> leftVar <span class="token operator">&amp;&amp;</span> add<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> rightConst <span class="token operator">&amp;&amp;</span> rightConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> leftVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> leftConst <span class="token operator">&amp;&amp;</span> add<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> rightVar <span class="token operator">&amp;&amp;</span> leftConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> rightVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>expr <span class="token keyword">instanceof</span> <span class="token class-name">Sub</span> sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> leftVar <span class="token operator">&amp;&amp;</span> sub<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> rightConst <span class="token operator">&amp;&amp;</span> rightConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> leftVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>expr <span class="token keyword">instanceof</span> <span class="token class-name">Mul</span> mul<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>mul<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> leftVar <span class="token operator">&amp;&amp;</span> mul<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> rightConst <span class="token operator">&amp;&amp;</span> rightConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> leftVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mul<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> leftConst <span class="token operator">&amp;&amp;</span> mul<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> rightVar <span class="token operator">&amp;&amp;</span> leftConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> rightVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>expr <span class="token keyword">instanceof</span> <span class="token class-name">Div</span> div<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> leftVar <span class="token operator">&amp;&amp;</span> div<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> rightConst <span class="token operator">&amp;&amp;</span> rightConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> leftVar<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Const</span> leftConst <span class="token operator">&amp;&amp;</span> div<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Var</span> rightVar <span class="token operator">&amp;&amp;</span> leftConst<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">return</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="implementing-the-rewriter"><a href="#implementing-the-rewriter" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Implementing the Rewriter</h2><p>To wrap up, I&#x27;m going to share the implementation of a full program that provides a multi-pass expression simplifier, using Record Patterns.</p><p>This is going to be a little bit of a <a target="_blank" rel="noopener noreferrer" href="https://knowyourmeme.com/memes/how-to-draw-an-owl">Draw the rest of the owl</a> situation, because I feel like the above has already covered the majority of what background the reader needs for understanding the code.</p><p>What we&#x27;re going to do is write a program that takes a mathematical expression, and simplifies it using a series of rewrite rules.</p><p>Our two rewrite rules will be:</p><ol><li>Constant Folding -- convert any expression like <code>Add(Const(1), Const(2))</code> to <code>Const(3)</code>.</li><li>Replace all <code>Const(x)</code> with <code>Const(42)</code></li></ol><p>If we run the below on Java 21 with <code>--enable-preview</code>:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token class-name">ExprRewriter</span> rewriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExprRewriter</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token keyword">new</span> <span class="token class-name">ConstantFoldingPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token keyword">new</span> <span class="token class-name">ConstantRewritingPass</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Create an expression tree for 1 + 2 * 3</span>
</span><span class="code-line"><span class="token class-name">Expr</span> expr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Print the expression tree</span>
</span><span class="code-line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Original: &quot;</span> <span class="token operator">+</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Evaluate the expression tree</span>
</span><span class="code-line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Evaluator</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>expr<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Now rewrite the expression tree</span>
</span><span class="code-line"><span class="token class-name">Expr</span> rewritten <span class="token operator">=</span> rewriter<span class="token punctuation">.</span><span class="token function">rewrite</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Print the rewritten expression tree</span>
</span><span class="code-line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Rewritten: &quot;</span> <span class="token operator">+</span> rewritten<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Evaluate the rewritten expression tree</span>
</span><span class="code-line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Evaluator</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>rewritten<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>We get the following output:</p><div class="relative"><pre><code class="code-highlight language-ruby"><span class="code-line"><span class="token punctuation">[</span>user<span class="token variable">@MSI</span> java<span class="token operator">-</span>record<span class="token operator">-</span>deconstruction<span class="token operator">-</span>patterns<span class="token punctuation">]</span>$ <span class="token punctuation">.</span><span class="token operator">/</span>gradlew run
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">&gt;</span> <span class="token constant">Task</span> <span class="token symbol">:app</span><span class="token symbol">:run</span>
</span><span class="code-line"><span class="token constant">Original</span><span class="token punctuation">:</span> <span class="token constant">Add</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Mul</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Result</span><span class="token punctuation">:</span> <span class="token number">7</span>
</span><span class="code-line"><span class="token constant">Folding</span> <span class="token constant">Add</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Mul</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Folding</span> <span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Folding</span> <span class="token constant">Mul</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Rewriting</span> <span class="token constant">Add</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Rewriting</span> <span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Rewriting</span> <span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Rewritten</span><span class="token punctuation">:</span> <span class="token constant">Add</span><span class="token punctuation">[</span>left<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token constant">Const</span><span class="token punctuation">[</span>value<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token constant">Result</span><span class="token punctuation">:</span> <span class="token number">84</span>
</span></code></pre></div><p>Below is the full source code for the program:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">package</span> <span class="token namespace">deconstruction<span class="token punctuation">.</span>patterns</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">sealed</span> <span class="token keyword">interface</span> <span class="token class-name">Expr</span> <span class="token keyword">permits</span> <span class="token class-name">Add</span><span class="token punctuation">,</span> <span class="token class-name">Sub</span><span class="token punctuation">,</span> <span class="token class-name">Mul</span><span class="token punctuation">,</span> <span class="token class-name">Div</span><span class="token punctuation">,</span> <span class="token class-name">Const</span><span class="token punctuation">,</span> <span class="token class-name">Var</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">record</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Expr</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">Evaluator</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> value<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// A pass which folds simple constant expressions like 1 + 2 into 3.</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">SimpleConstantFolderPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Expr</span> <span class="token function">fold</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Folding &quot;</span> <span class="token operator">+</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token function">fold</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fold</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token function">fold</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fold</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token function">fold</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fold</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token function">fold</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fold</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// An interface for an expression tree rewriting pass.</span>
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">ExprRewritingPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">Expr</span> <span class="token function">rewrite</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// An interface for an expression rewriter</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ExprRewriter</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExprRewritingPass</span><span class="token punctuation">&gt;</span></span> passes<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">ExprRewriter</span><span class="token punctuation">(</span><span class="token class-name">ExprRewritingPass</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> passes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>passes <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>passes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Register a pass with the rewriter.</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">ExprRewriter</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ExprRewritingPass</span> pass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        passes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Rewrite an expression tree.</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">rewrite</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ExprRewritingPass</span> pass <span class="token operator">:</span> passes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            expr <span class="token operator">=</span> pass<span class="token punctuation">.</span><span class="token function">rewrite</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">return</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// A pass which rewrites all variables to constants.</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ConstantRewritingPass</span> <span class="token keyword">implements</span> <span class="token class-name">ExprRewritingPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">int</span> constantValue<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">ConstantRewritingPass</span><span class="token punctuation">(</span><span class="token keyword">int</span> constantValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>constantValue <span class="token operator">=</span> constantValue<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">rewrite</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Rewriting &quot;</span> <span class="token operator">+</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>constantValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ConstantFoldingPass</span> <span class="token keyword">implements</span> <span class="token class-name">ExprRewritingPass</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">rewrite</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Folding &quot;</span> <span class="token operator">+</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Const</span> left<span class="token punctuation">,</span> <span class="token class-name">Const</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> right<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> left<span class="token punctuation">,</span> <span class="token class-name">Expr</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Div</span><span class="token punctuation">(</span><span class="token function">rewrite</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rewrite</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">case</span> <span class="token class-name">Var</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expr<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">ExprRewriter</span> rewriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExprRewriter</span><span class="token punctuation">(</span>
</span><span class="code-line">                <span class="token keyword">new</span> <span class="token class-name">ConstantFoldingPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token keyword">new</span> <span class="token class-name">ConstantRewritingPass</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Create an expression tree for 1 + 2 * 3</span>
</span><span class="code-line">        <span class="token class-name">Expr</span> expr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Mul</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Const</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Print the expression tree</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Original: &quot;</span> <span class="token operator">+</span> expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Evaluate the expression tree</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Evaluator</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>expr<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Now rewrite the expression tree</span>
</span><span class="code-line">        <span class="token class-name">Expr</span> rewritten <span class="token operator">=</span> rewriter<span class="token punctuation">.</span><span class="token function">rewrite</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Print the rewritten expression tree</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Rewritten: &quot;</span> <span class="token operator">+</span> rewritten<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Evaluate the rewritten expression tree</span>
</span><span class="code-line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Evaluator</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>rewritten<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h1 id="get-the-source-code"><a href="#get-the-source-code" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Get the Source Code</h1><p>The source code to this blog post is available on GitHub:</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/java-record-patterns">https://github.com/GavinRay97/java-record-patterns</a></li></ul><h1 id="attribution"><a href="#attribution" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Attribution</h1><p>The OpenGraph image for this blog post was taken from a Google search for <code>tree ast code</code>, and is from a blog post by <a target="_blank" rel="noopener noreferrer" href="https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8">Lachezar Nickolov</a></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8">https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8</a></li></ul></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fgavinray97.github.io%2Fblog%2Fwhat-good-are-record-patterns">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/GavinRay97.github.io/blob/master/data/blog/what-good-are-record-patterns.md">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/java">java</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jdk">jdk</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/jvm">jvm</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/postgres-wire-protocol-jdk-21">Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/overcoming-dialect-sql-generation-limits">AI SQL Generation: Overcoming dialect-specific syntax errors</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:ray.gavin97@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Gavin Ray</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Gavin Ray Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=e=\u003el(e,\"__esModule\",{value:!0});var k=(e,s)=\u003e()=\u003e(s||e((s={exports:{}}).exports,s),s.exports),N=(e,s)=\u003e{o(e);for(var c in s)l(e,c,{get:s[c],enumerable:!0})},w=(e,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of m(s))!u.call(e,a)\u0026\u0026a!==\"default\"\u0026\u0026l(e,a,{get:()=\u003es[a],enumerable:!(c=d(s,a))||c.enumerable});return e},f=e=\u003ew(o(l(e!=null?p(h(e)):{},\"default\",e\u0026\u0026e.__esModule\u0026\u0026\"default\"in e?{get:()=\u003ee.default,enumerable:!0}:{value:e,enumerable:!0})),e);var r=k((C,i)=\u003e{i.exports=_jsx_runtime});var b={};N(b,{default:()=\u003ev,frontmatter:()=\u003eg});var n=f(r()),g={title:\"What good are Record Patterns in Java? An example based on Spark's Catalyst Optimizer and it's Tree Rewriting Rules\",date:\"2023-02-04\",tags:[\"java\",\"jdk\",\"jvm\"],draft:!1,summary:`A tutorial on how to use Java's new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.\n`,images:[\"/static/images/ast-visualization.png\"]};function y(e={}){let{wrapper:s}=e.components||{};return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(c,{})})):c();function c(){let a=Object.assign({hr:\"hr\",h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",h2:\"h2\",pre:\"pre\",ol:\"ol\",li:\"li\",ul:\"ul\"},e.components),{TOCInline:t}=a;return t||x(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{toc:e.toc,indentDepth:2,asDisclosure:!0}),(0,n.jsx)(a.hr,{}),(0,n.jsxs)(a.h1,{id:\"preface\",children:[(0,n.jsx)(a.a,{href:\"#preface\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Preface\"]}),(0,n.jsxs)(a.p,{children:[\"Recently, Gunnar Morling made a stellar \",(0,n.jsx)(a.a,{href:\"https://twitter.com/gunnarmorling/status/1619412551200301057\",children:\"tweet\"}),\" about how he was interested in hearing of usecases for Java's new \",(0,n.jsx)(a.a,{href:\"https://openjdk.org/jeps/405\",children:\"Record Patterns\"}),\" feature. My dayjob involves a lot of work with AST/IR and a sort of \",(0,n.jsx)(a.code,{children:\"Query Expression Language\"}),\", so I immediately grew excited at being able to share this sort of usecase with the community.\"]}),(0,n.jsxs)(\"blockquote\",{className:\"twitter-tweet\",children:[(0,n.jsx)(\"span\",{lang:\"en\",dir:\"ltr\",children:(0,n.jsxs)(a.p,{children:[\"Playing around a bit with \",(0,n.jsx)(\"a\",{href:\"https://twitter.com/hashtag/Java?src=hash\u0026ref_src=twsrc%5Etfw\",children:\"#Java\"}),\" 19/20 record patterns. I generally like the ergonomics of it, matching whole object trees is kinda fun. \",(0,n.jsx)(a.code,{children:\"var\"}),\" helps to gloss over irrelevant parts of the tree, might be even more concise though? Also curious what use cases folks see for this. \",(0,n.jsx)(\"a\",{href:\"https://t.co/v4NKUu6Cz7\",children:\"pic.twitter.com/v4NKUu6Cz7\"})]})}),(0,n.jsxs)(a.p,{children:[\"\\u2014 Gunnar Morling \\u{1F30D} (@gunnarmorling) \",(0,n.jsx)(\"a\",{href:\"https://twitter.com/gunnarmorling/status/1619412551200301057?ref_src=twsrc%5Etfw\",children:\"January 28, 2023\"})]})]}),(0,n.jsx)(\"script\",{async:!0,src:\"https://platform.twitter.com/widgets.js\",charSet:\"utf-8\"}),(0,n.jsxs)(a.h1,{id:\"what-are-record-patterns\",children:[(0,n.jsx)(a.a,{href:\"#what-are-record-patterns\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"What are Record Patterns?\"]}),(0,n.jsx)(a.p,{children:\"Record Patterns are a new feature in Java 19/20 that allow you to write concise, powerful pattern matching code.\"}),(0,n.jsxs)(a.p,{children:['\"Pattern Matching\" is a term adopted from the \"Functional Programming\" world, and is a way of expressing a conditional statement in a declarative way. Rather than writing a series of ',(0,n.jsx)(a.code,{children:\"if\"}),\"/\",(0,n.jsx)(a.code,{children:\"else if\"}),\"/\",(0,n.jsx)(a.code,{children:\"else\"}),\" statements, you can write a series of patterns that match against the input, and execute a block of code when a pattern matches.\"]}),(0,n.jsxs)(a.p,{children:[\"This simple principle is tremendously powerful, due to the flexibility in how patterns can be used. Though this is heavily dependent on whether the patterns allow you to \",(0,n.jsx)(a.code,{children:\"nest\"}),\" them, and to \",(0,n.jsx)(a.code,{children:\"bind\"}),` variables to the matched values (as we'll see below in a moment). Let's take a look at some examples of \"traditional\" POJO code, and how we might rewrite it using Records and Record Patterns using more \"modern\" Java with declarative style.`]}),(0,n.jsxs)(a.h1,{id:\"a-simple-example\",children:[(0,n.jsx)(a.a,{href:\"#a-simple-example\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"A Simple Example\"]}),(0,n.jsxs)(a.p,{children:[\"Let's start with a simple example of a \",(0,n.jsx)(a.code,{children:\"Person\"}),\" class, which has a \",(0,n.jsx)(a.code,{children:\"name\"}),\" and \",(0,n.jsx)(a.code,{children:\"age\"}),\":\"]}),(0,n.jsxs)(a.h2,{id:\"a-person-pojo-what-youre-used-to\",children:[(0,n.jsx)(a.a,{href:\"#a-person-pojo-what-youre-used-to\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"A Person POJO, what you're used to\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"name \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"age \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getName\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getAge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[\"Now, let's write a simple function that takes a \",(0,n.jsx)(a.code,{children:\"Person\"}),\" and returns a \",(0,n.jsx)(a.code,{children:\"String\"}),\" based on their age:\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getPersonStatus\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),\" person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"18\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Minor\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"65\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Adult\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Senior\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h2,{id:\"lets-rewrite-it-with-records-and-record-patterns\",children:[(0,n.jsx)(a.a,{href:\"#lets-rewrite-it-with-records-and-record-patterns\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Let's rewrite it with Records and Record Patterns\"]}),(0,n.jsxs)(a.p,{children:[\"This is a simple example, but it's already starting to get a bit messy. We have to write a lot of boilerplate code, and we have to repeat the \",(0,n.jsx)(a.code,{children:\"person.getAge()\"}),\" call multiple times. Let's see how we can rewrite this using Record Patterns:\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getPersonStatus\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),\" person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" _\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when age \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"18\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Minor\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" _\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when age \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"65\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Adult\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Senior\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h2,{id:\"what-else-can-we-do\",children:[(0,n.jsx)(a.a,{href:\"#what-else-can-we-do\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"What else can we do?\"]}),(0,n.jsx)(a.p,{children:\"That's a lot better!\"}),(0,n.jsx)(a.p,{children:\"This is just the tip of the iceberg though. We can do lots of things in patterns like:\"}),(0,n.jsxs)(a.ol,{children:[(0,n.jsx)(a.li,{children:\"Use interface/superclass types in patterns, which will match based on specificity\"}),(0,n.jsxs)(a.li,{children:[\"Nest patterns in our \",(0,n.jsx)(a.code,{children:\"case\"}),\" statements\"]})]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Shape\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"permits\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Circle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Rectangle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Square\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Circle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"double\"}),\" radius\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Shape\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Rectangle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"double\"}),\" width\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"double\"}),\" height\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Shape\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Square\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"double\"}),\" side\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Shape\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"double\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getArea\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Shape\"}),\" shape\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"shape\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Circle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" radius\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Math\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"PI \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" radius \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" radius\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Rectangle\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" width\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" height\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" width \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" height\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Square\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" side\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" side \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" side\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PhoneNumber\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" countryCode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" areaCode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" number\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" age\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PhoneNumber\"}),\" phoneNumber\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:`// I'm using \"_\" for readability here, this won't compile`}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getPeopleWithAreaCode\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" people\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" areaCode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" people\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"filter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"person \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"person\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Silly example for demo, doesn't make a lot of sense\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Person\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PhoneNumber\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" areaCode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h1,{id:\"the-usecase-tree-rewritingast-transformations\",children:[(0,n.jsx)(a.a,{href:\"#the-usecase-tree-rewritingast-transformations\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"The Usecase: Tree Rewriting/AST Transformations\"]}),(0,n.jsx)(a.p,{children:\"Now that we've seen some examples of how Record Patterns can be used, let's take a look at a real-world usecase for them: Tree Rewriting/AST Transformations.\"}),(0,n.jsxs)(a.h2,{id:\"what-is-tree-rewriting\",children:[(0,n.jsx)(a.a,{href:\"#what-is-tree-rewriting\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"What is Tree Rewriting?\"]}),(0,n.jsx)(a.p,{children:\"Tree rewriting is a technique used in compilers to transform the AST/IR of a program. This is done by writing a series of rewrite rules that match against the AST, and then rewrite the AST based on the matched rules.\"}),(0,n.jsxs)(a.p,{children:[\"For example, let's say we have a simple \",(0,n.jsx)(a.code,{children:\"Expression\"}),\" AST:\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"permits\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[\"We can then write a simple \",(0,n.jsx)(a.code,{children:\"eval\"}),\" function that evaluates the expression, given a map of variable names to values (the \",(0,n.jsx)(a.code,{children:\"enviroment\"}),\"):\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[\"A rewrite-rule would be a pattern that matches against the \",(0,n.jsx)(a.code,{children:\"Expr\"}),\" AST, and then rewrites it to a new \",(0,n.jsx)(a.code,{children:\"Expr\"}),\" AST. For example, we could write a rule that rewrites \",(0,n.jsx)(a.code,{children:\"x + 0\"}),\" to just \",(0,n.jsx)(a.code,{children:\"x\"}),\".\"]}),(0,n.jsxs)(a.p,{children:[\"In the Apache Spark project, the Scala language makes it incredibly easy to write such rules using \",(0,n.jsx)(a.code,{children:\"case classes\"}),\" and \",(0,n.jsx)(a.code,{children:\"case\"}),\" statements. The \",(0,n.jsx)(a.a,{href:\"https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala\",children:\"Catalyst optimizer code\"}),\" is full of such rewrite rules, and it's a joy to read.\"]}),(0,n.jsxs)(a.h2,{id:\"how-can-record-patterns-help\",children:[(0,n.jsx)(a.a,{href:\"#how-can-record-patterns-help\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"How can Record Patterns help?\"]}),(0,n.jsxs)(a.p,{children:[\"Let's take the above example of a rule that rewrites \",(0,n.jsx)(a.code,{children:\"x + 0\"}),\" to just \",(0,n.jsx)(a.code,{children:\"x\"}),\".\"]}),(0,n.jsxs)(a.p,{children:[\"We can write this rule as follows, using Record Patterns (going a bit further than just \",(0,n.jsx)(a.code,{children:\"x + 0\"}),\", to cover some more cases):\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimplifyZeroOpPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"simplify\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// x + 0 = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// 0 + x = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// x - 0 = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// x * 1 = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// 1 * x = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// x / 1 = x\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// 0 / x = 0\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"var\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" when value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Otherwise, just return the expression\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[\"Can you imagine if we had to write this using traditional \",(0,n.jsx)(a.code,{children:\"instanceof\"}),\" and \",(0,n.jsx)(a.code,{children:\"if\"}),\" statements? It would be a nightmare!\"]}),(0,n.jsx)(a.p,{children:\"It would be something like this (Not checked for accuracy):\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimplifyZeroOpPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"simplify\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),\" add\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"add\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" leftVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" add\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" rightConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" rightConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" leftVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"add\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" leftConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" add\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" rightVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" leftConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" rightVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),\" sub\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"sub\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" leftVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" sub\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" rightConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" rightConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" leftVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),\" mul\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"mul\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" leftVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" mul\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" rightConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" rightConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" leftVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"mul\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" leftConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" mul\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" rightVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" leftConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" rightVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),\" div\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"div\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" leftVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" div\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" rightConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" rightConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" leftVar\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"div\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"left\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" leftConst \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" div\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"right\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"instanceof\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" rightVar \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" leftConst\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h2,{id:\"implementing-the-rewriter\",children:[(0,n.jsx)(a.a,{href:\"#implementing-the-rewriter\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Implementing the Rewriter\"]}),(0,n.jsx)(a.p,{children:\"To wrap up, I'm going to share the implementation of a full program that provides a multi-pass expression simplifier, using Record Patterns.\"}),(0,n.jsxs)(a.p,{children:[\"This is going to be a little bit of a \",(0,n.jsx)(a.a,{href:\"https://knowyourmeme.com/memes/how-to-draw-an-owl\",children:\"Draw the rest of the owl\"}),\" situation, because I feel like the above has already covered the majority of what background the reader needs for understanding the code.\"]}),(0,n.jsx)(a.p,{children:\"What we're going to do is write a program that takes a mathematical expression, and simplifies it using a series of rewrite rules.\"}),(0,n.jsx)(a.p,{children:\"Our two rewrite rules will be:\"}),(0,n.jsxs)(a.ol,{children:[(0,n.jsxs)(a.li,{children:[\"Constant Folding -- convert any expression like \",(0,n.jsx)(a.code,{children:\"Add(Const(1), Const(2))\"}),\" to \",(0,n.jsx)(a.code,{children:\"Const(3)\"}),\".\"]}),(0,n.jsxs)(a.li,{children:[\"Replace all \",(0,n.jsx)(a.code,{children:\"Const(x)\"}),\" with \",(0,n.jsx)(a.code,{children:\"Const(42)\"})]})]}),(0,n.jsxs)(a.p,{children:[\"If we run the below on Java 21 with \",(0,n.jsx)(a.code,{children:\"--enable-preview\"}),\":\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),\" rewriter \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantFoldingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantRewritingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"42\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Create an expression tree for 1 + 2 * 3\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Print the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Original: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Evaluate the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Result: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Now rewrite the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" rewritten \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" rewriter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Print the rewritten expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Rewritten: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" rewritten\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Evaluate the rewritten expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Result: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"rewritten\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsx)(a.p,{children:\"We get the following output:\"}),(0,n.jsx)(a.pre,{className:\"language-ruby\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-ruby\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"user\",(0,n.jsx)(a.span,{className:\"token variable\",children:\"@MSI\"}),\" java\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"record\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"deconstruction\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"patterns\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\"$ \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"/\"}),`gradlew run\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Task\"}),\" \",(0,n.jsx)(a.span,{className:\"token symbol\",children:\":app\"}),(0,n.jsx)(a.span,{className:\"token symbol\",children:\":run\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Original\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Result\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Folding\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Folding\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Folding\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Rewriting\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Rewriting\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Rewriting\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Rewritten\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"left\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"42\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" right\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"42\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token constant\",children:\"Result\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"84\"}),`\n`]})]})}),(0,n.jsx)(a.p,{children:\"Below is the full source code for the program:\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"package\"}),\" \",(0,n.jsxs)(a.span,{className:\"token namespace\",children:[\"deconstruction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"patterns\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(a.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"util\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(a.span,{className:\"token namespace\",children:[\"java\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"util\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"sealed\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"permits\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"record\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Integer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" env\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// A pass which folds simple constant expressions like 1 + 2 into 3.\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimpleConstantFolderPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Folding \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"fold\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// An interface for an expression tree rewriting pass.\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// An interface for an expression rewriter\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" passes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\" passes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"passes \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"passes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Register a pass with the rewriter.\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"register\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),\" pass\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        passes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"pass\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Rewrite an expression tree.\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),\" pass \",(0,n.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" passes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            expr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pass\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"// A pass which rewrites all variables to constants.\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantRewritingPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" constantValue\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantRewritingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" constantValue\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"constantValue \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" constantValue\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Rewriting \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"constantValue\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantFoldingPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewritingPass\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Folding \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"value\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Sub\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Div\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"left\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"right\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"int\"}),\" value\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Var\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"App\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" args\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),\" rewriter \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ExprRewriter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantFoldingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ConstantRewritingPass\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"42\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Create an expression tree for 1 + 2 * 3\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" expr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Mul\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Const\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Print the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Original: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Evaluate the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Result: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Now rewrite the expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Expr\"}),\" rewritten \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" rewriter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"rewrite\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"expr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Print the rewritten expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Rewritten: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" rewritten\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// Evaluate the rewritten expression tree\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"out\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"println\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Result: \"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Evaluator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"evaluate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"rewritten\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h1,{id:\"get-the-source-code\",children:[(0,n.jsx)(a.a,{href:\"#get-the-source-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Get the Source Code\"]}),(0,n.jsx)(a.p,{children:\"The source code to this blog post is available on GitHub:\"}),(0,n.jsx)(a.ul,{children:(0,n.jsx)(a.li,{children:(0,n.jsx)(a.a,{href:\"https://github.com/GavinRay97/java-record-patterns\",children:\"https://github.com/GavinRay97/java-record-patterns\"})})}),(0,n.jsxs)(a.h1,{id:\"attribution\",children:[(0,n.jsx)(a.a,{href:\"#attribution\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Attribution\"]}),(0,n.jsxs)(a.p,{children:[\"The OpenGraph image for this blog post was taken from a Google search for \",(0,n.jsx)(a.code,{children:\"tree ast code\"}),\", and is from a blog post by \",(0,n.jsx)(a.a,{href:\"https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8\",children:\"Lachezar Nickolov\"})]}),(0,n.jsx)(a.ul,{children:(0,n.jsx)(a.li,{children:(0,n.jsx)(a.a,{href:\"https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8\",children:\"https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8\"})})})]})}}var v=y;function x(e,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+e+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return b;})();\n;return Component;","toc":[{"value":"Preface","url":"#preface","depth":1},{"value":"What are Record Patterns?","url":"#what-are-record-patterns","depth":1},{"value":"A Simple Example","url":"#a-simple-example","depth":1},{"value":"A Person POJO, what you're used to","url":"#a-person-pojo-what-youre-used-to","depth":2},{"value":"Let's rewrite it with Records and Record Patterns","url":"#lets-rewrite-it-with-records-and-record-patterns","depth":2},{"value":"What else can we do?","url":"#what-else-can-we-do","depth":2},{"value":"The Usecase: Tree Rewriting/AST Transformations","url":"#the-usecase-tree-rewritingast-transformations","depth":1},{"value":"What is Tree Rewriting?","url":"#what-is-tree-rewriting","depth":2},{"value":"How can Record Patterns help?","url":"#how-can-record-patterns-help","depth":2},{"value":"Implementing the Rewriter","url":"#implementing-the-rewriter","depth":2},{"value":"Get the Source Code","url":"#get-the-source-code","depth":1},{"value":"Attribution","url":"#attribution","depth":1}],"frontMatter":{"readingTime":{"text":"24 min read","minutes":23.665,"time":1419900,"words":4733},"slug":"what-good-are-record-patterns","fileName":"what-good-are-record-patterns.md","title":"What good are Record Patterns in Java? An example based on Spark's Catalyst Optimizer and it's Tree Rewriting Rules","date":"2023-02-04T00:00:00.000Z","tags":["java","jdk","jvm"],"draft":false,"summary":"A tutorial on how to use Java's new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.\n","images":["/static/images/ast-visualization.png"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.85,"time":51000,"words":170},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"Building a PostgreSQL Wire Protocol Server using Vanilla, Modern Java 21","date":"2023-01-16T00:00:00.000Z","tags":["java","jdk","jvm","postgres","wire-protocol","databases","server"],"draft":false,"summary":"A dual-purpose tutorial to 1) Demonstrate how to implement the Simple Query Protocol, where Java is an implementation detail; 2) Show practical examples of most of the new features since JDK 17, including Records, Sealed Types, Pattern Matching for Switch, Virtual Threads, and Panama Foreign-Function \u0026 Memory API.\n","images":["/static/images/postgres-wire-protocol-display-image.png"],"slug":"postgres-wire-protocol-jdk-21"},"next":{"title":"AI SQL Generation: Overcoming dialect-specific syntax errors","date":"2025-05-17T00:00:00.000Z","tags":["sql","text-to-sql","llms"],"draft":false,"summary":"A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL","images":["/static/images/ai-sql-generation.png"],"slug":"overcoming-dialect-sql-generation-limits"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["what-good-are-record-patterns"]},"buildId":"yi_hyVvrRttOodt0N59ik","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>