<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>AI SQL Generation: Overcoming dialect-specific syntax errors</title><meta name="robots" content="follow, index"/><meta name="description" content="A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL"/><meta property="og:url" content="https://gavinray97.github.io/blog/overcoming-dialect-sql-generation-limits"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Gavin Ray Blog"/><meta property="og:description" content="A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL"/><meta property="og:title" content="AI SQL Generation: Overcoming dialect-specific syntax errors"/><meta property="og:image" content="https://gavinray97.github.io/static/images/ai-sql-generation.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/GavinRayDev"/><meta name="twitter:title" content="AI SQL Generation: Overcoming dialect-specific syntax errors"/><meta name="twitter:description" content="A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL"/><meta name="twitter:image" content="https://gavinray97.github.io/static/images/ai-sql-generation.png"/><link rel="canonical" href="https://gavinray97.github.io/blog/overcoming-dialect-sql-generation-limits"/><meta property="article:published_time" content="2025-05-17T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://gavinray97.github.io/blog/overcoming-dialect-sql-generation-limits"
  },
  "headline": "AI SQL Generation: Overcoming dialect-specific syntax errors",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/ai-sql-generation.png"
    }
  ],
  "datePublished": "2025-05-17T00:00:00.000Z",
  "dateModified": "2025-05-17T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Gavin Ray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Gavin Ray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://gavinray97.github.io/static/images/logo.png"
    }
  },
  "description": "A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/11bf37f52e8561b6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11bf37f52e8561b6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bdcdf64985b3467.js" defer=""></script><script src="/_next/static/chunks/main-bb8a1082161dc7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-da15d2a3f366f449.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-dd685ae53e609b20.js" defer=""></script><script src="/_next/static/chunks/620-407ce78f2f46843c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-52c7b4963ecd0646.js" defer=""></script><script src="/_next/static/0nAhX7uCIcvT_SMqzyo8b/_buildManifest.js" defer=""></script><script src="/_next/static/0nAhX7uCIcvT_SMqzyo8b/_ssgManifest.js" defer=""></script><script src="/_next/static/0nAhX7uCIcvT_SMqzyo8b/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="" href="/"><div class="flex items-center justify-between"><div class="mr-3"></div><div class="hidden h-6 text-2xl font-semibold sm:block"></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-05-17T00:00:00.000Z">Saturday, May 17, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">AI SQL Generation: Overcoming dialect-specific syntax errors</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/me.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Gavin Ray</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@GavinRayDev</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#background">Background</a></li><li><a href="#abstract-query-asts">Abstract Query AST&#x27;s</a></li><li><a href="#asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino">Asking an LLM to generate a JSON query for MySQL, Postgres, and Trino</a></li><li><a href="#why-the-problem-is-non-trivial">Why the Problem is Non-Trivial</a><ul><li style="margin-left:24px"><a href="#note-jooqs-translate-online-tool">NOTE: jOOQ&#x27;s &quot;Translate&quot; Online Tool</a></li><li style="margin-left:24px"><a href="#json-query">JSON Query</a><ul><li style="margin-left:48px"><a href="#mariadb">MariaDB</a></li><li style="margin-left:48px"><a href="#trinoprestoathena">Trino/Presto/Athena</a></li><li style="margin-left:48px"><a href="#sql-server">SQL Server</a></li></ul></li><li style="margin-left:24px"><a href="#generate-series">Generate Series</a><ul><li style="margin-left:48px"><a href="#postgres">Postgres</a></li><li style="margin-left:48px"><a href="#clickhouse">Clickhouse</a></li><li style="margin-left:48px"><a href="#snowflake">Snowflake</a></li><li style="margin-left:48px"><a href="#oracle">Oracle</a></li><li style="margin-left:48px"><a href="#mysql">MySQL</a></li></ul></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul></div></details><hr/><h1 id="introduction"><a href="#introduction" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Introduction</h1><p>Recently, I&#x27;ve noticed several comments about the difficulty of getting LLM&#x27;s to generate SQL that is valid across multiple dialects.</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://news.ycombinator.com/item?id=43812675">https://news.ycombinator.com/item?id=43812675</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/blog/products/databases/techniques-for-improving-text-to-sql">https://cloud.google.com/blog/products/databases/techniques-for-improving-text-to-sql</a></li></ul><p>From the Google Cloud article above:</p><blockquote><p>Problem #3: Limits of LLM generation</p><p>... But some models can struggle with following precise instructions and getting details exactly right, particularly when it comes to more obscure SQL features. To be able to produce correct SQL, the LLM needs to adhere closely to what can often turn into complex specifications.</p><p>Example: Consider the differences between SQL dialects, which are more subtle than differences between programming languages like Python and Java. As a simple example, if you&#x27;re using BigQuery SQL, the correct function for extracting a month from a timestamp column is <code>EXTRACT(MONTH FROM timestamp_column)</code>. But if you are using MySQL, you use <code>MONTH(timestamp_column)</code>.</p></blockquote><h1 id="background"><a href="#background" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Background</h1><p>My dayjob and work for the last several years involves this exact problem.</p><p>Essentially, I need to preserve and represent the semantics of some particular query across multiple dialects of SQL.</p><p>You might think this is a task that can be solved with a few edge-case conditionals, but the reality is that the nuances of behavior and syntax support across dialects are worse than you likely imagine.</p><p>I&#x27;ll discuss an approach that has worked for us, which can be used with LLM&#x27;s as a generation target to solve this issue.</p><h1 id="abstract-query-asts"><a href="#abstract-query-asts" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Abstract Query AST&#x27;s</h1><p>Rather than having code which generates direct SQL, use an IR layer that represents the abstract form of a query.</p><p>For example, suppose you have something like:</p><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">SELECT</span> json_agg<span class="token punctuation">(</span>
</span><span class="code-line">    json_build_object<span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">&#x27;todos&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token keyword">SELECT</span> json_agg<span class="token punctuation">(</span>json_build_object<span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&#x27;todo&#x27;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>todo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">FROM</span> user_todos t
</span><span class="code-line">            <span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">FROM</span> users u<span class="token punctuation">;</span>
</span></code></pre></div><p>You might have a representation like:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token function">select</span><span class="token punctuation">(</span><span class="token function">jsonArrayAgg</span><span class="token punctuation">(</span><span class="token function">jsonObject</span><span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token string">&quot;todos&quot;</span><span class="token punctuation">,</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token function">jsonArrayAgg</span><span class="token punctuation">(</span><span class="token function">jsonObject</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token string">&quot;todo&quot;</span><span class="token punctuation">,</span> <span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;todo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;user_todos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span>
</span></code></pre></div><p>And then the query can be rendered/interpreted at runtime into dialect specific SQL like:</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token keyword">var</span> renderedQuery <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">Database</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">,</span> queryAST<span class="token punctuation">)</span>
</span></code></pre></div><p>Many languages have query-builder libraries which allow you to write statements like the above.</p><p>On the JVM, we have <a target="_blank" rel="noopener noreferrer" href="https://github.com/jOOQ/jOOQ">jOOQ</a>, but many similar tools exist in other ecosystems, such as Entity Framework, SQL Alchemy, Kysely, and others.</p><h1 id="asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino"><a href="#asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Asking an LLM to generate a JSON query for MySQL, Postgres, and Trino</h1><p>We can ask an LLM to write us an <strong>abstract query</strong> like the one above.</p><p>Then we can render this query to multiple dialects and view the output.</p><p>For the sake of sharing this online, I will use Scala (sorry) because it&#x27;s the only JVM language with an online playground that allows importing external libraries (that I know of).</p><p>I asked Claude:</p><p><a target="_blank" rel="noopener noreferrer" href="https://claude.ai/share/df8b9e6b-c01d-409a-a977-11d35f383741">https://claude.ai/share/df8b9e6b-c01d-409a-a977-11d35f383741</a></p><blockquote><p>Please write Scala 3 code to represent the following Postgres SQL query as a jOOQ DSL <code>Query</code>. The code should generate a single, inline query and be as succinct as possible.</p></blockquote><p>It output the below:</p><div class="relative"><pre><code class="code-highlight language-scala"><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>DSL
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>DSL<span class="token punctuation">.</span>_
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Define the tables</span>
</span><span class="code-line"><span class="token keyword">val</span> users <span class="token operator">=</span> table<span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as<span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">val</span> userTodos <span class="token operator">=</span> table<span class="token punctuation">(</span><span class="token string">&quot;user_todos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Create the query</span>
</span><span class="code-line"><span class="token keyword">val</span> query <span class="token operator">=</span> select<span class="token punctuation">(</span>
</span><span class="code-line">  jsonArrayAgg<span class="token punctuation">(</span>
</span><span class="code-line">    jsonObject<span class="token punctuation">(</span>
</span><span class="code-line">      key<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;u.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      key<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;u.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      key<span class="token punctuation">(</span><span class="token string">&quot;todos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">(</span>
</span><span class="code-line">        select<span class="token punctuation">(</span>
</span><span class="code-line">          jsonArrayAgg<span class="token punctuation">(</span>
</span><span class="code-line">            jsonObject<span class="token punctuation">(</span>
</span><span class="code-line">              key<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;t.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">              key<span class="token punctuation">(</span><span class="token string">&quot;todo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;t.todo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span>from<span class="token punctuation">(</span>userTodos<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span>where<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;t.user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eq<span class="token punctuation">(</span>field<span class="token punctuation">(</span><span class="token string">&quot;u.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">.</span>from<span class="token punctuation">(</span>users<span class="token punctuation">)</span>
</span></code></pre></div><p>We can run this online with <strong>Scastie</strong>, and view the output:</p><p><a target="_blank" rel="noopener noreferrer" href="https://scastie.scala-lang.org/HMX9awUVRAuAdLdX7PntRA">https://scastie.scala-lang.org/HMX9awUVRAuAdLdX7PntRA</a></p><div class="relative"><pre><code class="code-highlight language-scala"><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span></span>SQLDialect
</span><span class="code-line"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq<span class="token punctuation">.</span>conf<span class="token punctuation">.</span></span>Settings
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">for</span> <span class="token punctuation">(</span>dialect <span class="token keyword">&lt;-</span> Seq<span class="token punctuation">(</span>SQLDialect<span class="token punctuation">.</span>MYSQL<span class="token punctuation">,</span> SQLDialect<span class="token punctuation">.</span>POSTGRES<span class="token punctuation">,</span> SQLDialect<span class="token punctuation">.</span>TRINO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">val</span> ctx <span class="token operator">=</span> DSL<span class="token punctuation">.</span>using<span class="token punctuation">(</span>dialect<span class="token punctuation">,</span> Settings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>withRenderFormatted<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    println<span class="token punctuation">(</span>s<span class="token string">&quot;Query in ${dialect.name()}:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    println<span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>renderInlined<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Running this in your browser should give you:</p><details><summary>👇 CLICK TO VIEW OUTPUT 👇</summary><div class="relative"><pre><code class="code-highlight"><span class="code-line">============================
</span><span class="code-line">Query in MYSQL:
</span><span class="code-line">set @t = @@group_concat_max_len;
</span><span class="code-line">set @@group_concat_max_len = 4294967295;
</span><span class="code-line">select json_merge_preserve(
</span><span class="code-line">  &#x27;[]&#x27;,
</span><span class="code-line">  concat(
</span><span class="code-line">    &#x27;[&#x27;,
</span><span class="code-line">    group_concat(json_object(
</span><span class="code-line">      &#x27;id&#x27;, u.id,
</span><span class="code-line">      &#x27;name&#x27;, u.name,
</span><span class="code-line">      &#x27;todos&#x27;, (
</span><span class="code-line">        select json_merge_preserve(
</span><span class="code-line">          &#x27;[]&#x27;,
</span><span class="code-line">          concat(
</span><span class="code-line">            &#x27;[&#x27;,
</span><span class="code-line">            group_concat(json_object(
</span><span class="code-line">              &#x27;id&#x27;, t.id,
</span><span class="code-line">              &#x27;todo&#x27;, t.todo
</span><span class="code-line">            ) separator &#x27;,&#x27;),
</span><span class="code-line">            &#x27;]&#x27;
</span><span class="code-line">          )
</span><span class="code-line">        )
</span><span class="code-line">        from user_todos as `t`
</span><span class="code-line">        where t.user_id = u.id
</span><span class="code-line">      )
</span><span class="code-line">    ) separator &#x27;,&#x27;),
</span><span class="code-line">    &#x27;]&#x27;
</span><span class="code-line">  )
</span><span class="code-line">)
</span><span class="code-line">from users as `u`;
</span><span class="code-line">set @@group_concat_max_len = @t;
</span><span class="code-line">
</span><span class="code-line">============================
</span><span class="code-line">Query in POSTGRES:
</span><span class="code-line">select json_agg(json_build_object(
</span><span class="code-line">  &#x27;id&#x27;, u.id,
</span><span class="code-line">  &#x27;name&#x27;, u.name,
</span><span class="code-line">  &#x27;todos&#x27;, (
</span><span class="code-line">    select json_agg(json_build_object(
</span><span class="code-line">      &#x27;id&#x27;, t.id,
</span><span class="code-line">      &#x27;todo&#x27;, t.todo
</span><span class="code-line">    ))
</span><span class="code-line">    from user_todos as &quot;t&quot;
</span><span class="code-line">    where t.user_id = u.id
</span><span class="code-line">  )
</span><span class="code-line">))
</span><span class="code-line">from users as &quot;u&quot;
</span><span class="code-line">
</span><span class="code-line">============================
</span><span class="code-line">Query in TRINO:
</span><span class="code-line">select cast(array_agg(cast(map_from_entries(array[
</span><span class="code-line">  row(
</span><span class="code-line">    &#x27;id&#x27;,
</span><span class="code-line">    cast(u.id as json)
</span><span class="code-line">  ),
</span><span class="code-line">  row(
</span><span class="code-line">    &#x27;name&#x27;,
</span><span class="code-line">    cast(u.name as json)
</span><span class="code-line">  ),
</span><span class="code-line">  row(
</span><span class="code-line">    &#x27;todos&#x27;,
</span><span class="code-line">    cast((
</span><span class="code-line">      select cast(array_agg(cast(map_from_entries(array[
</span><span class="code-line">        row(
</span><span class="code-line">          &#x27;id&#x27;,
</span><span class="code-line">          cast(t.id as json)
</span><span class="code-line">        ),
</span><span class="code-line">        row(
</span><span class="code-line">          &#x27;todo&#x27;,
</span><span class="code-line">          cast(t.todo as json)
</span><span class="code-line">        )
</span><span class="code-line">      ]) as json)) as json)
</span><span class="code-line">      from user_todos &quot;t&quot;
</span><span class="code-line">      where t.user_id = u.id
</span><span class="code-line">    ) as json)
</span><span class="code-line">  )
</span><span class="code-line">]) as json)) as json)
</span><span class="code-line">from users &quot;u&quot;
</span></code></pre></div></details><blockquote><p>NOTE: The output isn&#x27;t <em>100%</em> correct because it omits <code>field(name(&quot;t&quot;, &quot;user_id&quot;))</code> to properly handle quoting. But we&#x27;ll give it a break because realistically you would upload the jOOQ API as reference material in production</p></blockquote><h1 id="why-the-problem-is-non-trivial"><a href="#why-the-problem-is-non-trivial" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why the Problem is Non-Trivial</h1><p>Let&#x27;s use the above query as one example of why you can&#x27;t write some home-spun Query Builder API in an afternoon to solve this problem.</p><p>You might think, <em>&quot;Okay, so the syntax for JSON object creation varies between dialects -- I&#x27;ll just have some interface like:&quot;</em></p><div class="relative"><pre><code class="code-highlight language-ts"><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">SQLGenerator</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">function</span> <span class="token function">jsonObject</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> SQLExpression<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> SQLExpression<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">function</span> <span class="token function">jsonArrayAgg</span><span class="token punctuation">(</span>expression<span class="token operator">:</span> SQLExpression<span class="token punctuation">)</span><span class="token operator">:</span> SQLExpression<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>But the problem is not so straightforward. Let&#x27;s look at two examples that I think saliently illustrate this point:</p><ol><li>How to represent the above JSON query in various dialects</li><li>How to implement <code>generate_series()</code> in various dialects</li></ol><h2 id="note-jooqs-translate-online-tool"><a href="#note-jooqs-translate-online-tool" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>NOTE: jOOQ&#x27;s &quot;Translate&quot; Online Tool</h2><p>The following syntax derivations were done using the online jOOQ <em>&quot;Translate&quot;</em> tool.</p><p><a target="_blank" rel="noopener noreferrer" href="https://www.jooq.org/translate">https://www.jooq.org/translate</a></p><p>This tool is highly useful if you need to translate SQL into unfamiliar dialects:</p><p><img alt="jooq translate online tool screenshot" src="/static/images/jooq-translate-tool.png"/></p><h2 id="json-query"><a href="#json-query" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>JSON Query</h2><h3 id="mariadb"><a href="#mariadb" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>MariaDB</h3><p>For some background context, reference the following blogpost by Lukas Eder, jOOQ author:</p><p><a target="_blank" rel="noopener noreferrer" href="https://blog.jooq.org/standard-sql-json-the-sobering-parts/">&quot;Standard SQL/JSON – The Sobering Parts&quot;</a></p><p>The sections on MySQL and MariaDB contain a better description of the various issues than I could give, but for this example the gist of it is:</p><ul><li><code>ORDER BY</code> as part of a JSON expression is not supported, so you&#x27;ve got to use <code>group_concat</code> to build the result</li><li>The maximum length of <code>group_concat</code>&#x27;ed expressions is controlled by a DB variable. Creating a string larger than this value will cause cryptic errors about malformed input from <code>json_merge_preserve</code> due to truncation.</li><li>To prevent escaped output when building the JSON, e.g. <code>{&quot;titles&quot;: &quot;[\&quot;1984\&quot;,\&quot;Animal Farm\&quot;,\&quot;O Alquimista\&quot;,\&quot;Brida\&quot;]&quot;}</code>, you need to call <code>json_merge_preserve</code></li></ul><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">set</span> <span class="token variable">@t</span> <span class="token operator">=</span> @<span class="token variable">@group_concat_max_len</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">set</span> @<span class="token variable">@group_concat_max_len</span> <span class="token operator">=</span> <span class="token number">4294967295</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">select</span> json_merge_preserve<span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token string">&#x27;[]&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  concat<span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token string">&#x27;[&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    group_concat<span class="token punctuation">(</span>json_merge_preserve<span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token string">&#x27;{}&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      json_object<span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      json_object<span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      json_object<span class="token punctuation">(</span><span class="token string">&#x27;todos&#x27;</span><span class="token punctuation">,</span> json_merge_preserve<span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token string">&#x27;[]&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">(</span>
</span><span class="code-line">          <span class="token keyword">select</span> json_merge_preserve<span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token string">&#x27;[]&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">            concat<span class="token punctuation">(</span>
</span><span class="code-line">              <span class="token string">&#x27;[&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              group_concat<span class="token punctuation">(</span>json_merge_preserve<span class="token punctuation">(</span>
</span><span class="code-line">                <span class="token string">&#x27;{}&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">                json_object<span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                json_object<span class="token punctuation">(</span><span class="token string">&#x27;todo&#x27;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>todo<span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token punctuation">)</span> separator <span class="token string">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token string">&#x27;]&#x27;</span>
</span><span class="code-line">            <span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token keyword">from</span> user_todos <span class="token keyword">as</span> t
</span><span class="code-line">          <span class="token keyword">where</span> t<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span> separator <span class="token string">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">&#x27;]&#x27;</span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">from</span> users <span class="token keyword">as</span> u<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">set</span> @<span class="token variable">@group_concat_max_len</span> <span class="token operator">=</span> <span class="token variable">@t</span><span class="token punctuation">;</span>
</span></code></pre></div><h3 id="trinoprestoathena"><a href="#trinoprestoathena" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Trino/Presto/Athena</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> cast<span class="token punctuation">(</span>array_agg<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>map_from_entries<span class="token punctuation">(</span>array<span class="token punctuation">[</span>
</span><span class="code-line">  <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> cast<span class="token punctuation">(</span>u<span class="token punctuation">.</span>id <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> cast<span class="token punctuation">(</span>u<span class="token punctuation">.</span>name <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token keyword">row</span><span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token string">&#x27;todos&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    cast<span class="token punctuation">(</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token keyword">select</span> cast<span class="token punctuation">(</span>array_agg<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>map_from_entries<span class="token punctuation">(</span>array<span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">,</span> cast<span class="token punctuation">(</span>t<span class="token punctuation">.</span>id <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token keyword">row</span><span class="token punctuation">(</span><span class="token string">&#x27;todo&#x27;</span><span class="token punctuation">,</span> cast<span class="token punctuation">(</span>t<span class="token punctuation">.</span>todo <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token keyword">from</span> user_todos t
</span><span class="code-line">      <span class="token keyword">where</span> t<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id
</span><span class="code-line">    <span class="token punctuation">)</span> <span class="token keyword">as</span> json<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">from</span> users u
</span></code></pre></div><h3 id="sql-server"><a href="#sql-server" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>SQL Server</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> json_arrayagg<span class="token punctuation">(</span><span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token keyword">select</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line">    <span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token keyword">values</span> <span class="token punctuation">(</span>
</span><span class="code-line">        u<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
</span><span class="code-line">        u<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
</span><span class="code-line">        json_query<span class="token punctuation">(</span><span class="token punctuation">(</span>
</span><span class="code-line">          <span class="token keyword">select</span> json_arrayagg<span class="token punctuation">(</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line">            <span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">              <span class="token keyword">values</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">,</span> t<span class="token punctuation">.</span>todo<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">)</span> t <span class="token punctuation">(</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todo<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">for</span> json path<span class="token punctuation">,</span> include_null_values<span class="token punctuation">,</span> without_array_wrapper
</span><span class="code-line">          <span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token keyword">from</span> user_todos t
</span><span class="code-line">          <span class="token keyword">where</span> t<span class="token punctuation">.</span>user_id <span class="token operator">=</span> u<span class="token punctuation">.</span>id
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span> t <span class="token punctuation">(</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> json path<span class="token punctuation">,</span> include_null_values<span class="token punctuation">,</span> without_array_wrapper
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">from</span> users u
</span></code></pre></div><h2 id="generate-series"><a href="#generate-series" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Generate Series</h2><p>Now lets look at the SQL for generating a series of integer values from a given range:</p><h3 id="postgres"><a href="#postgres" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Postgres</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">SELECT</span> i <span class="token keyword">FROM</span> generate_series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> i<span class="token punctuation">;</span>
</span></code></pre></div><h3 id="clickhouse"><a href="#clickhouse" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Clickhouse</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> i
</span><span class="code-line"><span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token keyword">select</span> cast<span class="token punctuation">(</span>number <span class="token keyword">as</span> Nullable<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i
</span><span class="code-line">  <span class="token keyword">from</span> numbers<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span> i
</span></code></pre></div><h3 id="snowflake"><a href="#snowflake" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Snowflake</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> i
</span><span class="code-line"><span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token keyword">select</span> <span class="token punctuation">(</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token keyword">select</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i
</span><span class="code-line">  <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">(</span>generator<span class="token punctuation">(</span><span class="token keyword">rowcount</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span> i
</span></code></pre></div><h3 id="oracle"><a href="#oracle" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Oracle</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> i
</span><span class="code-line"><span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">level</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i
</span><span class="code-line">  <span class="token keyword">from</span> DUAL
</span><span class="code-line">  <span class="token keyword">connect</span> <span class="token keyword">by</span> <span class="token keyword">level</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span> i
</span></code></pre></div><h3 id="mysql"><a href="#mysql" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>MySQL</h3><div class="relative"><pre><code class="language-sql code-highlight"><span class="code-line"><span class="token keyword">select</span> i
</span><span class="code-line"><span class="token keyword">from</span> <span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token keyword">with</span> recursive
</span><span class="code-line">    i<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token keyword">select</span> <span class="token number">1</span>
</span><span class="code-line">      <span class="token keyword">union</span> <span class="token keyword">all</span>
</span><span class="code-line">      <span class="token keyword">select</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token keyword">from</span> i
</span><span class="code-line">      <span class="token keyword">where</span> i <span class="token operator">&lt;</span> <span class="token number">10</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">select</span> i
</span><span class="code-line">  <span class="token keyword">from</span> i
</span><span class="code-line"><span class="token punctuation">)</span> <span class="token keyword">as</span> i
</span></code></pre></div><h1 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h1><p>I hope this post has given you a sense for how leveraging an abstract Query IR as your SQL generation target can help deal with the complexities of portable, cross-dialect SQL.</p><p>It&#x27;s proven an effective strategy for what I use it for.</p><blockquote><p>AI Disclaimer: ChatGPT 4.1 was used to generate the Open Graph image for this post.</p></blockquote></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fgavinray97.github.io%2Fblog%2Fovercoming-dialect-sql-generation-limits">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97/GavinRay97.github.io/blob/master/data/blog/overcoming-dialect-sql-generation-limits.md">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/sql">sql</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/text-to-sql">text-to-sql</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/llms">llms</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/what-good-are-record-patterns">What good are Record Patterns in Java? An example based on Spark&#x27;s Catalyst Optimizer and it&#x27;s Tree Rewriting Rules</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/perspectives-on-psychedelic-use">Psychedelics as Tools: Reflections After 20+ Compounds and a Decade of Experiments</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:ray.gavin97@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/GavinRay97"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/GavinRayDev"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Gavin Ray</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Gavin Ray Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!m.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=p(s,e))||c.enumerable});return a},y=a=\u003eg(t(l(a!=null?d(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((q,o)=\u003e{o.exports=_jsx_runtime});var j={};k(j,{default:()=\u003eb,frontmatter:()=\u003ew});var n=y(r()),w={title:\"AI SQL Generation: Overcoming dialect-specific syntax errors\",date:\"2025-05-17\",tags:[\"sql\",\"text-to-sql\",\"llms\"],draft:!1,summary:\"A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL\",images:[\"/static/images/ai-sql-generation.png\"]};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",blockquote:\"blockquote\",code:\"code\",pre:\"pre\",strong:\"strong\",em:\"em\",ol:\"ol\",h2:\"h2\",img:\"img\",h3:\"h3\"},a.components),{TOCInline:i}=e;return i||_(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i,{toc:a.toc,indentDepth:3,asDisclosure:!0}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h1,{id:\"introduction\",children:[(0,n.jsx)(e.a,{href:\"#introduction\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),(0,n.jsx)(e.p,{children:\"Recently, I've noticed several comments about the difficulty of getting LLM's to generate SQL that is valid across multiple dialects.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://news.ycombinator.com/item?id=43812675\",children:\"https://news.ycombinator.com/item?id=43812675\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/blog/products/databases/techniques-for-improving-text-to-sql\",children:\"https://cloud.google.com/blog/products/databases/techniques-for-improving-text-to-sql\"})})]}),(0,n.jsx)(e.p,{children:\"From the Google Cloud article above:\"}),(0,n.jsxs)(e.blockquote,{children:[(0,n.jsx)(e.p,{children:\"Problem #3: Limits of LLM generation\"}),(0,n.jsx)(e.p,{children:\"... But some models can struggle with following precise instructions and getting details exactly right, particularly when it comes to more obscure SQL features. To be able to produce correct SQL, the LLM needs to adhere closely to what can often turn into complex specifications.\"}),(0,n.jsxs)(e.p,{children:[\"Example: Consider the differences between SQL dialects, which are more subtle than differences between programming languages like Python and Java. As a simple example, if you're using BigQuery SQL, the correct function for extracting a month from a timestamp column is \",(0,n.jsx)(e.code,{children:\"EXTRACT(MONTH FROM timestamp_column)\"}),\". But if you are using MySQL, you use \",(0,n.jsx)(e.code,{children:\"MONTH(timestamp_column)\"}),\".\"]})]}),(0,n.jsxs)(e.h1,{id:\"background\",children:[(0,n.jsx)(e.a,{href:\"#background\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Background\"]}),(0,n.jsx)(e.p,{children:\"My dayjob and work for the last several years involves this exact problem.\"}),(0,n.jsx)(e.p,{children:\"Essentially, I need to preserve and represent the semantics of some particular query across multiple dialects of SQL.\"}),(0,n.jsx)(e.p,{children:\"You might think this is a task that can be solved with a few edge-case conditionals, but the reality is that the nuances of behavior and syntax support across dialects are worse than you likely imagine.\"}),(0,n.jsx)(e.p,{children:\"I'll discuss an approach that has worked for us, which can be used with LLM's as a generation target to solve this issue.\"}),(0,n.jsxs)(e.h1,{id:\"abstract-query-asts\",children:[(0,n.jsx)(e.a,{href:\"#abstract-query-asts\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Abstract Query AST's\"]}),(0,n.jsx)(e.p,{children:\"Rather than having code which generates direct SQL, use an IR layer that represents the abstract form of a query.\"}),(0,n.jsx)(e.p,{children:\"For example, suppose you have something like:\"}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" json_agg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    json_build_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'todos'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" json_agg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"json_build_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'todo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),` user_todos t\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WHERE\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user_id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" users u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"You might have a representation like:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"select\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonArrayAgg\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonObject\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"todos\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"select\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonArrayAgg\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonObject\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"todo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"todo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"user_todos\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"as\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"where\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"user_id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"eq\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"users\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"as\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"And then the query can be rendered/interpreted at runtime into dialect specific SQL like:\"}),(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-java\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" renderedQuery \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"render\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Database\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"MYSQL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" queryAST\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"Many languages have query-builder libraries which allow you to write statements like the above.\"}),(0,n.jsxs)(e.p,{children:[\"On the JVM, we have \",(0,n.jsx)(e.a,{href:\"https://github.com/jOOQ/jOOQ\",children:\"jOOQ\"}),\", but many similar tools exist in other ecosystems, such as Entity Framework, SQL Alchemy, Kysely, and others.\"]}),(0,n.jsxs)(e.h1,{id:\"asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino\",children:[(0,n.jsx)(e.a,{href:\"#asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Asking an LLM to generate a JSON query for MySQL, Postgres, and Trino\"]}),(0,n.jsxs)(e.p,{children:[\"We can ask an LLM to write us an \",(0,n.jsx)(e.strong,{children:\"abstract query\"}),\" like the one above.\"]}),(0,n.jsx)(e.p,{children:\"Then we can render this query to multiple dialects and view the output.\"}),(0,n.jsx)(e.p,{children:\"For the sake of sharing this online, I will use Scala (sorry) because it's the only JVM language with an online playground that allows importing external libraries (that I know of).\"}),(0,n.jsx)(e.p,{children:\"I asked Claude:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://claude.ai/share/df8b9e6b-c01d-409a-a977-11d35f383741\",children:\"https://claude.ai/share/df8b9e6b-c01d-409a-a977-11d35f383741\"})}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"Please write Scala 3 code to represent the following Postgres SQL query as a jOOQ DSL \",(0,n.jsx)(e.code,{children:\"Query\"}),\". The code should generate a single, inline query and be as succinct as possible.\"]})}),(0,n.jsx)(e.p,{children:\"It output the below:\"}),(0,n.jsx)(e.pre,{className:\"language-scala\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-scala\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"jooq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"impl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),`DSL\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"jooq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"impl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),\"DSL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`_\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Define the tables\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" users \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" table\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"users\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"as\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" userTodos \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" table\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"user_todos\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"as\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Create the query\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" query \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" select\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  jsonArrayAgg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    jsonObject\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u.id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u.name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"todos\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        select\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          jsonArrayAgg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            jsonObject\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t.id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"todo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t.todo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"userTodos\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"t.user_id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"eq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"field\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"u.id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"users\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"We can run this online with \",(0,n.jsx)(e.strong,{children:\"Scastie\"}),\", and view the output:\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://scastie.scala-lang.org/HMX9awUVRAuAdLdX7PntRA\",children:\"https://scastie.scala-lang.org/HMX9awUVRAuAdLdX7PntRA\"})}),(0,n.jsx)(e.pre,{className:\"language-scala\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-scala\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"jooq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),`SQLDialect\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"jooq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"conf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),`Settings\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dialect \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"\u003c-\"}),\" Seq\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"SQLDialect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"MYSQL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" SQLDialect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"POSTGRES\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" SQLDialect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"TRINO\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"val\"}),\" ctx \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" DSL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"using\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dialect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Settings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"withRenderFormatted\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    println\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"s\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Query in ${dialect.name()}:\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    println\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"renderInlined\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Running this in your browser should give you:\"}),(0,n.jsxs)(\"details\",{children:[(0,n.jsx)(\"summary\",{children:\"\\u{1F447} CLICK TO VIEW OUTPUT \\u{1F447}\"}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`============================\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Query in MYSQL:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`set @t = @@group_concat_max_len;\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`set @@group_concat_max_len = 4294967295;\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`select json_merge_preserve(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  '[]',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  concat(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    '[',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    group_concat(json_object(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      'id', u.id,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      'name', u.name,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      'todos', (\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        select json_merge_preserve(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          '[]',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          concat(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            '[',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            group_concat(json_object(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`              'id', t.id,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`              'todo', t.todo\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            ) separator ','),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            ']'\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"        from user_todos as `t`\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        where t.user_id = u.id\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    ) separator ','),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    ']'\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"from users as `u`;\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`set @@group_concat_max_len = @t;\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`============================\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Query in POSTGRES:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`select json_agg(json_build_object(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  'id', u.id,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  'name', u.name,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  'todos', (\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    select json_agg(json_build_object(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      'id', t.id,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      'todo', t.todo\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    ))\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    from user_todos as \"t\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    where t.user_id = u.id\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`))\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`from users as \"u\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`============================\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Query in TRINO:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`select cast(array_agg(cast(map_from_entries(array[\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  row(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    'id',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    cast(u.id as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  ),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  row(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    'name',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    cast(u.name as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  ),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  row(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    'todos',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    cast((\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      select cast(array_agg(cast(map_from_entries(array[\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        row(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          'id',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          cast(t.id as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        ),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        row(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          'todo',\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          cast(t.todo as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      ]) as json)) as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      from user_todos \"t\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      where t.user_id = u.id\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    ) as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  )\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`]) as json)) as json)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`from users \"u\"\n`})]})})]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"NOTE: The output isn't \",(0,n.jsx)(e.em,{children:\"100%\"}),\" correct because it omits \",(0,n.jsx)(e.code,{children:'field(name(\"t\", \"user_id\"))'}),\" to properly handle quoting. But we'll give it a break because realistically you would upload the jOOQ API as reference material in production\"]})}),(0,n.jsxs)(e.h1,{id:\"why-the-problem-is-non-trivial\",children:[(0,n.jsx)(e.a,{href:\"#why-the-problem-is-non-trivial\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Why the Problem is Non-Trivial\"]}),(0,n.jsx)(e.p,{children:\"Let's use the above query as one example of why you can't write some home-spun Query Builder API in an afternoon to solve this problem.\"}),(0,n.jsxs)(e.p,{children:[\"You might think, \",(0,n.jsx)(e.em,{children:`\"Okay, so the syntax for JSON object creation varies between dialects -- I'll just have some interface like:\"`})]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-ts\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SQLGenerator\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonObject\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" SQLExpression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" SQLExpression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonArrayAgg\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"expression\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" SQLExpression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" SQLExpression\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"But the problem is not so straightforward. Let's look at two examples that I think saliently illustrate this point:\"}),(0,n.jsxs)(e.ol,{children:[(0,n.jsx)(e.li,{children:\"How to represent the above JSON query in various dialects\"}),(0,n.jsxs)(e.li,{children:[\"How to implement \",(0,n.jsx)(e.code,{children:\"generate_series()\"}),\" in various dialects\"]})]}),(0,n.jsxs)(e.h2,{id:\"note-jooqs-translate-online-tool\",children:[(0,n.jsx)(e.a,{href:\"#note-jooqs-translate-online-tool\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),`NOTE: jOOQ's \"Translate\" Online Tool`]}),(0,n.jsxs)(e.p,{children:[\"The following syntax derivations were done using the online jOOQ \",(0,n.jsx)(e.em,{children:'\"Translate\"'}),\" tool.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://www.jooq.org/translate\",children:\"https://www.jooq.org/translate\"})}),(0,n.jsx)(e.p,{children:\"This tool is highly useful if you need to translate SQL into unfamiliar dialects:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"jooq translate online tool screenshot\",src:\"/static/images/jooq-translate-tool.png\"})}),(0,n.jsxs)(e.h2,{id:\"json-query\",children:[(0,n.jsx)(e.a,{href:\"#json-query\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"JSON Query\"]}),(0,n.jsxs)(e.h3,{id:\"mariadb\",children:[(0,n.jsx)(e.a,{href:\"#mariadb\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"MariaDB\"]}),(0,n.jsx)(e.p,{children:\"For some background context, reference the following blogpost by Lukas Eder, jOOQ author:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://blog.jooq.org/standard-sql-json-the-sobering-parts/\",children:'\"Standard SQL/JSON \\u2013 The Sobering Parts\"'})}),(0,n.jsx)(e.p,{children:\"The sections on MySQL and MariaDB contain a better description of the various issues than I could give, but for this example the gist of it is:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"ORDER BY\"}),\" as part of a JSON expression is not supported, so you've got to use \",(0,n.jsx)(e.code,{children:\"group_concat\"}),\" to build the result\"]}),(0,n.jsxs)(e.li,{children:[\"The maximum length of \",(0,n.jsx)(e.code,{children:\"group_concat\"}),\"'ed expressions is controlled by a DB variable. Creating a string larger than this value will cause cryptic errors about malformed input from \",(0,n.jsx)(e.code,{children:\"json_merge_preserve\"}),\" due to truncation.\"]}),(0,n.jsxs)(e.li,{children:[\"To prevent escaped output when building the JSON, e.g. \",(0,n.jsx)(e.code,{children:'{\"titles\": \"[\\\\\"1984\\\\\",\\\\\"Animal Farm\\\\\",\\\\\"O Alquimista\\\\\",\\\\\"Brida\\\\\"]\"}'}),\", you need to call \",(0,n.jsx)(e.code,{children:\"json_merge_preserve\"})]})]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@t\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" @\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@group_concat_max_len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),\" @\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@group_concat_max_len\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4294967295\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" json_merge_preserve\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[]'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  concat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'['\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    group_concat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"json_merge_preserve\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'{}'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      json_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      json_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      json_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'todos'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" json_merge_preserve\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[]'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" json_merge_preserve\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[]'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            concat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'['\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              group_concat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"json_merge_preserve\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'{}'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                json_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                json_object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'todo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" separator \",(0,n.jsx)(e.span,{className:\"token string\",children:\"','\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token string\",children:\"']'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" user_todos \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),` t\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user_id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" separator \",(0,n.jsx)(e.span,{className:\"token string\",children:\"','\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"']'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" users \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"set\"}),\" @\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@group_concat_max_len\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@t\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"trinoprestoathena\",children:[(0,n.jsx)(e.a,{href:\"#trinoprestoathena\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Trino/Presto/Athena\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"array_agg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"map_from_entries\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"array\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"row\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"row\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"row\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'todos'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"array_agg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"map_from_entries\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"array\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"row\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"row\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'todo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` user_todos t\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user_id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` users u\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"sql-server\",children:[(0,n.jsx)(e.a,{href:\"#sql-server\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"SQL Server\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" json_arrayagg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"values\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        json_query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" json_arrayagg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"values\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"todo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" t \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"todo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" json path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" include_null_values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` without_array_wrapper\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` user_todos t\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user_id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" u\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" t \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"todos\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" json path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" include_null_values\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` without_array_wrapper\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` users u\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"generate-series\",children:[(0,n.jsx)(e.a,{href:\"#generate-series\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Generate Series\"]}),(0,n.jsx)(e.p,{children:\"Now lets look at the SQL for generating a series of integer values from a given range:\"}),(0,n.jsxs)(e.h3,{id:\"postgres\",children:[(0,n.jsx)(e.a,{href:\"#postgres\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Postgres\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsx)(e.code,{className:\"language-sql code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" generate_series\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"clickhouse\",children:[(0,n.jsx)(e.a,{href:\"#clickhouse\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Clickhouse\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" cast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"number \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Nullable\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"integer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" numbers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"snowflake\",children:[(0,n.jsx)(e.a,{href:\"#snowflake\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Snowflake\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"row_number\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"over\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"order\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"by\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"table\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"generator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"rowcount\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"oracle\",children:[(0,n.jsx)(e.a,{href:\"#oracle\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Oracle\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"level\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` DUAL\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"connect\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"by\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"level\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` i\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"mysql\",children:[(0,n.jsx)(e.a,{href:\"#mysql\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"MySQL\"]}),(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"with\"}),` recursive\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"union\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"all\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),` i\n`]})]})}),(0,n.jsxs)(e.h1,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{href:\"#conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,n.jsx)(e.p,{children:\"I hope this post has given you a sense for how leveraging an abstract Query IR as your SQL generation target can help deal with the complexities of portable, cross-dialect SQL.\"}),(0,n.jsx)(e.p,{children:\"It's proven an effective strategy for what I use it for.\"}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"AI Disclaimer: ChatGPT 4.1 was used to generate the Open Graph image for this post.\"})})]})}}var b=f;function _(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return j;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"Background","url":"#background","depth":1},{"value":"Abstract Query AST's","url":"#abstract-query-asts","depth":1},{"value":"Asking an LLM to generate a JSON query for MySQL, Postgres, and Trino","url":"#asking-an-llm-to-generate-a-json-query-for-mysql-postgres-and-trino","depth":1},{"value":"Why the Problem is Non-Trivial","url":"#why-the-problem-is-non-trivial","depth":1},{"value":"NOTE: jOOQ's \"Translate\" Online Tool","url":"#note-jooqs-translate-online-tool","depth":2},{"value":"JSON Query","url":"#json-query","depth":2},{"value":"MariaDB","url":"#mariadb","depth":3},{"value":"Trino/Presto/Athena","url":"#trinoprestoathena","depth":3},{"value":"SQL Server","url":"#sql-server","depth":3},{"value":"Generate Series","url":"#generate-series","depth":2},{"value":"Postgres","url":"#postgres","depth":3},{"value":"Clickhouse","url":"#clickhouse","depth":3},{"value":"Snowflake","url":"#snowflake","depth":3},{"value":"Oracle","url":"#oracle","depth":3},{"value":"MySQL","url":"#mysql","depth":3},{"value":"Conclusion","url":"#conclusion","depth":1}],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.34,"time":680400,"words":2268},"slug":"overcoming-dialect-sql-generation-limits","fileName":"overcoming-dialect-sql-generation-limits.md","title":"AI SQL Generation: Overcoming dialect-specific syntax errors","date":"2025-05-17T00:00:00.000Z","tags":["sql","text-to-sql","llms"],"draft":false,"summary":"A discussion on techniques available to overcome semantic errors in syntax when generating dialect-specific SQL","images":["/static/images/ai-sql-generation.png"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.85,"time":51000,"words":170},"slug":["default"],"fileName":"default.md","name":"Gavin Ray","avatar":"/static/images/me.png","occupation":"Code Stuff","company":"Hasura","email":"ray.gavin97@gmail.com","twitter":"https://twitter.com/GavinRayDev","linkedin":"https://www.linkedin.com","github":"https://github.com/GavinRay97","date":null}],"prev":{"title":"What good are Record Patterns in Java? An example based on Spark's Catalyst Optimizer and it's Tree Rewriting Rules","date":"2023-02-04T00:00:00.000Z","tags":["java","jdk","jvm"],"draft":false,"summary":"A tutorial on how to use Java's new Record Patterns feature to write powerful, concise pattern matching code for usecases like AST transformations and rewrite-rules in compiler passes.\n","images":["/static/images/ast-visualization.png"],"slug":"what-good-are-record-patterns"},"next":{"title":"Psychedelics as Tools: Reflections After 20+ Compounds and a Decade of Experiments","date":"2025-07-12T00:00:00.000Z","tags":["non-technical","psychedelics"],"draft":false,"summary":"Reflections and hard-won lessons from a decade exploring over 20 psychedelic compounds.","images":["/static/images/Ouroborous-benzene.svg"],"slug":"perspectives-on-psychedelic-use"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["overcoming-dialect-sql-generation-limits"]},"buildId":"0nAhX7uCIcvT_SMqzyo8b","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>